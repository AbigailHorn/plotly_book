<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>18.2 Leveraging plotly input events | Interactive web-based data visualization with R, plotly, and shiny</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="18.2 Leveraging plotly input events | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18.2 Leveraging plotly input events | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Carson Sievert">


<meta name="date" content="2019-01-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="hello-shiny.html">
<link rel="next" href="shiny-performance.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/summary-fix.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="what-you-will-learn.html"><a href="what-you-will-learn.html"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a></li>
<li class="chapter" data-level="1.2" data-path="how-this-book-is-organized.html"><a href="how-this-book-is-organized.html"><i class="fa fa-check"></i><b>1.2</b> How this book is organized</a></li>
<li class="chapter" data-level="1.3" data-path="what-you-wont-learn.html"><a href="what-you-wont-learn.html"><i class="fa fa-check"></i><b>1.3</b> What you won’t learn</a><ul>
<li class="chapter" data-level="1.3.1" data-path="what-you-wont-learn.html"><a href="what-you-wont-learn.html#web-technologies"><i class="fa fa-check"></i><b>1.3.1</b> Web technologies</a></li>
<li class="chapter" data-level="1.3.2" data-path="what-you-wont-learn.html"><a href="what-you-wont-learn.html#d3js"><i class="fa fa-check"></i><b>1.3.2</b> d3js</a></li>
<li class="chapter" data-level="1.3.3" data-path="what-you-wont-learn.html"><a href="what-you-wont-learn.html#ggplot2"><i class="fa fa-check"></i><b>1.3.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.3.4" data-path="what-you-wont-learn.html"><a href="what-you-wont-learn.html#graphical-data-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Graphical data analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="run-code-examples.html"><a href="run-code-examples.html"><i class="fa fa-check"></i><b>1.5</b> Run code examples</a></li>
<li class="chapter" data-level="1.6" data-path="getting-help-and-learning-more.html"><a href="getting-help-and-learning-more.html"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="why-web-graphics.html"><a href="why-web-graphics.html"><i class="fa fa-check"></i><b>2</b> Why interactive web graphics in R?</a></li>
<li class="part"><span><b>I Creating views</b></span></li>
<li class="chapter" data-level="3" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>4</b> Scatter traces</a><ul>
<li class="chapter" data-level="4.1" data-path="scatterplots.html"><a href="scatterplots.html"><i class="fa fa-check"></i><b>4.1</b> Scatterplots</a><ul>
<li class="chapter" data-level="4.1.1" data-path="scatterplots.html"><a href="scatterplots.html#d-scatterplots"><i class="fa fa-check"></i><b>4.1.1</b> 3D scatterplots</a></li>
<li class="chapter" data-level="4.1.2" data-path="scatterplots.html"><a href="scatterplots.html#scatterplot-matrices"><i class="fa fa-check"></i><b>4.1.2</b> Scatterplot matrices</a></li>
<li class="chapter" data-level="4.1.3" data-path="scatterplots.html"><a href="scatterplots.html#dotplots-error-bars"><i class="fa fa-check"></i><b>4.1.3</b> Dotplots &amp; error bars</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="line-plots.html"><a href="line-plots.html"><i class="fa fa-check"></i><b>4.2</b> Line plots</a><ul>
<li class="chapter" data-level="4.2.1" data-path="line-plots.html"><a href="line-plots.html#density-plots"><i class="fa fa-check"></i><b>4.2.1</b> Density plots</a></li>
<li class="chapter" data-level="4.2.2" data-path="line-plots.html"><a href="line-plots.html#parallel-coordinates"><i class="fa fa-check"></i><b>4.2.2</b> Parallel Coordinates</a></li>
<li class="chapter" data-level="4.2.3" data-path="line-plots.html"><a href="line-plots.html#d-paths"><i class="fa fa-check"></i><b>4.2.3</b> 3D paths</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="segments.html"><a href="segments.html"><i class="fa fa-check"></i><b>4.3</b> Segments</a></li>
<li class="chapter" data-level="4.4" data-path="ribbons.html"><a href="ribbons.html"><i class="fa fa-check"></i><b>4.4</b> Ribbons</a></li>
<li class="chapter" data-level="4.5" data-path="polygons.html"><a href="polygons.html"><i class="fa fa-check"></i><b>4.5</b> Polygons</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>5</b> Maps</a><ul>
<li class="chapter" data-level="5.1" data-path="using-scatter-traces.html"><a href="using-scatter-traces.html"><i class="fa fa-check"></i><b>5.1</b> Using scatter traces</a></li>
<li class="chapter" data-level="5.2" data-path="choropleths.html"><a href="choropleths.html"><i class="fa fa-check"></i><b>5.2</b> Choropleths</a></li>
<li class="chapter" data-level="5.3" data-path="using-geom-sf.html"><a href="using-geom-sf.html"><i class="fa fa-check"></i><b>5.3</b> Using <code>geom_sf()</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>6</b> Bars &amp; histograms</a><ul>
<li class="chapter" data-level="6.1" data-path="multiple-numeric-distributions.html"><a href="multiple-numeric-distributions.html"><i class="fa fa-check"></i><b>6.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="6.2" data-path="multiple-discrete-distributions.html"><a href="multiple-discrete-distributions.html"><i class="fa fa-check"></i><b>6.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>7</b> Boxplots</a></li>
<li class="chapter" data-level="8" data-path="d-frequencies.html"><a href="d-frequencies.html"><i class="fa fa-check"></i><b>8</b> 2D frequencies</a><ul>
<li class="chapter" data-level="8.1" data-path="rectangular-binning-in-plotly-js.html"><a href="rectangular-binning-in-plotly-js.html"><i class="fa fa-check"></i><b>8.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="8.2" data-path="rectangular-binning-in-r.html"><a href="rectangular-binning-in-r.html"><i class="fa fa-check"></i><b>8.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="8.3" data-path="categorical-axes.html"><a href="categorical-axes.html"><i class="fa fa-check"></i><b>8.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="other-3d-plots.html"><a href="other-3d-plots.html"><i class="fa fa-check"></i><b>9</b> Other 3D plots</a></li>
<li class="chapter" data-level="10" data-path="raster-images.html"><a href="raster-images.html"><i class="fa fa-check"></i><b>10</b> Raster images</a></li>
<li class="part"><span><b>II Publishing views</b></span></li>
<li class="chapter" data-level="11" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>11</b> Introduction</a></li>
<li class="chapter" data-level="12" data-path="saving-and-embedding-html.html"><a href="saving-and-embedding-html.html"><i class="fa fa-check"></i><b>12</b> Saving and embedding HTML</a></li>
<li class="chapter" data-level="13" data-path="exporting-static-images.html"><a href="exporting-static-images.html"><i class="fa fa-check"></i><b>13</b> Exporting static images</a><ul>
<li class="chapter" data-level="13.1" data-path="with-code.html"><a href="with-code.html"><i class="fa fa-check"></i><b>13.1</b> With code</a></li>
<li class="chapter" data-level="13.2" data-path="from-a-browser.html"><a href="from-a-browser.html"><i class="fa fa-check"></i><b>13.2</b> From a browser</a></li>
<li class="chapter" data-level="13.3" data-path="sizing-exports.html"><a href="sizing-exports.html"><i class="fa fa-check"></i><b>13.3</b> Sizing exports</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="editing-views-for-publishing.html"><a href="editing-views-for-publishing.html"><i class="fa fa-check"></i><b>14</b> Editing views for publishing</a></li>
<li class="part"><span><b>III Combining multiple views</b></span></li>
<li class="chapter" data-level="15" data-path="arranging-views.html"><a href="arranging-views.html"><i class="fa fa-check"></i><b>15</b> Arranging views</a><ul>
<li class="chapter" data-level="15.1" data-path="arranging-htmlwidgets.html"><a href="arranging-htmlwidgets.html"><i class="fa fa-check"></i><b>15.1</b> Arranging htmlwidgets</a></li>
<li class="chapter" data-level="15.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html"><i class="fa fa-check"></i><b>15.2</b> Merging plotly objects</a><ul>
<li class="chapter" data-level="15.2.1" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#recursive-subplots"><i class="fa fa-check"></i><b>15.2.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="15.2.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#ggplot2-subplots"><i class="fa fa-check"></i><b>15.2.2</b> ggplot2 subplots</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="navigating-many-views.html"><a href="navigating-many-views.html"><i class="fa fa-check"></i><b>15.3</b> Navigating many views</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>16</b> Animating views</a></li>
<li class="part"><span><b>IV Linking multiple views</b></span></li>
<li class="chapter" data-level="17" data-path="client-side-linking.html"><a href="client-side-linking.html"><i class="fa fa-check"></i><b>17</b> Client-side linking</a><ul>
<li class="chapter" data-level="17.1" data-path="graphical-queries.html"><a href="graphical-queries.html"><i class="fa fa-check"></i><b>17.1</b> Graphical queries</a></li>
<li class="chapter" data-level="17.2" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>17.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="17.3" data-path="linking-animated-views.html"><a href="linking-animated-views.html"><i class="fa fa-check"></i><b>17.3</b> Linking animated views</a></li>
<li class="chapter" data-level="17.4" data-path="querying-examples.html"><a href="querying-examples.html"><i class="fa fa-check"></i><b>17.4</b> Examples</a><ul>
<li class="chapter" data-level="17.4.1" data-path="querying-examples.html"><a href="querying-examples.html#trellis-linking"><i class="fa fa-check"></i><b>17.4.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="17.4.2" data-path="querying-examples.html"><a href="querying-examples.html#statistical-queries"><i class="fa fa-check"></i><b>17.4.2</b> Statistical queries</a></li>
<li class="chapter" data-level="17.4.3" data-path="querying-examples.html"><a href="querying-examples.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>17.4.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="17.4.4" data-path="querying-examples.html"><a href="querying-examples.html#geo-spatial-queries"><i class="fa fa-check"></i><b>17.4.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="17.4.5" data-path="querying-examples.html"><a href="querying-examples.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>17.4.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="17.4.6" data-path="querying-examples.html"><a href="querying-examples.html#generalized-pairs-plots"><i class="fa fa-check"></i><b>17.4.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="17.4.7" data-path="querying-examples.html"><a href="querying-examples.html#querying-diagnostic-plots"><i class="fa fa-check"></i><b>17.4.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="limitations.html"><a href="limitations.html"><i class="fa fa-check"></i><b>17.5</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="linking-server-side.html"><a href="linking-server-side.html"><i class="fa fa-check"></i><b>18</b> Server-side linking with shiny</a><ul>
<li class="chapter" data-level="18.1" data-path="hello-shiny.html"><a href="hello-shiny.html"><i class="fa fa-check"></i><b>18.1</b> Embedding plotly in shiny</a><ul>
<li class="chapter" data-level="18.1.1" data-path="hello-shiny.html"><a href="hello-shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>18.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="18.1.2" data-path="hello-shiny.html"><a href="hello-shiny.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>18.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html"><i class="fa fa-check"></i><b>18.2</b> Leveraging plotly input events</a><ul>
<li class="chapter" data-level="18.2.1" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#dragging-events"><i class="fa fa-check"></i><b>18.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="18.2.2" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#d-events"><i class="fa fa-check"></i><b>18.2.2</b> 3D events</a></li>
<li class="chapter" data-level="18.2.3" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#edit-events"><i class="fa fa-check"></i><b>18.2.3</b> Edit events</a></li>
<li class="chapter" data-level="18.2.4" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#relayout-vs-restyle-events"><i class="fa fa-check"></i><b>18.2.4</b> Relayout vs restyle events</a></li>
<li class="chapter" data-level="18.2.5" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#scoping-events"><i class="fa fa-check"></i><b>18.2.5</b> Scoping events</a></li>
<li class="chapter" data-level="18.2.6" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#event-priority"><i class="fa fa-check"></i><b>18.2.6</b> Event priority</a></li>
<li class="chapter" data-level="18.2.7" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#handling-discrete-axes"><i class="fa fa-check"></i><b>18.2.7</b> Handling discrete axes</a></li>
<li class="chapter" data-level="18.2.8" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#reactive-vals"><i class="fa fa-check"></i><b>18.2.8</b> Accumulating and managing event data</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="shiny-performance.html"><a href="shiny-performance.html"><i class="fa fa-check"></i><b>18.3</b> Improving performance</a><ul>
<li class="chapter" data-level="18.3.1" data-path="shiny-performance.html"><a href="shiny-performance.html#proxies"><i class="fa fa-check"></i><b>18.3.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="18.3.2" data-path="shiny-performance.html"><a href="shiny-performance.html#partial-update-examples"><i class="fa fa-check"></i><b>18.3.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="advanced-applications.html"><a href="advanced-applications.html"><i class="fa fa-check"></i><b>18.4</b> Advanced applications</a><ul>
<li class="chapter" data-level="18.4.1" data-path="advanced-applications.html"><a href="advanced-applications.html#drill-down"><i class="fa fa-check"></i><b>18.4.1</b> Drill-down</a></li>
<li class="chapter" data-level="18.4.2" data-path="advanced-applications.html"><a href="advanced-applications.html#crossfilter"><i class="fa fa-check"></i><b>18.4.2</b> Cross-filter</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>18.5</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>19</b> Extending plotly with JavaScript</a><ul>
<li class="chapter" data-level="19.1" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>19.1</b> Working with JSON</a><ul>
<li class="chapter" data-level="19.1.1" data-path="json.html"><a href="json.html#assignment-subsetting-and-iteration"><i class="fa fa-check"></i><b>19.1.1</b> Assignment, subsetting, and iteration</a></li>
<li class="chapter" data-level="19.1.2" data-path="json.html"><a href="json.html#mapping-r-to-json"><i class="fa fa-check"></i><b>19.1.2</b> Mapping R to JSON</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="js-event-handlers.html"><a href="js-event-handlers.html"><i class="fa fa-check"></i><b>19.2</b> Adding custom event handlers</a></li>
<li class="chapter" data-level="19.3" data-path="supplying-custom-data.html"><a href="supplying-custom-data.html"><i class="fa fa-check"></i><b>19.3</b> Supplying custom data</a></li>
<li class="chapter" data-level="19.4" data-path="incorporating-other-client-side-tools.html"><a href="incorporating-other-client-side-tools.html"><i class="fa fa-check"></i><b>19.4</b> Incorporating other client-side tools</a></li>
</ul></li>
<li class="part"><span><b>V Various special topics</b></span></li>
<li class="chapter" data-level="20" data-path="is-plotly-free.html"><a href="is-plotly-free.html"><i class="fa fa-check"></i><b>20</b> Is plotly free?</a></li>
<li class="chapter" data-level="21" data-path="when-does-data-remain-local.html"><a href="when-does-data-remain-local.html"><i class="fa fa-check"></i><b>21</b> When does data remain local?</a></li>
<li class="chapter" data-level="22" data-path="language-support.html"><a href="language-support.html"><i class="fa fa-check"></i><b>22</b> Language support</a></li>
<li class="chapter" data-level="23" data-path="latex-rendering.html"><a href="latex-rendering.html"><i class="fa fa-check"></i><b>23</b> LaTeX rendering</a><ul>
<li class="chapter" data-level="23.1" data-path="mathjax-caveats.html"><a href="mathjax-caveats.html"><i class="fa fa-check"></i><b>23.1</b> MathJax caveats</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="control-tooltip-text.html"><a href="control-tooltip-text.html"><i class="fa fa-check"></i><b>24</b> Control tooltip text</a></li>
<li class="chapter" data-level="25" data-path="control-ggplotly-tooltips.html"><a href="control-ggplotly-tooltips.html"><i class="fa fa-check"></i><b>25</b> Control <code>ggplotly()</code> tooltips</a></li>
<li class="chapter" data-level="26" data-path="control-tooltip-styling.html"><a href="control-tooltip-styling.html"><i class="fa fa-check"></i><b>26</b> Control tooltip styling</a></li>
<li class="chapter" data-level="27" data-path="control-the-modebar.html"><a href="control-the-modebar.html"><i class="fa fa-check"></i><b>27</b> Control the modebar</a><ul>
<li class="chapter" data-level="27.1" data-path="remove-the-entire-modebar.html"><a href="remove-the-entire-modebar.html"><i class="fa fa-check"></i><b>27.1</b> Remove the entire modebar</a></li>
<li class="chapter" data-level="27.2" data-path="remove-the-plotly-logo.html"><a href="remove-the-plotly-logo.html"><i class="fa fa-check"></i><b>27.2</b> Remove the plotly logo</a></li>
<li class="chapter" data-level="27.3" data-path="remove-modebar-buttons.html"><a href="remove-modebar-buttons.html"><i class="fa fa-check"></i><b>27.3</b> Remove modebar buttons</a></li>
<li class="chapter" data-level="27.4" data-path="add-custom-modebar-buttons.html"><a href="add-custom-modebar-buttons.html"><i class="fa fa-check"></i><b>27.4</b> Add custom modebar buttons</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="facetted-subplot.html"><a href="facetted-subplot.html"><i class="fa fa-check"></i><b>28</b> Facetted <code>subplot()</code></a></li>
<li class="chapter" data-level="29" data-path="control-plot-margins.html"><a href="control-plot-margins.html"><i class="fa fa-check"></i><b>29</b> Control plot margin(s)</a></li>
<li class="chapter" data-level="30" data-path="control-axes.html"><a href="control-axes.html"><i class="fa fa-check"></i><b>30</b> Control axes</a></li>
<li class="chapter" data-level="31" data-path="why-does-my-line-plot-appear-blank-i-e-malformed-group-definition.html"><a href="why-does-my-line-plot-appear-blank-i-e-malformed-group-definition.html"><i class="fa fa-check"></i><b>31</b> Why does my line plot appear blank (i.e., malformed group definition)?</a></li>
<li class="chapter" data-level="32" data-path="improving-performance.html"><a href="improving-performance.html"><i class="fa fa-check"></i><b>32</b> Improving performance</a></li>
<li class="chapter" data-level="33" data-path="r-file-size-so-big.html"><a href="r-file-size-so-big.html"><i class="fa fa-check"></i><b>33</b> R file size so big?</a></li>
<li class="chapter" data-level="34" data-path="how-to-prevent-plotly-from-graying-out-in-shiny.html"><a href="how-to-prevent-plotly-from-graying-out-in-shiny.html"><i class="fa fa-check"></i><b>34</b> How to prevent plotly from graying-out in shiny?</a></li>
<li class="chapter" data-level="35" data-path="why-am-i-getting-a-blank-plot.html"><a href="why-am-i-getting-a-blank-plot.html"><i class="fa fa-check"></i><b>35</b> Why am I getting a blank plot?</a></li>
<li class="chapter" data-level="36" data-path="learn-how-to-fish-plotly-js.html"><a href="learn-how-to-fish-plotly-js.html"><i class="fa fa-check"></i><b>36</b> Learn how to fish (plotly.js)</a></li>
<li class="chapter" data-level="37" data-path="how-can-i-report-a-bug.html"><a href="how-can-i-report-a-bug.html"><i class="fa fa-check"></i><b>37</b> How can I report a bug?</a></li>
<li class="chapter" data-level="38" data-path="what-advantages-does-plotlyshiny-have-over-dash.html"><a href="what-advantages-does-plotlyshiny-have-over-dash.html"><i class="fa fa-check"></i><b>38</b> What advantages does plotly+shiny have over dash?</a></li>
<li class="chapter" data-level="39" data-path="developer-facing-topics.html"><a href="developer-facing-topics.html"><i class="fa fa-check"></i><b>39</b> Developer-facing topics</a><ul>
<li class="chapter" data-level="39.1" data-path="translating-custom-ggplot2-geoms.html"><a href="translating-custom-ggplot2-geoms.html"><i class="fa fa-check"></i><b>39.1</b> Translating custom ggplot2 geoms</a></li>
<li class="chapter" data-level="39.2" data-path="designing-an-htmlwidget-interface.html"><a href="designing-an-htmlwidget-interface.html"><i class="fa fa-check"></i><b>39.2</b> Designing an htmlwidget interface</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Interactive web-based data visualization with R, plotly, and shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-plotly-inputs" class="section level2">
<h2><span class="header-section-number">18.2</span> Leveraging plotly input events</h2>
<p>Section <a href="hello-shiny.html#fig:shiny-intro">18.1</a> covered how to render <strong>shiny</strong> output widgets (e.g., <code>plotlyOutput()</code>) that depend on a input widget, but what about having an output act like an input to another output? For example, say we’d like to dynamically generate a bar chart (i.e., an output) based on a point clicked on a scatter-plot (i.e., an input event tied to an output widget). In addition to <strong>shiny</strong>’s static graph and image rendering functions (e.g., <code>plotOutput()</code>/<code>imageOutput()</code>), there are a handful of other R packages that expose user interaction with “output” widget(s) as input value(s). <span class="citation">Cheng (<a href="#ref-leaflet-shiny">2018</a><a href="#ref-leaflet-shiny">c</a>)</span> and <span class="citation">Xie (<a href="#ref-DT-shiny">2018</a>)</span> describe the interface for the <strong>leaflet</strong> and <strong>DT</strong> packages. This section outlines the interface for <code>plotlyOutput()</code>. This sort of functionality plays a vital role in linking of views through direct manipulation, similar to what we’ve already seen in section <a href="graphical-queries.html#graphical-queries">17.1</a>, but having access to <strong>plotly</strong> events on a <strong>shiny</strong> server allows for much more flexibility than linking views purely client-side.</p>
<p>The <code>event_data()</code> function is the most straight-forward way to access a <strong>plotly</strong> input events in <strong>shiny</strong>. Although <code>event_data()</code> is function, it references and returns a <strong>shiny</strong> input value, so <code>event_data()</code> needs to be used inside a reactive context. Most of these available events are data-specific traces (e.g., <code>"plotly_hover"</code>, <code>"plotly_click"</code>, <code>"plotly_selected"</code>, etc), but there are also some that are layout-specific (e.g., <code>"plotly_relayout"</code>). Most plotly.js events<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> are accessible through this interface – for a complete list see the <code>help(event_data)</code> documentation page.</p>
<p>Numerous Figures in the following sections show how to access common <strong>plotly</strong> events in <strong>shiny</strong> and do something with the result. When using these events to inform another view of the data, it’s often necessary to know what portion of data was queried in the event (i.e., the <code>x</code>/<code>y</code> positions alone may not be enough to uniquely identify the information of interest). For this reason, it’s often a good idea to supply a <code>key</code> (or <code>customdata</code>) attribute, so that you can map the event data back to the original data. The <code>key</code> attribute is only supported in <strong>shiny</strong>, but <code>customdata</code> is officially supported by plotly.js, and thus can also be used to attach meta-information to event – see section <a href="javascript.html#javascript">19</a> for more details.</p>
<div id="dragging-events" class="section level3">
<h3><span class="header-section-number">18.2.1</span> Dragging events</h3>
<p>There are currently four different modes for mouse click+drag behavior (i.e., <code>dragmode</code>) in plotly.js: zoom, pan, rectangular selection, and lasso selection. This mode may be changed interactively via the modebar that appears above a <strong>plotly</strong> graph, but the default mode can also be set from the command-line. The default <code>dragmode</code> in Figure <a href="shiny-plotly-inputs.html#fig:plotlyEvents">18.3</a> is set to <code>'select'</code>, so that dragging draws a rectangular box which highlights markers. When in this mode, or in the lasso selection mode, information about the drag event can be accessed in four different ways: <code>"plotly_selecting"</code>, <code>"plotly_selected"</code>, <code>"plotly_brushing"</code>, and <code>"plotly_brushed"</code>. Both the <code>"plotly_selecting"</code> and <code>"plotly_selected"</code> events emit information about trace(s) appearing within the interior of the brush – the only difference is that <code>"plotly_selecting"</code> fires repeatedly <em>during</em> drag events, whereas <code>"plotly_selected"</code> fires <em>after</em> drag events (i.e., after the mouse has been released). The semantics behind <code>"plotly_brushing"</code> and <code>"plotly_brushed"</code> are similar, but these emit the x/y limits of the selection brush. As for the other two dragging modes (zoom and pan), since they modify the range of the x/y axes, information about these events can be accessed through <code>"plotly_relayout"</code>. Sections <a href="shiny-performance.html#proxies">18.3.1</a> and <a href="advanced-applications.html#advanced-applications">18.4</a> both have advanced applications of these dragging events.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">radioButtons</span>(<span class="st">&quot;plotType&quot;</span>, <span class="st">&quot;Plot Type:&quot;</span>, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;ggplotly&quot;</span>, <span class="st">&quot;plotly&quot;</span>)),
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;plot&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;selecting&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;brushing&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;relayout&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
    
  nms &lt;-<span class="st"> </span><span class="kw">row.names</span>(mtcars)
    
  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    p &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">identical</span>(input<span class="op">$</span>plotType, <span class="st">&quot;ggplotly&quot;</span>)) {
      <span class="kw">ggplotly</span>(<span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y =</span> wt, <span class="dt">key =</span> nms)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>())
    } <span class="cf">else</span> {
      <span class="kw">plot_ly</span>(mtcars, <span class="dt">x =</span> <span class="op">~</span>mpg, <span class="dt">y =</span> <span class="op">~</span>wt, <span class="dt">key =</span> nms)
    }
    <span class="kw">layout</span>(p, <span class="dt">dragmode =</span> <span class="st">&quot;select&quot;</span>)
  })
  
  output<span class="op">$</span>selecting &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_selecting&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Selected data appears here&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>brushing &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_brushing&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Selection brush limits appear here&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>relayout &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_relayout&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Zoom and pan info appears here&quot;</span> <span class="cf">else</span> d
  })
    
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:plotlyEvents"></span>
<iframe src="https://player.vimeo.com/video/307597427?title=0&amp;byline=0&amp;portrait=0" width="100%" height="500" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.3: Accessing event data from click and drag events.
</p>
</div>
</div>
<div id="d-events" class="section level3">
<h3><span class="header-section-number">18.2.2</span> 3D events</h3>
<p>Drag selection events (i.e., <code>"plotly_selecting"</code>) are currently only available for 2D charts, but other common events are generally supported for any type of graph, including 3D charts. Figure <a href="shiny-plotly-inputs.html#fig:3Devents">18.4</a> accesses various events in 3D including: <code>"plotly_hover"</code>, <code>"plotly_click"</code>, <code>"plotly_legendclick"</code>, <code>"plotly_legenddoubleclick"</code>, and <code>"plotly_relayout"</code>. The data emitted via <code>"plotly_hover"</code> and <code>"plotly_click"</code> is structured similarly to data emitted from <code>"plotly_selecting"</code>/<code>"plotly_selected"</code>. Figure <a href="shiny-plotly-inputs.html#fig:3Devents">18.4</a> also demonstrates how one can react to particular components of a conflated event like <code>"plotly_relayout"</code>. That is, <code>"plotly_relayout"</code> will fire whenever <em>any</em> part of the layout has changed, so if we want to trigger behavior if and only if there are changes to the camera eye, one could first check if the information emitted contains information about the camera eye.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;plot&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;hover&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;click&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;legendclick&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;legend2click&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;relayout&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>(mtcars, <span class="dt">x =</span> <span class="op">~</span>wt, <span class="dt">y =</span> <span class="op">~</span>mpg, <span class="dt">z =</span> <span class="op">~</span>disp, <span class="dt">color =</span> <span class="op">~</span><span class="kw">factor</span>(cyl))
  })
  
  output<span class="op">$</span>hover &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_hover&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Hover events appear here&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>click &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_click&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Click events appear here&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>legendclick &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_legendclick&quot;</span>)<span class="op">$</span>name
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Legend click&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>legend2click &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_legenddoubleclick&quot;</span>)<span class="op">$</span>name
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Legend double-click&quot;</span> <span class="cf">else</span> d
  })
  
  output<span class="op">$</span>relayout &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_relayout&quot;</span>)<span class="op">$</span>scene.camera<span class="op">$</span>eye
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Camera eye info&quot;</span> <span class="cf">else</span> d
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:3Devents"></span>
<iframe src="https://player.vimeo.com/video/307598025?title=0&amp;byline=0&amp;portrait=0" width="100%" height="500" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.4: Accessing 3D events.
</p>
</div>
</div>
<div id="edit-events" class="section level3">
<h3><span class="header-section-number">18.2.3</span> Edit events</h3>
<p>A little known fact about <strong>plotly</strong> is that you can directly manipulate annotations, title, shapes (e.g., circle, lines, rectangles), legends, and more by simply adding <code>config(p, editable = TRUE)</code> to a plot <code>p</code>. Moreover, since these are all layout components, we can access information about these ‘edit events’, by listening to the <code>"plotly_relayout"</code> events. Figure <a href="shiny-plotly-inputs.html#fig:shiny-edit-annotations">18.5</a> just how easy it is to access information about changes in annotation positioning and content.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;p&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;info&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">layout</span>(
        <span class="dt">annotations =</span> <span class="kw">list</span>(
          <span class="kw">list</span>(
            <span class="dt">text =</span> emo<span class="op">::</span><span class="kw">ji</span>(<span class="st">&quot;fire&quot;</span>),
            <span class="dt">x =</span> <span class="fl">0.5</span>, 
            <span class="dt">y =</span> <span class="fl">0.5</span>, 
            <span class="dt">xref =</span> <span class="st">&quot;paper&quot;</span>,
            <span class="dt">yref =</span> <span class="st">&quot;paper&quot;</span>,
            <span class="dt">showarrow =</span> <span class="ot">FALSE</span>
          ),
          <span class="kw">list</span>(
            <span class="dt">text =</span> <span class="st">&quot;fire&quot;</span>,
            <span class="dt">x =</span> <span class="fl">0.5</span>, 
            <span class="dt">y =</span> <span class="fl">0.5</span>, 
            <span class="dt">xref =</span> <span class="st">&quot;paper&quot;</span>,
            <span class="dt">yref =</span> <span class="st">&quot;paper&quot;</span>
          )
      )) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">config</span>(<span class="dt">editable =</span> <span class="ot">TRUE</span>)
  })
  
  output<span class="op">$</span>info &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    <span class="kw">event_data</span>(<span class="st">&quot;plotly_relayout&quot;</span>)
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-edit-annotations"></span>
<iframe src="https://player.vimeo.com/video/307597631?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.5: Accessing information about direct manipulation of annotations.
</p>
</div>
<p>Figure <a href="shiny-plotly-inputs.html#fig:shiny-drag-circle">18.6</a> demonstrates directly manipulating a circle shape and accessing the new positions of the circle. In constrast to Figure <a href="shiny-plotly-inputs.html#fig:shiny-edit-annotations">18.5</a>, which made everything (e.g. the plot and axis titles) editable via <code>config(p, editable = TRUE)</code>, note how Figure <a href="shiny-plotly-inputs.html#fig:shiny-drag-circle">18.6</a> makes use of the <code>edits</code> argument to make only the shapes editable.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(plotly)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;p&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;event&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">layout</span>(
        <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>)),
        <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>)),
        <span class="dt">shapes =</span> <span class="kw">list</span>(
          <span class="dt">type =</span> <span class="st">&quot;circle&quot;</span>, 
          <span class="dt">fillcolor =</span> <span class="st">&quot;gray&quot;</span>,
          <span class="dt">line =</span> <span class="kw">list</span>(<span class="dt">color =</span> <span class="st">&quot;gray&quot;</span>),
          <span class="dt">x0 =</span> <span class="dv">-10</span>, <span class="dt">x1 =</span> <span class="dv">10</span>,
          <span class="dt">y0 =</span> <span class="dv">-10</span>, <span class="dt">y1 =</span> <span class="dv">10</span>,
          <span class="dt">xsizemode =</span> <span class="st">&quot;pixel&quot;</span>, 
          <span class="dt">ysizemode =</span> <span class="st">&quot;pixel&quot;</span>,
          <span class="dt">xanchor =</span> <span class="dv">0</span>, <span class="dt">yanchor =</span> <span class="dv">0</span>
        )
      ) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">config</span>(<span class="dt">edits =</span> <span class="kw">list</span>(<span class="dt">shapePosition =</span> <span class="ot">TRUE</span>))
  })
  
  output<span class="op">$</span>event &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    <span class="kw">event_data</span>(<span class="st">&quot;plotly_relayout&quot;</span>)
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-drag-circle"></span>
<iframe src="https://player.vimeo.com/video/307598919?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.6: Accessing information about direct manipulation of circle shapes.
</p>
</div>
<p>Figure <a href="shiny-plotly-inputs.html#fig:shiny-drag-line">18.7</a> uses an ediatble vertical line and the <code>plotly_relayout</code> event data to ‘snap’ the line to the closest point in a sequence of <code>x</code> values. It also places a marker on the intersection between the vertical line shape and the line chart of <code>y</code> values. Notice how, by accessing <code>event_data()</code> in this way (i.e., the source and target view of the event is the same), the chart is actually fully redrawn every time the line shape moves. If performance were an issue (i.e., we were dealing with lots of lines), this type of interaction likely won’t be very responsive. In that case, you can use <code>event_data()</code> to trigger side-effects (i.e., partially modify the plot) which is covered in <a href="shiny-performance.html#proxies">18.3.1</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(plotly)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;p&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;event&quot;</span>)
)

x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>)
y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(x))

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_relayout&quot;</span>)
    selected_point &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(d[[<span class="st">&quot;shapes[0].x0&quot;</span>]])) {
      <span class="co"># &#39;snap&#39; the x-position from the event to the closest `x` value</span>
      xint &lt;-<span class="st"> </span>d[[<span class="st">&quot;shapes[0].x0&quot;</span>]]
      xpt &lt;-<span class="st"> </span>x[<span class="kw">which.min</span>(<span class="kw">abs</span>(x <span class="op">-</span><span class="st"> </span>xint))]
      <span class="kw">list</span>(<span class="dt">x =</span> xpt, <span class="dt">y =</span> y[<span class="kw">which</span>(x <span class="op">==</span><span class="st"> </span>xpt)])
    } <span class="cf">else</span> {
      <span class="co"># default to </span>
      <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> y[<span class="kw">which</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)])
    }
    
    <span class="kw">plot_ly</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_lines</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_markers</span>(<span class="dt">x =</span> selected_point<span class="op">$</span>x, <span class="dt">y =</span> selected_point<span class="op">$</span>y) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">layout</span>(
        <span class="dt">shapes =</span> <span class="kw">list</span>(
          <span class="dt">type =</span> <span class="st">&quot;line&quot;</span>, 
          <span class="dt">line =</span> <span class="kw">list</span>(<span class="dt">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="dt">dash =</span> <span class="st">&quot;dot&quot;</span>),
          <span class="dt">x0 =</span> selected_point<span class="op">$</span>x, 
          <span class="dt">x1 =</span> selected_point<span class="op">$</span>x,
          <span class="dt">y0 =</span> <span class="dv">0</span>,
          <span class="dt">y1 =</span> <span class="dv">1</span>,
          <span class="dt">yref =</span> <span class="st">&quot;paper&quot;</span>
        )
      ) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">config</span>(<span class="dt">editable =</span> <span class="ot">TRUE</span>)
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-drag-line"></span>
<iframe src="https://player.vimeo.com/video/307597984?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.7: Dragging a vertical line shape and ‘snapping’ the line to match the closest provided <code>x</code> value.
</p>
</div>
</div>
<div id="relayout-vs-restyle-events" class="section level3">
<h3><span class="header-section-number">18.2.4</span> Relayout vs restyle events</h3>
<p>Remember every <strong>graph</strong> has two critical components: data (i.e., traces) and layout. Similar to how <code>"plotly_relayout"</code> reports partial modifications to the layout, the <code>"plotly_restyle"</code> event reports partial modification to traces. Compared to <code>"plotly_relayout"</code>, there aren’t very many native direct manipulation events that would trigger a <code>"plotly_restyle"</code> event. For example, zoom/pan events, camera changes, editing annotations/shapes/etc all trigger a <code>"plotly_relayout"</code> event, but not many traces allow you to directly manipulate their properties. One notable exception is the <code>"parcoords"</code> trace type which has native support for brushing lines along an axis dimension(s). As Figure <a href="shiny-plotly-inputs.html#fig:shiny-parcoords">18.8</a> demonstrates, these brush events emit a <code>"plotly_restyle"</code> event with the range(s) of the highlighted dimension.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
<span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;parcoords&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;info&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>parcoords &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>(iris) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_parcoords</span>()
  })
  
  output<span class="op">$</span>info &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_restyle&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="st">&quot;Brush along a dimension&quot;</span> <span class="cf">else</span> d
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-parcoords"></span>
<iframe src="https://player.vimeo.com/video/307597864?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.8: Using the <code>"plotly_restyle"</code> event to access brushed dimensions of a parallel coordinates plot.
</p>
</div>
<p>As Figure <a href="shiny-plotly-inputs.html#fig:shiny-parcoords-data">18.9</a> shows, it’s possible to use this information to infer which data points are highlighted. The logic to do so is fairly sophisticated, and requires accumulation of the event data, as discussed in section <a href="shiny-plotly-inputs.html#reactive-vals">18.2.8</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotly_example</span>(<span class="st">&quot;shiny&quot;</span>, <span class="st">&quot;event_data_parcoords&quot;</span>)</code></pre>
<div class="figure"><span id="fig:shiny-parcoords-data"></span>
<iframe src="https://player.vimeo.com/video/307598128?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.9: Displaying the highlighted observations of a parcoords trace.
</p>
</div>
</div>
<div id="scoping-events" class="section level3">
<h3><span class="header-section-number">18.2.5</span> Scoping events</h3>
<p>This section leverages the interface for accessing <strong>plotly</strong> input events introduced in section <a href="shiny-plotly-inputs.html#shiny-plotly-inputs">18.2</a> to inform other data views about those events. When managing multiple views that communicate with one another, you’ll need to be aware of which views are a <em>source</em> of interaction and which are a <em>target</em> (a view can be both, at once!). The <code>event_data()</code> function provides a <code>source</code> argument to help refine which view(s) serve as the source of an event. The <code>source</code> argument takes a string ID, and when that ID matches the <code>source</code> of a <code>plot_ly()</code>/<code>ggplotly()</code> graph, then the <code>event_data()</code> is “scoped” to that view. To get a better idea of how this works, consider Figure <a href="shiny-plotly-inputs.html#fig:shiny-corrplot">18.10</a></p>
<p>Figure <a href="shiny-plotly-inputs.html#fig:shiny-corrplot">18.10</a> allows one to click on a cell of correlation heatmap to generate a scatterplot of the two corresponding variables – allowing for a closer look at their relationship. In the case of a heatmap, the event data tied to a <code>plotly_click</code> event contains the relevant <code>x</code> and <code>y</code> categories (e.g., the names of the data variables of interest) and the <code>z</code> value (e.g., the pearson correlation between those variables). In order to obtain click data from the heatmap, and only the heatmap, it’s important that the <code>source</code> argument of the <code>event_data()</code> function matches the <code>source</code> argument of <code>plot_ly()</code>. Otherwise, if the <code>source</code> argument was not specified <code>event_data("plotly_click")</code> would also fire if and when the user clicked on the scatterplot, likely causing an error.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

<span class="co"># cache computation of the correlation matrix</span>
correlation &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">cor</span>(mtcars), <span class="dv">3</span>)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;heat&quot;</span>),
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;scatterplot&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>heat &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>(<span class="dt">source =</span> <span class="st">&quot;heat_plot&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_heatmap</span>(
        <span class="dt">x =</span> <span class="kw">names</span>(mtcars), 
        <span class="dt">y =</span> <span class="kw">names</span>(mtcars), 
        <span class="dt">z =</span> correlation
      )
  })
  
  output<span class="op">$</span>scatterplot &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="co"># if there is no click data, render nothing!</span>
    clickData &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_click&quot;</span>, <span class="dt">source =</span> <span class="st">&quot;heat_plot&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(clickData)) <span class="kw">return</span>(<span class="ot">NULL</span>)
    
    <span class="co"># Obtain the clicked x/y variables and fit linear model to those 2 vars</span>
    vars &lt;-<span class="st"> </span><span class="kw">c</span>(clickData[[<span class="st">&quot;x&quot;</span>]], clickData[[<span class="st">&quot;y&quot;</span>]])
    d &lt;-<span class="st"> </span><span class="kw">setNames</span>(mtcars[vars], <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))
    yhat &lt;-<span class="st"> </span><span class="kw">fitted</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> d))
    
    <span class="co"># scatterplot with fitted line</span>
    <span class="kw">plot_ly</span>(d, <span class="dt">x =</span> <span class="op">~</span>x) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_markers</span>(<span class="dt">y =</span> <span class="op">~</span>y) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_lines</span>(<span class="dt">y =</span> <span class="op">~</span>yhat) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">layout</span>(
        <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> clickData[[<span class="st">&quot;x&quot;</span>]]), 
        <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> clickData[[<span class="st">&quot;y&quot;</span>]]), 
        <span class="dt">showlegend =</span> <span class="ot">FALSE</span>
      )
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-corrplot"></span>
<iframe src="https://player.vimeo.com/video/307597728?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.10: Linking each cell of a correlation heatmap to their corresponding scatterplots.
</p>
</div>
</div>
<div id="event-priority" class="section level3">
<h3><span class="header-section-number">18.2.6</span> Event priority</h3>
<p>By default, <code>event_data()</code> only invalidates a reactive expression when the value of it’s corresponding <strong>shiny</strong> input changes. Sometimes, you might want a particular event, say <code>"plotly_click"</code>, to <em>always</em> invalidate a reactive expression. Figure <a href="shiny-plotly-inputs.html#fig:event-priority">18.11</a> shows the difference between this default behavior versus setting <code>priority = 'event'</code>. By default, repeatedly clicking the same marker won’t update the clock, but when setting the <code>priority</code> argument to event, repeatedly clicking the same marker will update the clock (i.e., it will invalidate the reactive expression).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;p&quot;</span>),
  <span class="kw">textOutput</span>(<span class="st">&quot;time1&quot;</span>),
  <span class="kw">textOutput</span>(<span class="st">&quot;time2&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="kw">I</span>(<span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">150</span>)))  <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_markers</span>()
  })
  
  output<span class="op">$</span>time1 &lt;-<span class="st"> </span><span class="kw">renderText</span>({
    <span class="kw">event_data</span>(<span class="st">&quot;plotly_click&quot;</span>)
    <span class="kw">paste</span>(<span class="st">&quot;Input priority: &quot;</span>, <span class="kw">Sys.time</span>())
  })
  
  output<span class="op">$</span>time2 &lt;-<span class="st"> </span><span class="kw">renderText</span>({
    <span class="kw">event_data</span>(<span class="st">&quot;plotly_click&quot;</span>, <span class="dt">priority =</span> <span class="st">&quot;event&quot;</span>)
    <span class="kw">paste</span>(<span class="st">&quot;Event priority: &quot;</span>, <span class="kw">Sys.time</span>())
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:event-priority"></span>
<iframe src="https://player.vimeo.com/video/307598534?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.11: A demo of input priority versus event priority. Clicking on the same marker repeatedly, by default, won’t invalidate a reactive expression that depends on ‘plotly_click’, but it will invalidate when given event priority.
</p>
</div>
<p>There are numerous events accessible through <code>event_data()</code> that don’t contain any information (e.g., <code>"plotly_doublelick"</code>, <code>"plotly_deselect"</code>, <code>"plotly_afterplot"</code>, etc). These events are automatically given an event priority since their corresponding <strong>shiny</strong> input value never changes. One common use case for events like <code>"plotly_doublelick"</code> (fired when double-clicking in a zoom or pan dragmode) and <code>"plotly_deselect"</code> (fired when double-clicking in a selection mode) is to clear or reset accumulating event data.</p>
</div>
<div id="handling-discrete-axes" class="section level3">
<h3><span class="header-section-number">18.2.7</span> Handling discrete axes</h3>
<p>For events that are trace-specific (e.g. <code>"plotly_click"</code>, <code>"plotly_hover"</code>, <code>"plotly_selecting"</code>, etc), the positional data (e.g., <code>x</code>/<code>y</code>/<code>z</code>) is always numeric, so if you have a plot with discrete axes, you might want to know how to map that numeric value back to the relevant input data category. In some cases, you can avoid the problem by assigning the discrete variable of interest to the <code>key</code>/<code>customdata</code> attribute, but you might also want to reserve that attribute to encode other information, like a <code>fill</code> aesthetic. Figure <a href="shiny-plotly-inputs.html#fig:discrete-event-data">18.12</a> shows how to map the numerical <code>x</code> value emitted in a click event back to the discrete variable that it corresponds to (<code>mpg$class</code>) and leverages <code>customdata</code> to encode the <code>fill</code> mapping allowing us to display the data records a clicked bar corresponds to. In both <code>ggplotly()</code> and <code>plot_ly()</code>, categories associated with a character vector are always alphabetized, so if you <code>sort()</code> the <code>unique()</code> character values, then the vector indices will match the <code>x</code> event data values. On the other hand, if <code>x</code> were a factor variable, the <code>x</code> event data would match the ordering of the <code>levels()</code> attribute.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(dplyr)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;bars&quot;</span>),
  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;click&quot;</span>)
)

classes &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(mpg<span class="op">$</span>class))

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  output<span class="op">$</span>bars &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(class, <span class="dt">fill =</span> drv, <span class="dt">customdata =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()
  })
  
  output<span class="op">$</span>click &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({
    d &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_click&quot;</span>)
    <span class="cf">if</span> (<span class="kw">is.null</span>(d)) <span class="kw">return</span>(<span class="st">&quot;Click a bar&quot;</span>)
    mpg <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">filter</span>(drv <span class="op">%in%</span><span class="st"> </span>d<span class="op">$</span>key) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">filter</span>(class <span class="op">%in%</span><span class="st"> </span>classes[d<span class="op">$</span>x])
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:discrete-event-data"></span>
<iframe src="https://player.vimeo.com/video/307598771?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.12: Retrieving the data observations that correspond to a particular bar in a stacked bar chart.
</p>
</div>
</div>
<div id="reactive-vals" class="section level3">
<h3><span class="header-section-number">18.2.8</span> Accumulating and managing event data</h3>
<p>Currently all the events accessible through <code>event_data()</code> are <em>transient</em>. This means that, given an event like <code>"plotly_click"</code>, the value of <code>event_data()</code> will only reflect the most recent click information. However, in order to implement complex linked graphics with <em>persistent</em> qualities, like Figure <a href="graphical-queries.html#fig:txmissing-modes">17.4</a> or <a href="advanced-applications.html#fig:shiny-crossfilter">18.22</a>, you’ll need someway to accumulate and manage event data. The general mechanism that <strong>shiny</strong> provides to achieve this kind of task is <code>reactiveVal()</code> (or, the plural version, <code>reactiveValues()</code>), which essentially provides a way to create and manage input values entirely server-side.</p>
<p>Figure <a href="shiny-plotly-inputs.html#fig:shiny-hover-persist">18.13</a> demonstrates a shiny app that accumulates hover information and paints the hovered points in red. Every time a hover event is triggered, the corresponding car name is added to the set of selected cars, and everytime the plot is double-clicked that set is cleared. This general pattern of initializing a reactive value (i.e., <code>cars &lt;- reactiveVal()</code>), updating that value upon a suitable <code>observeEvent()</code> event with relevant <code>customdata</code>, and clearing that reactive value (i.e., <code>cars(NULL)</code>) in response to another event is a very useful pattern to can support essentially any sort of linked views paradigm because the logic behind the resolution of selection sequences is under your complete control in R. For example, <a href="shiny-plotly-inputs.html#fig:shiny-hover-persist">18.13</a> simply adds accumulates the event data from <code>"plotly_hover"</code> (which is like a logical <code>OR</code> operations), but for other applications, you may need different logic, like the <code>AND</code>, <code>XOR</code>, etc.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">plotlyOutput</span>(<span class="st">&quot;p&quot;</span>),
  <span class="kw">tableOutput</span>(<span class="st">&quot;table&quot;</span>)
)

server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {
  
  <span class="co"># keep track of which cars have been hovered on</span>
  cars &lt;-<span class="st"> </span><span class="kw">reactiveVal</span>()
  
  <span class="co"># On hover, the key field of the event data contains the car name</span>
  <span class="co"># Add that name to the set of all &quot;selected&quot; cars</span>
  <span class="kw">observeEvent</span>(<span class="kw">event_data</span>(<span class="st">&quot;plotly_hover&quot;</span>), {
    car &lt;-<span class="st"> </span><span class="kw">event_data</span>(<span class="st">&quot;plotly_hover&quot;</span>)<span class="op">$</span>key
    cars_old_new &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cars</span>(), car)
    <span class="kw">cars</span>(<span class="kw">unique</span>(cars_old_new))
  })
  
  <span class="co"># clear the set of cars when a double-click occurs</span>
  <span class="kw">observeEvent</span>(<span class="kw">event_data</span>(<span class="st">&quot;plotly_doubleclick&quot;</span>), {
    <span class="kw">cars</span>(<span class="ot">NULL</span>)
  })
  
  output<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({
    
    <span class="co"># if the car is selected, paint it red</span>
    cols &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">row.names</span>(mtcars) <span class="op">%in%</span><span class="st"> </span><span class="kw">cars</span>(), <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)
    
    mtcars <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">plot_ly</span>(
        <span class="dt">x =</span> <span class="op">~</span>wt, <span class="dt">y =</span> <span class="op">~</span>mpg, 
        <span class="dt">key =</span> <span class="kw">row.names</span>(mtcars), 
        <span class="dt">color =</span> <span class="kw">I</span>(cols)
      ) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_markers</span>()
  })
  
  output<span class="op">$</span>table &lt;-<span class="st"> </span><span class="kw">renderTable</span>({
    <span class="kw">filter</span>(mtcars, <span class="kw">row.names</span>(mtcars) <span class="op">%in%</span><span class="st"> </span><span class="kw">cars</span>())
  })
  
}

<span class="kw">shinyApp</span>(ui, server)</code></pre>
<div class="figure"><span id="fig:shiny-hover-persist"></span>
<iframe src="https://player.vimeo.com/video/307597677?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.13: Using <code>reactiveVals()</code> to enable a persistent brush via mouse hover. In this example, the brush can be cleared through a double-click event.
</p>
</div>
<p>Figure <a href="shiny-plotly-inputs.html#fig:shiny-lmGadget">18.14</a> demonstrates a <strong>shiny</strong> gadget for interactively removing/adding points from a linear model via a scatterplot. A <strong>shiny</strong> gadget is similar to a normal <strong>shiny</strong> app except that it allows you to return object(s) from the application back to into your R session. In this case, Figure <a href="shiny-plotly-inputs.html#fig:shiny-lmGadget">18.14</a> returns the fitted model with the outliers removed and the choosen polynomial degree. The logic behind this app does more than simply accumulate event data everytime a point is clicked. Instead, it adds points to the ‘outlier’ set only if it isn’t already an outlier, and removes points that are already in the “outlier” set (so, it’s essentially <code>XOR</code> logic).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotly_example</span>(<span class="st">&quot;shiny&quot;</span>, <span class="st">&quot;lmGadget&quot;</span>)</code></pre>
<div class="figure"><span id="fig:shiny-lmGadget"></span>
<iframe src="https://player.vimeo.com/video/307598908?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 18.14: Interactively removing observations from a linear model. Credit to Winston Chang for the initial implementation of this <strong>shiny</strong> gadget using <code>shiny::plotOutput()</code> instead of <code>plotly::plotlyOutput()</code>
</p>
</div>
<p>As you can already see, the ability to accumulate and manage event data is a critical skill to have in order to implement <strong>shiny</strong> applications with complex interactive capabilities. The pattern demonstrates here is known more generally as “maintaining state” of a <strong>shiny</strong> app based on user interactions and has a variety of applications. So far, we’ve really only see how to maintain state of a single view, but as we’ll see later in section <a href="advanced-applications.html#advanced-applications">18.4</a>, the ability to maintain state is required to implement many advanced applications of multiple linked views. Also, it should be noted that Figure <a href="shiny-plotly-inputs.html#fig:shiny-hover-persist">18.13</a> and <a href="shiny-plotly-inputs.html#fig:shiny-lmGadget">18.14</a> perform a full redraw when updated – these apps would feel a bit more responsive if they leveraged strategies from section <a href="shiny-performance.html#proxies">18.3.1</a>.</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-leaflet-shiny">
<p>Cheng, Joe. 2018c. <em>Using Leaflet with Shiny</em>. Blog. <a href="https://rstudio.github.io/leaflet/shiny.html">https://rstudio.github.io/leaflet/shiny.html</a>.</p>
</div>
<div id="ref-DT-shiny">
<p>Xie, Yihui. 2018. <em>Using Leaflet with Shiny</em>. Blog. <a href="https://rstudio.github.io/DT/shiny.html">https://rstudio.github.io/DT/shiny.html</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="21">
<li id="fn21"><p>These events are documented at <a href="https://plot.ly/javascript/plotlyjs-events/" class="uri">https://plot.ly/javascript/plotlyjs-events/</a><a href="shiny-plotly-inputs.html#fnref21" class="footnote-back">↩</a></p></li>
</ol>
</div>
<script>
  var header = document.querySelector(".book-header h1");

  var img = document.createElement("img");
  img.src = "images/rstudioCloud.svg";
  img.width = 200;
  img.align = "right";
  img.style = "margin-top: 10px";

  var a = document.createElement("a");
  a.href = "https://rstudio.cloud/project/156701";
  a.target = "_blank";
  a.appendChild(img);

  header.appendChild(a);
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60116966-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60116966-3');
</script>
            </section>

          </div>
        </div>
      </div>
<a href="hello-shiny.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="shiny-performance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/linked-views-shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
