<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Maps | Interactive web-based data visualization with R, plotly, and shiny</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Maps | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Maps | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Carson Sievert">


<meta name="date" content="2019-02-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="scatter-traces.html">
<link rel="next" href="bars-histograms.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/summary-fix.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#how-this-book-is-organized"><i class="fa fa-check"></i><b>1.2</b> How this book is organized</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn"><i class="fa fa-check"></i><b>1.3</b> What you won’t learn</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#web-technologies"><i class="fa fa-check"></i><b>1.3.1</b> Web technologies</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#d3js"><i class="fa fa-check"></i><b>1.3.2</b> d3js</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#ggplot2"><i class="fa fa-check"></i><b>1.3.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#graphical-data-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Graphical data analysis</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#data-visualization-best-practices"><i class="fa fa-check"></i><b>1.3.5</b> Data visualization best practices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#run-code-examples"><i class="fa fa-check"></i><b>1.5</b> Run code examples</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#getting-help-and-learning-more"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="why-web-graphics.html"><a href="why-web-graphics.html"><i class="fa fa-check"></i><b>2</b> Why interactive web graphics in R?</a></li>
<li class="part"><span><b>I Creating views</b></span></li>
<li class="chapter" data-level="3" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>3</b> Overview</a><ul>
<li class="chapter" data-level="3.1" data-path="overview.html"><a href="overview.html#intro-plotly"><i class="fa fa-check"></i><b>3.1</b> Intro to <code>plot_ly()</code></a></li>
<li class="chapter" data-level="3.2" data-path="overview.html"><a href="overview.html#intro-plotly-js"><i class="fa fa-check"></i><b>3.2</b> Intro to plotly.js</a></li>
<li class="chapter" data-level="3.3" data-path="overview.html"><a href="overview.html#intro-to-ggplotly"><i class="fa fa-check"></i><b>3.3</b> Intro to <code>ggplotly()</code></a></li>
<li class="chapter" data-level="3.4" data-path="overview.html"><a href="overview.html#plot_ly-vs-ggplotly"><i class="fa fa-check"></i><b>3.4</b> <code>plot_ly()</code> vs <code>ggplotly()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>4</b> Scattered foundations</a><ul>
<li class="chapter" data-level="4.1" data-path="scatter-traces.html"><a href="scatter-traces.html#markers"><i class="fa fa-check"></i><b>4.1</b> Markers</a><ul>
<li class="chapter" data-level="4.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-alpha"><i class="fa fa-check"></i><b>4.1.1</b> Alpha blending</a></li>
<li class="chapter" data-level="4.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-color"><i class="fa fa-check"></i><b>4.1.2</b> Colors</a></li>
<li class="chapter" data-level="4.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-symbol"><i class="fa fa-check"></i><b>4.1.3</b> Symbols</a></li>
<li class="chapter" data-level="4.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-stroke"><i class="fa fa-check"></i><b>4.1.4</b> Stroke and span</a></li>
<li class="chapter" data-level="4.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-size"><i class="fa fa-check"></i><b>4.1.5</b> Size</a></li>
<li class="chapter" data-level="4.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#dot-plots"><i class="fa fa-check"></i><b>4.1.6</b> Dotplots &amp; error bars</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="scatter-traces.html"><a href="scatter-traces.html#lines"><i class="fa fa-check"></i><b>4.2</b> Lines</a><ul>
<li class="chapter" data-level="4.2.1" data-path="scatter-traces.html"><a href="scatter-traces.html#linetypes"><i class="fa fa-check"></i><b>4.2.1</b> Linetypes</a></li>
<li class="chapter" data-level="4.2.2" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>4.2.2</b> Segments</a></li>
<li class="chapter" data-level="4.2.3" data-path="scatter-traces.html"><a href="scatter-traces.html#density-plots"><i class="fa fa-check"></i><b>4.2.3</b> Density plots</a></li>
<li class="chapter" data-level="4.2.4" data-path="scatter-traces.html"><a href="scatter-traces.html#parallel-coordinates"><i class="fa fa-check"></i><b>4.2.4</b> Parallel Coordinates</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>4.3</b> Polygons</a><ul>
<li class="chapter" data-level="4.3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>4.3.1</b> Ribbons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>5</b> Maps</a><ul>
<li class="chapter" data-level="5.1" data-path="maps.html"><a href="maps.html#simple-maps"><i class="fa fa-check"></i><b>5.1</b> Simple maps</a><ul>
<li class="chapter" data-level="5.1.1" data-path="maps.html"><a href="maps.html#overview-1"><i class="fa fa-check"></i><b>5.1.1</b> Overview</a></li>
<li class="chapter" data-level="5.1.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>5.1.2</b> Choropleths</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="maps.html"><a href="maps.html#custom-maps"><i class="fa fa-check"></i><b>5.2</b> Custom maps</a><ul>
<li class="chapter" data-level="5.2.1" data-path="maps.html"><a href="maps.html#sf"><i class="fa fa-check"></i><b>5.2.1</b> Simple features (sf)</a></li>
<li class="chapter" data-level="5.2.2" data-path="maps.html"><a href="maps.html#devil-in-the-details"><i class="fa fa-check"></i><b>5.2.2</b> Devil in the details</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>6</b> Bars &amp; histograms</a><ul>
<li class="chapter" data-level="6.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>6.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="6.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>6.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>7</b> Boxplots</a></li>
<li class="chapter" data-level="8" data-path="d-frequencies.html"><a href="d-frequencies.html"><i class="fa fa-check"></i><b>8</b> 2D frequencies</a><ul>
<li class="chapter" data-level="8.1" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>8.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="8.2" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>8.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="8.3" data-path="d-frequencies.html"><a href="d-frequencies.html#categorical-axes"><i class="fa fa-check"></i><b>8.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="d-charts.html"><a href="d-charts.html"><i class="fa fa-check"></i><b>9</b> 3D charts</a><ul>
<li class="chapter" data-level="9.0.1" data-path="d-charts.html"><a href="d-charts.html#markers-and-lines"><i class="fa fa-check"></i><b>9.0.1</b> Markers and lines</a></li>
<li class="chapter" data-level="9.0.2" data-path="d-charts.html"><a href="d-charts.html#d-paths"><i class="fa fa-check"></i><b>9.0.2</b> 3D paths</a></li>
</ul></li>
<li class="part"><span><b>II Publishing views</b></span></li>
<li class="chapter" data-level="10" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>10</b> Introduction</a></li>
<li class="chapter" data-level="11" data-path="saving-and-embedding-html.html"><a href="saving-and-embedding-html.html"><i class="fa fa-check"></i><b>11</b> Saving and embedding HTML</a></li>
<li class="chapter" data-level="12" data-path="exporting-static-images.html"><a href="exporting-static-images.html"><i class="fa fa-check"></i><b>12</b> Exporting static images</a><ul>
<li class="chapter" data-level="12.1" data-path="exporting-static-images.html"><a href="exporting-static-images.html#with-code"><i class="fa fa-check"></i><b>12.1</b> With code</a></li>
<li class="chapter" data-level="12.2" data-path="exporting-static-images.html"><a href="exporting-static-images.html#from-a-browser"><i class="fa fa-check"></i><b>12.2</b> From a browser</a></li>
<li class="chapter" data-level="12.3" data-path="exporting-static-images.html"><a href="exporting-static-images.html#sizing-exports"><i class="fa fa-check"></i><b>12.3</b> Sizing exports</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="editing-views.html"><a href="editing-views.html"><i class="fa fa-check"></i><b>13</b> Editing views for publishing</a></li>
<li class="part"><span><b>III Combining multiple views</b></span></li>
<li class="chapter" data-level="14" data-path="arranging-views.html"><a href="arranging-views.html"><i class="fa fa-check"></i><b>14</b> Arranging views</a><ul>
<li class="chapter" data-level="14.1" data-path="arranging-views.html"><a href="arranging-views.html#arranging-htmlwidgets"><i class="fa fa-check"></i><b>14.1</b> Arranging htmlwidgets</a></li>
<li class="chapter" data-level="14.2" data-path="arranging-views.html"><a href="arranging-views.html#merging-plotly-objects"><i class="fa fa-check"></i><b>14.2</b> Merging plotly objects</a><ul>
<li class="chapter" data-level="14.2.1" data-path="arranging-views.html"><a href="arranging-views.html#recursive-subplots"><i class="fa fa-check"></i><b>14.2.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="14.2.2" data-path="arranging-views.html"><a href="arranging-views.html#ggplot2-subplots"><i class="fa fa-check"></i><b>14.2.2</b> ggplot2 subplots</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="arranging-views.html"><a href="arranging-views.html#creating-facets-with-subplot"><i class="fa fa-check"></i><b>14.3</b> Creating facets with <code>subplot()</code></a></li>
<li class="chapter" data-level="14.4" data-path="arranging-views.html"><a href="arranging-views.html#scatterplot-matrices-with-ggally"><i class="fa fa-check"></i><b>14.4</b> Scatterplot matrices with GGally</a></li>
<li class="chapter" data-level="14.5" data-path="arranging-views.html"><a href="arranging-views.html#navigating-many-views"><i class="fa fa-check"></i><b>14.5</b> Navigating many views</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>15</b> Animating views</a><ul>
<li class="chapter" data-level="15.1" data-path="animating-views.html"><a href="animating-views.html#animation-api"><i class="fa fa-check"></i><b>15.1</b> Animation API</a></li>
<li class="chapter" data-level="15.2" data-path="animating-views.html"><a href="animating-views.html#animation-support"><i class="fa fa-check"></i><b>15.2</b> Animation support</a></li>
</ul></li>
<li class="part"><span><b>IV Linking multiple views</b></span></li>
<li class="chapter" data-level="16" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>16</b> Introduction</a></li>
<li class="chapter" data-level="17" data-path="client-side-linking.html"><a href="client-side-linking.html"><i class="fa fa-check"></i><b>17</b> Client-side linking</a><ul>
<li class="chapter" data-level="17.1" data-path="client-side-linking.html"><a href="client-side-linking.html#graphical-queries"><i class="fa fa-check"></i><b>17.1</b> Graphical queries</a></li>
<li class="chapter" data-level="17.2" data-path="client-side-linking.html"><a href="client-side-linking.html#filter"><i class="fa fa-check"></i><b>17.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="17.3" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-animated-views"><i class="fa fa-check"></i><b>17.3</b> Linking animated views</a></li>
<li class="chapter" data-level="17.4" data-path="client-side-linking.html"><a href="client-side-linking.html#querying-examples"><i class="fa fa-check"></i><b>17.4</b> Examples</a><ul>
<li class="chapter" data-level="17.4.1" data-path="client-side-linking.html"><a href="client-side-linking.html#trellis-linking"><i class="fa fa-check"></i><b>17.4.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="17.4.2" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries"><i class="fa fa-check"></i><b>17.4.2</b> Statistical queries</a></li>
<li class="chapter" data-level="17.4.3" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>17.4.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="17.4.4" data-path="client-side-linking.html"><a href="client-side-linking.html#geo-spatial-queries"><i class="fa fa-check"></i><b>17.4.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="17.4.5" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>17.4.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="17.4.6" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggpairs"><i class="fa fa-check"></i><b>17.4.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="17.4.7" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggnostic"><i class="fa fa-check"></i><b>17.4.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="client-side-linking.html"><a href="client-side-linking.html#limitations"><i class="fa fa-check"></i><b>17.5</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="linking-server-side.html"><a href="linking-server-side.html"><i class="fa fa-check"></i><b>18</b> Server-side linking with shiny</a><ul>
<li class="chapter" data-level="18.1" data-path="linking-server-side.html"><a href="linking-server-side.html#hello-shiny"><i class="fa fa-check"></i><b>18.1</b> Embedding plotly in shiny</a><ul>
<li class="chapter" data-level="18.1.1" data-path="linking-server-side.html"><a href="linking-server-side.html#your-first-shiny-app"><i class="fa fa-check"></i><b>18.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="18.1.2" data-path="linking-server-side.html"><a href="linking-server-side.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>18.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="linking-server-side.html"><a href="linking-server-side.html#shiny-plotly-inputs"><i class="fa fa-check"></i><b>18.2</b> Leveraging plotly input events</a><ul>
<li class="chapter" data-level="18.2.1" data-path="linking-server-side.html"><a href="linking-server-side.html#dragging-events"><i class="fa fa-check"></i><b>18.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="18.2.2" data-path="linking-server-side.html"><a href="linking-server-side.html#d-events"><i class="fa fa-check"></i><b>18.2.2</b> 3D events</a></li>
<li class="chapter" data-level="18.2.3" data-path="linking-server-side.html"><a href="linking-server-side.html#edit-events"><i class="fa fa-check"></i><b>18.2.3</b> Edit events</a></li>
<li class="chapter" data-level="18.2.4" data-path="linking-server-side.html"><a href="linking-server-side.html#relayout-vs-restyle-events"><i class="fa fa-check"></i><b>18.2.4</b> Relayout vs restyle events</a></li>
<li class="chapter" data-level="18.2.5" data-path="linking-server-side.html"><a href="linking-server-side.html#scoping-events"><i class="fa fa-check"></i><b>18.2.5</b> Scoping events</a></li>
<li class="chapter" data-level="18.2.6" data-path="linking-server-side.html"><a href="linking-server-side.html#event-priority"><i class="fa fa-check"></i><b>18.2.6</b> Event priority</a></li>
<li class="chapter" data-level="18.2.7" data-path="linking-server-side.html"><a href="linking-server-side.html#handling-discrete-axes"><i class="fa fa-check"></i><b>18.2.7</b> Handling discrete axes</a></li>
<li class="chapter" data-level="18.2.8" data-path="linking-server-side.html"><a href="linking-server-side.html#reactive-vals"><i class="fa fa-check"></i><b>18.2.8</b> Accumulating and managing event data</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="linking-server-side.html"><a href="linking-server-side.html#shiny-performance"><i class="fa fa-check"></i><b>18.3</b> Improving performance</a><ul>
<li class="chapter" data-level="18.3.1" data-path="linking-server-side.html"><a href="linking-server-side.html#proxies"><i class="fa fa-check"></i><b>18.3.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="18.3.2" data-path="linking-server-side.html"><a href="linking-server-side.html#partial-update-examples"><i class="fa fa-check"></i><b>18.3.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="linking-server-side.html"><a href="linking-server-side.html#advanced-applications"><i class="fa fa-check"></i><b>18.4</b> Advanced applications</a><ul>
<li class="chapter" data-level="18.4.1" data-path="linking-server-side.html"><a href="linking-server-side.html#drill-down"><i class="fa fa-check"></i><b>18.4.1</b> Drill-down</a></li>
<li class="chapter" data-level="18.4.2" data-path="linking-server-side.html"><a href="linking-server-side.html#crossfilter"><i class="fa fa-check"></i><b>18.4.2</b> Cross-filter</a></li>
<li class="chapter" data-level="18.4.3" data-path="linking-server-side.html"><a href="linking-server-side.html#drag-brush"><i class="fa fa-check"></i><b>18.4.3</b> A draggable brush</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="linking-server-side.html"><a href="linking-server-side.html#discussion"><i class="fa fa-check"></i><b>18.5</b> Discussion</a></li>
</ul></li>
<li class="part"><span><b>V Scaling views</b></span></li>
<li class="chapter" data-level="19" data-path="scaling.html"><a href="scaling.html"><i class="fa fa-check"></i><b>19</b> Introduction</a></li>
<li class="chapter" data-level="20" data-path="run-time-efficiency.html"><a href="run-time-efficiency.html"><i class="fa fa-check"></i><b>20</b> Run-time efficiency</a></li>
<li class="chapter" data-level="21" data-path="print-time-efficiency.html"><a href="print-time-efficiency.html"><i class="fa fa-check"></i><b>21</b> Print-time efficiency</a></li>
<li class="chapter" data-level="22" data-path="a-case-study-with-cranlogs.html"><a href="a-case-study-with-cranlogs.html"><i class="fa fa-check"></i><b>22</b> A case study with cranlogs</a></li>
<li class="part"><span><b>VI Custom behavior with JavaScript</b></span></li>
<li class="chapter" data-level="23" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>23</b> Introduction</a></li>
<li class="chapter" data-level="24" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>24</b> Working with JSON</a><ul>
<li class="chapter" data-level="24.1" data-path="json.html"><a href="json.html#assignment-subsetting-and-iteration"><i class="fa fa-check"></i><b>24.1</b> Assignment, subsetting, and iteration</a></li>
<li class="chapter" data-level="24.2" data-path="json.html"><a href="json.html#mapping-r-to-json"><i class="fa fa-check"></i><b>24.2</b> Mapping R to JSON</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="js-event-handlers.html"><a href="js-event-handlers.html"><i class="fa fa-check"></i><b>25</b> Adding custom event handlers</a></li>
<li class="chapter" data-level="26" data-path="supplying-custom-data.html"><a href="supplying-custom-data.html"><i class="fa fa-check"></i><b>26</b> Supplying custom data</a></li>
<li class="chapter" data-level="27" data-path="client-side.html"><a href="client-side.html"><i class="fa fa-check"></i><b>27</b> Leveraging web technologies from R</a></li>
<li class="part"><span><b>VII Various special topics</b></span></li>
<li class="chapter" data-level="28" data-path="is-plotly-free-secure.html"><a href="is-plotly-free-secure.html"><i class="fa fa-check"></i><b>28</b> Is plotly free &amp; secure?</a></li>
<li class="chapter" data-level="29" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html"><i class="fa fa-check"></i><b>29</b> Controlling tooltips</a><ul>
<li class="chapter" data-level="29.1" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text"><i class="fa fa-check"></i><b>29.1</b> <code>plot_ly()</code> tooltips</a></li>
<li class="chapter" data-level="29.2" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text-ggplotly"><i class="fa fa-check"></i><b>29.2</b> <code>ggplotly()</code> tooltips</a></li>
<li class="chapter" data-level="29.3" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#styling"><i class="fa fa-check"></i><b>29.3</b> Styling</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="control-the-modebar.html"><a href="control-the-modebar.html"><i class="fa fa-check"></i><b>30</b> Control the modebar</a><ul>
<li class="chapter" data-level="30.1" data-path="control-the-modebar.html"><a href="control-the-modebar.html#remove-the-entire-modebar"><i class="fa fa-check"></i><b>30.1</b> Remove the entire modebar</a></li>
<li class="chapter" data-level="30.2" data-path="control-the-modebar.html"><a href="control-the-modebar.html#remove-the-plotly-logo"><i class="fa fa-check"></i><b>30.2</b> Remove the plotly logo</a></li>
<li class="chapter" data-level="30.3" data-path="control-the-modebar.html"><a href="control-the-modebar.html#remove-modebar-buttons-by-name"><i class="fa fa-check"></i><b>30.3</b> Remove modebar buttons by name</a></li>
<li class="chapter" data-level="30.4" data-path="control-the-modebar.html"><a href="control-the-modebar.html#add-custom-modebar-buttons"><i class="fa fa-check"></i><b>30.4</b> Add custom modebar buttons</a></li>
<li class="chapter" data-level="30.5" data-path="control-the-modebar.html"><a href="control-the-modebar.html#control-image-downloads"><i class="fa fa-check"></i><b>30.5</b> Control image downloads</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="working-with-colors.html"><a href="working-with-colors.html"><i class="fa fa-check"></i><b>31</b> Working with colors</a></li>
<li class="chapter" data-level="32" data-path="working-with-symbols.html"><a href="working-with-symbols.html"><i class="fa fa-check"></i><b>32</b> Working with symbols and glyphs</a></li>
<li class="chapter" data-level="33" data-path="control-the-layout.html"><a href="control-the-layout.html"><i class="fa fa-check"></i><b>33</b> Control the layout</a><ul>
<li class="chapter" data-level="33.1" data-path="control-the-layout.html"><a href="control-the-layout.html#axis-titles"><i class="fa fa-check"></i><b>33.1</b> Axis titles</a></li>
<li class="chapter" data-level="33.2" data-path="control-the-layout.html"><a href="control-the-layout.html#axis-labels"><i class="fa fa-check"></i><b>33.2</b> Axis labels</a></li>
<li class="chapter" data-level="33.3" data-path="control-the-layout.html"><a href="control-the-layout.html#margins"><i class="fa fa-check"></i><b>33.3</b> Margins</a></li>
<li class="chapter" data-level="33.4" data-path="control-the-layout.html"><a href="control-the-layout.html#fonts"><i class="fa fa-check"></i><b>33.4</b> Fonts</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="locales.html"><a href="locales.html"><i class="fa fa-check"></i><b>34</b> Language support</a></li>
<li class="chapter" data-level="35" data-path="mathjax.html"><a href="mathjax.html"><i class="fa fa-check"></i><b>35</b> LaTeX rendering</a><ul>
<li class="chapter" data-level="35.1" data-path="mathjax.html"><a href="mathjax.html#mathjax-caveats"><i class="fa fa-check"></i><b>35.1</b> MathJax caveats</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="the-data-plot-pipeline.html"><a href="the-data-plot-pipeline.html"><i class="fa fa-check"></i><b>36</b> The data-plot-pipeline</a></li>
<li class="chapter" data-level="37" data-path="modifying-ggplotly-results.html"><a href="modifying-ggplotly-results.html"><i class="fa fa-check"></i><b>37</b> Modifying <code>ggplotly()</code> results</a><ul>
<li class="chapter" data-level="37.1" data-path="modifying-ggplotly-results.html"><a href="modifying-ggplotly-results.html#modifying-layout"><i class="fa fa-check"></i><b>37.1</b> Modifying layout</a></li>
<li class="chapter" data-level="37.2" data-path="modifying-ggplotly-results.html"><a href="modifying-ggplotly-results.html#modifying-data"><i class="fa fa-check"></i><b>37.2</b> Modifying data</a></li>
<li class="chapter" data-level="37.3" data-path="modifying-ggplotly-results.html"><a href="modifying-ggplotly-results.html#leveraging-statistical-output"><i class="fa fa-check"></i><b>37.3</b> Leveraging statistical output</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="embedding-images.html"><a href="embedding-images.html"><i class="fa fa-check"></i><b>38</b> Embedding images</a></li>
<li class="part"><span><b>VIII Developer-facing topics</b></span></li>
<li class="chapter" data-level="39" data-path="translating-custom-ggplot2-geoms.html"><a href="translating-custom-ggplot2-geoms.html"><i class="fa fa-check"></i><b>39</b> Translating custom ggplot2 geoms</a></li>
<li class="chapter" data-level="40" data-path="designing-an-htmlwidget-interface.html"><a href="designing-an-htmlwidget-interface.html"><i class="fa fa-check"></i><b>40</b> Designing an htmlwidget interface</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Interactive web-based data visualization with R, plotly, and shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="maps" class="section level1">
<h1><span class="header-section-number">5</span> Maps</h1>
<p>There numerous ways to make a map with <strong>plotly</strong>, and each approach has strengths and weaknesses. The majority of content in this chapter is about drawing your own geo-spatial geometries using the <strong>sf</strong> R package in conjunction with <strong>plotly</strong>’s <code>add_sf()</code>.</p>
<p>You may not need this level of control, and in that case, you may want to use <strong>plotly</strong>’s specialized mapping options (Section @ref()). That being said, being able to draw any geo-spatial geometry that you want gives you way more power and control over what you’re doing. For example, cartogram maps (Section <a href="maps.html#cartograms">5.2.2.1</a>) simply aren’t possible with a native mapping approach.</p>
<div id="simple-maps" class="section level2">
<h2><span class="header-section-number">5.1</span> Simple maps</h2>
<div id="overview-1" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Overview</h3>
<p>If you have fairly simple latitude/longitude data and want to make a quick map, you may want to try one of <strong>plotly</strong>’s native mapping options (i.e., <code>plot_mapbox()</code> and <code>plot_geo()</code>). Generally speaking, you can treat these constructors like a drop-in replacement for <code>plot_ly()</code> and get a dynamic basemap rendered behind your data. Furthermore, all the scatter-based layers we learned about in Section <a href="scatter-traces.html#scatter-traces">4</a> will work as you’d expect it to with <code>plot_ly()</code>. For example, Figure <a href="maps.html#fig:mapbox-bubble">5.1</a> uses <code>plot_mapbox()</code> and <code>add_markers()</code> to create a bubble chart:</p>
<details>
<p><summary>Click to show code</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_mapbox</span>(maps<span class="op">::</span>canada.cities) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">x =</span> <span class="op">~</span>long, 
    <span class="dt">y =</span> <span class="op">~</span>lat, 
    <span class="dt">size =</span> <span class="op">~</span>pop, 
    <span class="dt">color =</span> <span class="op">~</span>country.etc,
    <span class="dt">colors =</span> <span class="st">&quot;Accent&quot;</span>,
    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, pop),
    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>
  )</code></pre>
</details>
<div class="figure" style="text-align: center"><span id="fig:mapbox-bubble"></span>
<iframe src="https://player.vimeo.com/video/317352934?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 5.1: A mapbox powered bubble chart showing the population of various cities in Canada.
</p>
</div>
<p>Figure <a href="maps.html#fig:geo-flights">5.2</a> demonstrates using <code>plot_geo()</code> in conjunction with <code>add_markers()</code> and <code>add_segments()</code> to visualize flight paths within the United States. Whereas <code>plot_mapbox()</code> is fixed to a mercator projection, the <code>plot_geo()</code> constructor has a handful of different projection available to it, including the orthographic projection which gives the illusion of the 3D globe.</p>
<details>
<p><summary>Click to show code</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
<span class="kw">library</span>(dplyr)
<span class="co"># airport locations</span>
air &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/plotly/datasets/master/2011_february_us_airport_traffic.csv&#39;</span>)
<span class="co"># flights between airports</span>
flights &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/plotly/datasets/master/2011_february_aa_flight_paths.csv&#39;</span>)
flights<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">nrow</span>(flights))

<span class="co"># map projection</span>
geo &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">projection =</span> <span class="kw">list</span>(
    <span class="dt">type =</span> <span class="st">&#39;orthographic&#39;</span>,
    <span class="dt">rotation =</span> <span class="kw">list</span>(<span class="dt">lon =</span> <span class="dv">-100</span>, <span class="dt">lat =</span> <span class="dv">40</span>, <span class="dt">roll =</span> <span class="dv">0</span>)
  ),
  <span class="dt">showland =</span> <span class="ot">TRUE</span>,
  <span class="dt">landcolor =</span> <span class="kw">toRGB</span>(<span class="st">&quot;gray95&quot;</span>),
  <span class="dt">countrycolor =</span> <span class="kw">toRGB</span>(<span class="st">&quot;gray80&quot;</span>)
)

<span class="kw">plot_geo</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">data =</span> air, <span class="dt">x =</span> <span class="op">~</span>long, <span class="dt">y =</span> <span class="op">~</span>lat, <span class="dt">text =</span> <span class="op">~</span>airport,
    <span class="dt">size =</span> <span class="op">~</span>cnt, <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_segments</span>(
    <span class="dt">data =</span> <span class="kw">group_by</span>(flights, id),
    <span class="dt">x =</span> <span class="op">~</span>start_lon, <span class="dt">xend =</span> <span class="op">~</span>end_lon,
    <span class="dt">y =</span> <span class="op">~</span>start_lat, <span class="dt">yend =</span> <span class="op">~</span>end_lat,
    <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">1</span>), <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> geo, <span class="dt">showlegend =</span> <span class="ot">FALSE</span>)</code></pre>
</details>
<div class="figure" style="text-align: center"><span id="fig:geo-flights"></span>
<iframe src="https://player.vimeo.com/video/317358033?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 5.2: A mapbox powered bubble chart showing the population of various cities in Canada.
</p>
</div>
<p>One nice thing about <code>plot_geo()</code> is that it automatically projects geometries into the proper coordinate system defined by the map projection. For example, in Figure <a href="maps.html#fig:maps">5.3</a> the simple line segment is straight when using <code>plot_mapbox()</code> yet curved when using <code>plot_geo()</code>. It’s possible to acheive the same effect using <code>plot_ly()</code> or <code>plot_mapbox()</code>, but the relevant marker/line/polygon data has to be put into an <strong>sf</strong> data structure before rendering (see Section <a href="maps.html#sf">5.2.1</a> for more details).</p>
<pre class="sourceCode r"><code class="sourceCode r">map1 &lt;-<span class="st"> </span><span class="kw">plot_mapbox</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">x =</span> <span class="dv">-100</span>, <span class="dt">xend =</span> <span class="dv">-50</span>, <span class="dt">y =</span> <span class="dv">50</span>, <span class="dt">yend =</span> <span class="dv">75</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(
    <span class="dt">mapbox =</span> <span class="kw">list</span>(
      <span class="dt">zoom =</span> <span class="dv">0</span>,
      <span class="dt">center =</span> <span class="kw">list</span>(<span class="dt">lat =</span> <span class="dv">65</span>, <span class="dt">lon =</span> <span class="dv">-75</span>)
    )
  )

map2 &lt;-<span class="st"> </span><span class="kw">plot_geo</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">x =</span> <span class="dv">-100</span>, <span class="dt">xend =</span> <span class="dv">-50</span>, <span class="dt">y =</span> <span class="dv">50</span>, <span class="dt">yend =</span> <span class="dv">75</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> <span class="kw">list</span>(<span class="dt">projection =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;mercator&quot;</span>)))

<span class="kw">library</span>(htmltools)
<span class="kw">browsable</span>(<span class="kw">tagList</span>(map1, map2))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:maps"></span>
<img src="images/maps.png" alt="Three different ways to render a map. On the top left is plotly's default cartesian coordinate system, on the top right is plotly's custom geographic layout, and on the bottom is mapbox." width="100%" />
<p class="caption">
FIGURE 5.3: Three different ways to render a map. On the top left is plotly’s default cartesian coordinate system, on the top right is plotly’s custom geographic layout, and on the bottom is mapbox.
</p>
</div>
</div>
<div id="choropleths" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Choropleths</h3>
<p>In addition to scatter-based layers, the <code>plot_geo()</code> constructor also supports a <a href="https://plot.ly/r/reference/#choropleth">choropleth</a> layer. Figure <a href="maps.html#fig:us-density">5.4</a> shows the population density of the U.S. via a choropleth, and also layers on markers for the state center locations, using the U.S. state data from the <strong>datasets</strong> package <span class="citation">(R Core Team <a href="#ref-RCore">2016</a>)</span>. By simply providing a <a href="https://plot.ly/r/reference/#choropleth-z"><code>z</code></a> attribute, plotly-geo objects will try to create a choropleth, but you’ll also need to provide <a href="https://plot.ly/r/reference/#choropleth-locations"><code>locations</code></a> and a <a href="https://plot.ly/r/reference/#choropleth-locationmode"><code>locationmode</code></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">density &lt;-<span class="st"> </span>state.x77[, <span class="st">&quot;Population&quot;</span>] <span class="op">/</span><span class="st"> </span>state.x77[, <span class="st">&quot;Area&quot;</span>]

g &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">scope =</span> <span class="st">&#39;usa&#39;</span>,
  <span class="dt">projection =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&#39;albers usa&#39;</span>),
  <span class="dt">lakecolor =</span> <span class="kw">toRGB</span>(<span class="st">&#39;white&#39;</span>)
)

<span class="kw">plot_geo</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_trace</span>(
    <span class="dt">z =</span> <span class="op">~</span>density, <span class="dt">text =</span> state.name, <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">0</span>),
    <span class="dt">locations =</span> state.abb, <span class="dt">locationmode =</span> <span class="st">&#39;USA-states&#39;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">x =</span> state.center[[<span class="st">&quot;x&quot;</span>]], <span class="dt">y =</span> state.center[[<span class="st">&quot;y&quot;</span>]], 
    <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">2</span>), <span class="dt">symbol =</span> <span class="kw">I</span>(<span class="dv">8</span>), <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;white&quot;</span>), <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> g)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:us-density"></span>
<img src="images/us-density.svg" alt="A map of U.S. population density using the `state.x77` data from the **datasets** package." width="100%" />
<p class="caption">
FIGURE 5.4: A map of U.S. population density using the <code>state.x77</code> data from the <strong>datasets</strong> package.
</p>
</div>
<p>Figure <a href="maps.html#fig:us-density">5.4</a> helps illuminate a problem with choropleths from a graphical perception point of view. We typically use the color in choropleths to encode a numeric variable (e.g., GDP, net exports, average SAT score, etc) and the eye naturally perceives the area that a particular color covers as proportional to its overall effect. This ends up being misleading since the area the color covers typically has no sensible relationship with the data encoded by the color. A classic example of this misleading effect in action is in US election maps – the proportion of red to blue coloring is not representative of the overall popular vote <span class="citation">(Newman <a href="#ref-election-maps">2016</a>)</span>.</p>
<p>Cartograms are an approach to reducing this misleading effect and grants another dimension to encode data through the size of geo-spatial features. Section <a href="maps.html#cartograms">5.2.2.1</a> covers how to render cartograms in <strong>plotly</strong> using <strong>sf</strong> and <strong>cartogram</strong>.</p>
<p>Any of the <code>add_*()</code> functions found under <a href="https://cpsievert.github.io/plotly_book/scatter-traces.html">scatter traces</a> should work as expected on plotly-geo (initialized via <code>plot_geo()</code>) or plotly-mapbox (initialized via <code>plot_mapbox()</code>) objects. You can think of <code>plot_geo()</code> and <code>plot_mapbox()</code> as special cases (or more opinionated versions) of <code>plot_ly()</code>. For one, they won’t allow you to mix scatter and non-scatter traces in a single plot object, which you probably don’t want to do anyway. In order to enable Figure <a href="maps.html#fig:maps">5.3</a>, plotly.js <em>can’t</em> make this restriction, but since we have <code>subplot()</code> in R, we <em>can</em> make this restriction without sacrificing flexibility.</p>
</div>
</div>
<div id="custom-maps" class="section level2">
<h2><span class="header-section-number">5.2</span> Custom maps</h2>
<div id="sf" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Simple features (sf)</h3>
<p>The <strong>sf</strong> R package is a modern approach to working with geo-spatial data structures based on tidy data principles <span class="citation">(Pebesma <a href="#ref-sf">2018</a>)</span>; <span class="citation">(Wickham <a href="#ref-tidy-data">2014</a><a href="#ref-tidy-data">b</a>)</span>. The key idea behind <strong>sf</strong> is that it stores geo-spatial geometries in a <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html">list-column</a> of a data frame. This allows each row to represent the real unit of observation/interest – whether it’s a polygon, multi-polygon, point, line, or even a collection of these features – and as a result, works seamlessly inside larger tidy workflows.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> The <strong>sf</strong> package itself does not really provide geo-spatial data – it provides the framework and utilties for storing and computing on geo-spatial data structures in an opinionated way.</p>
<p>There are numerous packages for accessing geo-spatial data as simple features data structures. A couple notable examples include <strong>rnaturalearth</strong> and <strong>USAboundaries</strong>. The <strong>rnaturalearth</strong> package is better for obtaining any map data in the world via an API provided by <a href="https://www.naturalearthdata.com/" class="uri">https://www.naturalearthdata.com/</a> <span class="citation">(South <a href="#ref-rnaturalearth">2017</a>)</span>. The <strong>USAboundaries</strong> package is great for obtaining map data for the United States at any point in history <span class="citation">(Mullen and Bratt <a href="#ref-USAboundaries">2018</a>)</span>. It doesn’t really matter what tool you use to obtain or create an <strong>sf</strong> object – once you have one, <code>plot_ly()</code> knows how to render it:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rnaturalearth)

world &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)
<span class="kw">class</span>(world)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&gt; [1] &quot;sf&quot;    &quot;data.frame&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_ly</span>(world, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray90&quot;</span>), <span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:world"></span>
<img src="images/world.svg" alt="Rendering all the world's countries using `plot_ly()` and the `ne_countries()` function from the **rnaturalearth** package." width="100%" />
<p class="caption">
FIGURE 5.5: Rendering all the world’s countries using <code>plot_ly()</code> and the <code>ne_countries()</code> function from the <strong>rnaturalearth</strong> package.
</p>
</div>
<p>How does <code>plot_ly()</code> know how to render the countries? It’s because the geo-spatial features are encoded in special (geometry) list-column. Also, meta-data about the geo-spatial structure are retained as special attributes of the data. Figure <a href="maps.html#fig:view-sf">5.6</a> augments the print method for <strong>sf</strong> to data frames to demonstrate that all the information needed to render the countries (i.e., polygons) in Figure <a href="maps.html#fig:world">5.5</a> is contained within the <code>world</code> data frame. Note also, that <strong>sf</strong> provides special <strong>dplyr</strong> methods for this special class of data frame so that you can treat data manipulations as if it were a ‘tidy’ data structure. One thing about this method is that the special ‘geometry’ column is always retained – if we try to just select the <code>name</code> column, then we get both the name and the geometry.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)

world <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">4</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:view-sf"></span>
<img src="images/view-sf.svg" alt="A diagram of a simple features data frame. The geometry column tracks the spatial features attached to each row in the data frame." width="100%" />
<p class="caption">
FIGURE 5.6: A diagram of a simple features data frame. The geometry column tracks the spatial features attached to each row in the data frame.
</p>
</div>
<p>There are actually 4 different ways to render <strong>sf</strong> objects with <strong>plotly</strong>: <code>plot_ly()</code>, <code>plot_mapbox()</code>, <code>plot_geo()</code>, and via <strong>ggplot2</strong>’s <code>geom_sf()</code>. The <code>plot_ly()</code> and <code>geom_sf()</code> approaches are more flexible – you can use literally any map projection you wish. That flexibility, especially the math and tools for working with map projections can be intimatidating for a causal map maker. Thankfully, there are nice resources for searching for projections in a human-friendly interface, like <a href="http://spatialreference.org/" class="uri">http://spatialreference.org/</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">canada &lt;-<span class="st"> </span><span class="kw">filter</span>(world, name <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)
cities &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(
  maps<span class="op">::</span>canada.cities, 
  <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>),
  <span class="dt">crs =</span> <span class="dv">4326</span>
)

<span class="co"># A PROJ4 projection designed for Canada</span>
<span class="co"># http://spatialreference.org/ref/sr-org/7/proj4/</span>
moll_proj &lt;-<span class="st"> &quot;+proj=lcc +lat_1=49 +lat_0=49 +lon_0=-95 +k_0=1 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs&quot;</span>
<span class="st">&quot;+proj=moll +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs&quot;</span>


<span class="co"># perform the projections</span>
canada &lt;-<span class="st"> </span><span class="kw">st_transform</span>(canada, moll_proj)
cities &lt;-<span class="st"> </span><span class="kw">st_transform</span>(cities, moll_proj)

<span class="co"># plot with geom_sf()</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> canada) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> cities, <span class="kw">aes</span>(<span class="dt">size =</span> pop), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>)
<span class="kw">ggplotly</span>(p)</code></pre>
<p><img src="images/canada-ggplotly.svg" width="100%" style="display: block; margin: auto;" /></p>
<p>TODO: mention <code>ggplotly()</code> is the only approach to get the grid-lines?</p>
</div>
<div id="devil-in-the-details" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Devil in the details</h3>
<p>Analogous to the discussion surrounding <a href="scatter-traces.html#fig:scatter-lines">4.2</a>, it pays to be aware of the tradeoffs involved with rendering <strong>plotly</strong> graphics using one or many traces, and knowledgable about how to leverage either approach. Specifically, by default, <strong>plotly</strong> attempts to render all simple features in a single trace, which is performant, but doesn’t have a lot of interactivity.</p>
<pre class="sourceCode r"><code class="sourceCode r">world &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="st">&quot;large&quot;</span>, <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)
<span class="kw">plot_mapbox</span>(world, <span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="fl">0.5</span>))</code></pre>
<p>Same arguments from <a href="scatter-traces.html#scatter-traces">4</a> are respected</p>
<div id="cartograms" class="section level4">
<h4><span class="header-section-number">5.2.2.1</span> Cartograms</h4>
<p>The R package <strong>cartogram</strong> provides a</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cartogram)
<span class="kw">library</span>(albersusa)

us_cont &lt;-<span class="st"> </span><span class="kw">cartogram_cont</span>(<span class="kw">usa_sf</span>(<span class="st">&quot;laea&quot;</span>), <span class="st">&quot;pop_2014&quot;</span>)

<span class="kw">plot_ly</span>(us_cont) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_sf</span>(
    <span class="dt">color =</span> <span class="op">~</span>pop_<span class="dv">2014</span>, 
    <span class="dt">split =</span> <span class="op">~</span>name, 
    <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>),
    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, scales<span class="op">::</span><span class="kw">number_si</span>(pop_<span class="dv">2014</span>)),
    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>,
    <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;Population </span><span class="ch">\n</span><span class="st"> 2014&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:cartogram"></span>
<img src="images/cartogram.png" alt="A cartogram of US population in 2014. A cartogram sizes the area of geo-spatial objects proportional to some metric (e.g., population)." width="100%" />
<p class="caption">
FIGURE 5.7: A cartogram of US population in 2014. A cartogram sizes the area of geo-spatial objects proportional to some metric (e.g., population).
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">us &lt;-<span class="st"> </span><span class="kw">usa_sf</span>(<span class="st">&quot;laea&quot;</span>)
us_dor &lt;-<span class="st"> </span><span class="kw">cartogram_dorling</span>(us, <span class="st">&quot;pop_2014&quot;</span>)

<span class="kw">plot_ly</span>(<span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_sf</span>(
    <span class="dt">data =</span> us, 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray95&quot;</span>),
    <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_sf</span>(
    <span class="dt">data =</span> us_dor, 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>), 
    <span class="dt">split =</span> <span class="op">~</span>name, 
    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, scales<span class="op">::</span><span class="kw">number_si</span>(pop_<span class="dv">2014</span>)), 
    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>, 
    <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:dorling"></span>
<img src="images/dorling.png" alt="A dorling cartogram of US population in 2014. A dorling cartogram sizes the circles proportional to some metric (e.g., population)." width="100%" />
<p class="caption">
FIGURE 5.8: A dorling cartogram of US population in 2014. A dorling cartogram sizes the circles proportional to some metric (e.g., population).
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tilegramsR)
<span class="kw">plot_ly</span>(sf_DKOS_CD_Hexmap_v1<span class="fl">.1</span>, <span class="dt">color =</span> <span class="op">~</span>STATENAME, <span class="dt">colors =</span> <span class="st">&quot;Accent&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:tilegram"></span>
<img src="images/tilegram.svg" alt="A tile cartogram of the US." width="100%" />
<p class="caption">
FIGURE 5.9: A tile cartogram of the US.
</p>
</div>

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-RCore">
<p>R Core Team. 2016. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-election-maps">
<p>Newman, Mark. 2016. “Maps of the 2016 Us Presidential Election Results.” Blog. <a href="http://www-personal.umich.edu/~mejn/election/2016/">http://www-personal.umich.edu/~mejn/election/2016/</a>.</p>
</div>
<div id="ref-sf">
<p>Pebesma, Edzer. 2018. <em>Sf: Simple Features for R</em>. <a href="https://CRAN.R-project.org/package=sf">https://CRAN.R-project.org/package=sf</a>.</p>
</div>
<div id="ref-tidy-data">
<p>Wickham, Hadley. 2014b. “Tidy Data.” <em>The Journal of Statistical Software</em> 59 (10). <a href="http://www.jstatsoft.org/v59/i10/">http://www.jstatsoft.org/v59/i10/</a>.</p>
</div>
<div id="ref-rnaturalearth">
<p>South, Andy. 2017. <em>Rnaturalearth: World Map Data from Natural Earth</em>. <a href="https://CRAN.R-project.org/package=rnaturalearth">https://CRAN.R-project.org/package=rnaturalearth</a>.</p>
</div>
<div id="ref-USAboundaries">
<p>Mullen, Lincoln A., and Jordan Bratt. 2018. “USAboundaries: Historical and Contemporary Boundaries of the United States of America.” <em>Journal of Open Source Software</em> 3 (23): 314. <a href="https://doi.org/10.21105/joss.00314">https://doi.org/10.21105/joss.00314</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>This is way more intuitive compared to older workflows based on, say using <code>ggplot2::fortify()</code> to obtain a data structure where a row to represents particular point along a feature and having another column track which point belongs to each feature (<a href="https://gis.stackexchange.com/questions/165974/r-fortify-causing-polygons-to-tear">for example</a>).<a href="maps.html#fnref8" class="footnote-back">↩</a></p></li>
</ol>
</div>
<script>
  var header = document.querySelector(".book-header h1");

  var img = document.createElement("img");
  img.src = "images/rstudioCloud.svg";
  img.width = 200;
  img.align = "right";
  img.style = "margin-top: 10px";

  var a = document.createElement("a");
  a.href = "https://rstudio.cloud/project/156701";
  a.target = "_blank";
  a.appendChild(img);

  header.appendChild(a);
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60116966-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60116966-3');
</script>
            </section>

          </div>
        </div>
      </div>
<a href="scatter-traces.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bars-histograms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/creating-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
