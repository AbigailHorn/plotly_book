<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>plotly for R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="An overview of the R package plotly">
  <meta name="generator" content="bookdown 0.2 and GitBook 2.6.7">

  <meta property="og:title" content="plotly for R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://ropensci.github.io/plotly/" />
  <meta property="og:image" content="http://ropensci.github.io/plotly/images/plotly.png" />
  <meta property="og:description" content="An overview of the R package plotly" />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="plotly for R" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="An overview of the R package plotly" />
  <meta name="twitter:image" content="http://ropensci.github.io/plotly/images/plotly.png" />

<meta name="author" content="Carson Sievert">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="linking-views-with-shiny.html">
<link rel="next" href="animating-views.html">

<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/plotlyjs/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs/plotly-latest.min.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/crosstalk/js/crosstalk.js"></script>
<link href="libs/jsoneditor/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding/jsonedit.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">plotly for R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="get-started.html"><a href="get-started.html"><i class="fa fa-check"></i>Get started</a></li>
<li class="chapter" data-level="" data-path="plot-ly-for-collaboration.html"><a href="plot-ly-for-collaboration.html"><i class="fa fa-check"></i>plot.ly for collaboration</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="two-approaches-one-object.html"><a href="two-approaches-one-object.html"><i class="fa fa-check"></i><b>1</b> Two approaches, one object</a><ul>
<li class="chapter" data-level="1.1" data-path="a-case-study-of-housing-sales-in-texas.html"><a href="a-case-study-of-housing-sales-in-texas.html"><i class="fa fa-check"></i><b>1.1</b> A case study of housing sales in Texas</a><ul>
<li class="chapter" data-level="1.1.1" data-path="a-case-study-of-housing-sales-in-texas.html"><a href="a-case-study-of-housing-sales-in-texas.html#ggplotly"><i class="fa fa-check"></i><b>1.1.1</b> The <code>ggplotly()</code> function</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-case-study-of-housing-sales-in-texas.html"><a href="a-case-study-of-housing-sales-in-texas.html#the-plot_ly-interface"><i class="fa fa-check"></i><b>1.1.2</b> The <code>plot_ly()</code> interface</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html"><i class="fa fa-check"></i><b>1.2</b> Extending <code>ggplotly()</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#customizing-the-layout"><i class="fa fa-check"></i><b>1.2.1</b> Customizing the layout</a></li>
<li class="chapter" data-level="1.2.2" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#adding-layers"><i class="fa fa-check"></i><b>1.2.2</b> Adding layers</a></li>
<li class="chapter" data-level="1.2.3" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#modifying-layers"><i class="fa fa-check"></i><b>1.2.3</b> Modifying layers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-plotly-cookbook.html"><a href="the-plotly-cookbook.html"><i class="fa fa-check"></i><b>2</b> The plotly cookbook</a><ul>
<li class="chapter" data-level="2.1" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>2.1</b> Scatter traces</a><ul>
<li class="chapter" data-level="2.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#scatterplots"><i class="fa fa-check"></i><b>2.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="2.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#dotplots-error-bars"><i class="fa fa-check"></i><b>2.1.2</b> Dotplots &amp; error bars</a></li>
<li class="chapter" data-level="2.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#line-plots"><i class="fa fa-check"></i><b>2.1.3</b> Line plots</a></li>
<li class="chapter" data-level="2.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>2.1.4</b> Segments</a></li>
<li class="chapter" data-level="2.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>2.1.5</b> Ribbons</a></li>
<li class="chapter" data-level="2.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>2.1.6</b> Polygons</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>2.2</b> Maps</a><ul>
<li class="chapter" data-level="2.2.1" data-path="maps.html"><a href="maps.html#using-scatter-traces"><i class="fa fa-check"></i><b>2.2.1</b> Using scatter traces</a></li>
<li class="chapter" data-level="2.2.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>2.2.2</b> Choropleths</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>2.3</b> Bars &amp; histograms</a><ul>
<li class="chapter" data-level="2.3.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>2.3.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="2.3.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>2.3.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>2.4</b> Boxplots</a></li>
<li class="chapter" data-level="2.5" data-path="d-frequencies.html"><a href="d-frequencies.html"><i class="fa fa-check"></i><b>2.5</b> 2D frequencies</a><ul>
<li class="chapter" data-level="2.5.1" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>2.5.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="2.5.2" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>2.5.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="2.5.3" data-path="d-frequencies.html"><a href="d-frequencies.html#categorical-axes"><i class="fa fa-check"></i><b>2.5.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="other-3d-plots.html"><a href="other-3d-plots.html"><i class="fa fa-check"></i><b>2.6</b> Other 3D plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="arranging-multiple-views.html"><a href="arranging-multiple-views.html"><i class="fa fa-check"></i><b>3</b> Arranging multiple views</a><ul>
<li class="chapter" data-level="3.1" data-path="arranging-htmlwidgets.html"><a href="arranging-htmlwidgets.html"><i class="fa fa-check"></i><b>3.1</b> Arranging htmlwidgets</a></li>
<li class="chapter" data-level="3.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html"><i class="fa fa-check"></i><b>3.2</b> Merging plotly objects</a><ul>
<li class="chapter" data-level="3.2.1" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#recursive-subplots"><i class="fa fa-check"></i><b>3.2.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="3.2.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#ggplot2-subplots"><i class="fa fa-check"></i><b>3.2.2</b> ggplot2 subplots</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="navigating-many-views.html"><a href="navigating-many-views.html"><i class="fa fa-check"></i><b>3.3</b> Navigating many views</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multiple-linked-views.html"><a href="multiple-linked-views.html"><i class="fa fa-check"></i><b>4</b> Multiple linked views</a><ul>
<li class="chapter" data-level="4.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html"><i class="fa fa-check"></i><b>4.1</b> Linking views with shiny</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#accessing-events-in-shiny"><i class="fa fa-check"></i><b>4.1.1</b> Accessing events in shiny</a></li>
<li class="chapter" data-level="4.1.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#updating-views"><i class="fa fa-check"></i><b>4.1.2</b> Updating views</a></li>
<li class="chapter" data-level="4.1.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#targeting-views"><i class="fa fa-check"></i><b>4.1.3</b> Targeting views</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html"><i class="fa fa-check"></i><b>4.2</b> Linking views without shiny</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#motivating-examples"><i class="fa fa-check"></i><b>4.2.1</b> Motivating examples</a></li>
<li class="chapter" data-level="4.2.2" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#transient-versus-persistent-selection"><i class="fa fa-check"></i><b>4.2.2</b> Transient versus persistent selection</a></li>
<li class="chapter" data-level="4.2.3" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>4.2.3</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="4.2.4" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#selection-via-indirect-manipulation"><i class="fa fa-check"></i><b>4.2.4</b> Selection via indirect manipulation</a></li>
<li class="chapter" data-level="4.2.5" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#the-shareddata-plot-pipeline"><i class="fa fa-check"></i><b>4.2.5</b> The SharedData plot pipeline</a></li>
<li class="chapter" data-level="4.2.6" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#dynamic-aggregates"><i class="fa fa-check"></i><b>4.2.6</b> Dynamic aggregates</a></li>
<li class="chapter" data-level="4.2.7" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#nested-selections"><i class="fa fa-check"></i><b>4.2.7</b> Nested selections</a></li>
<li class="chapter" data-level="4.2.8" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#more-examples"><i class="fa fa-check"></i><b>4.2.8</b> More examples</a></li>
<li class="chapter" data-level="4.2.9" data-path="linking-views-without-shiny.html"><a href="linking-views-without-shiny.html#limitations"><i class="fa fa-check"></i><b>4.2.9</b> Limitations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>5</b> Animating views</a><ul>
<li class="chapter" data-level="5.1" data-path="key-frame-animations.html"><a href="key-frame-animations.html"><i class="fa fa-check"></i><b>5.1</b> Key frame animations</a></li>
<li class="chapter" data-level="5.2" data-path="linking-animated-views.html"><a href="linking-animated-views.html"><i class="fa fa-check"></i><b>5.2</b> Linking animated views</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advanced-topics.html"><a href="advanced-topics.html"><i class="fa fa-check"></i><b>6</b> Advanced topics</a><ul>
<li class="chapter" data-level="6.1" data-path="custom-behavior-via-javascript.html"><a href="custom-behavior-via-javascript.html"><i class="fa fa-check"></i><b>6.1</b> Custom behavior via JavaScript</a></li>
<li class="chapter" data-level="6.2" data-path="translating-custom-ggplot2-geoms.html"><a href="translating-custom-ggplot2-geoms.html"><i class="fa fa-check"></i><b>6.2</b> Translating custom ggplot2 geoms</a></li>
<li class="chapter" data-level="6.3" data-path="designing-an-htmlwidget-interface.html"><a href="designing-an-htmlwidget-interface.html"><i class="fa fa-check"></i><b>6.3</b> Designing an htmlwidget interface</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">plotly for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linking-views-without-shiny" class="section level2">
<h2><span class="header-section-number">4.2</span> Linking views without shiny</h2>
<div class="rmdwarning">
<p>
The code is this section is still under development and is likely to change. To run any of the code you see in this section, you’ll need this developmental version of the package: <code>devtools::install_github(“ropensci/plotly#554”)</code>
</p>
</div>
<!-- TODO:
Explain again the importance of having standalone HTML?
-->
<div id="motivating-examples" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Motivating examples</h3>
<p>As shown in <a href="linking-views-with-shiny.html#linking-views-with-shiny">Linking views with shiny</a>, the <code>key</code> attribute provides a way to attach a key (i.e., ID) to graphical elements – an essential feature when making graphical queries. When linking views in <strong>plotly</strong> outside of <strong>shiny</strong>, the suggested way to attach a key to graphical elements is via the <code>SharedData</code> class from the <strong>crosstalk</strong> package <span class="citation">(Cheng <a href="#ref-crosstalk">2016</a>)</span>. At the very least, the <code>new()</code> method for this class requires a data frame, and a key variable. Lets suppose we’re interested in making comparisons of housing sales across cities for a given year using the <code>txhousing</code> dataset. Given that interest, we may want to make graphical queries that condition on a year, so we start by creating a <code>SharedData</code> object with <code>year</code> as the shared key.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># devtools::install_github(&quot;ropensci/crosstalk&quot;)</span>
<span class="kw">library</span>(crosstalk)
sd &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(txhousing, ~year)</code></pre></div>
<p>As far as <code>ggplotly()</code> and <code>plot_ly()</code> are concerned, <code>SharedData</code> object(s) act just like a data frame, but with a special <code>key</code> attribute attached to graphical elements. Since both interfaces are based on <a href="a-case-study-of-housing-sales-in-texas.html#the-layered-grammar-of-graphics">the layered grammar of graphics</a>, <code>key</code> attributes can be attached at the layer level, and those attributes can also be shared across multiple views. Figure <a href="linking-views-without-shiny.html#fig:linked-panels">4.4</a> leverages both of these features to link multiple views of median house sales in various Texan cities. As the <a href="http://i.imgur.com/DdPdSBB.gif">video</a> shows, hovering over a line in any panel selects that particular year, and all corresponding panels update to highlight that year. The result is an incredibly powerful tool for quickly comparing house sale prices, not only across cities for a given year, but also across years for a given city.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sd, <span class="kw">aes</span>(month, median)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> txhousing, <span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>city)

<span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;year&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">highlight</span>(<span class="dt">on =</span> <span class="st">&quot;plotly_click&quot;</span>, <span class="dt">defaultValues =</span> <span class="dv">2015</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:linked-panels"></span>
<img src="images/crosstalkLinkedPanels.gif" alt="Monthly median house sales by year and city. Each panel represents a city and panels are linked by year. A video demonstrating the graphical queries can be viewed [here](http://i.imgur.com/DdPdSBB.gif)" width="700" align:"center" />
<p class="caption">
Figure 4.4: Monthly median house sales by year and city. Each panel represents a city and panels are linked by year. A video demonstrating the graphical queries can be viewed <a href="http://i.imgur.com/DdPdSBB.gif">here</a>
</p>
</div>
<!-- TODO: talk more about the finding in the figure -->
<p>Figure <a href="linking-views-without-shiny.html#fig:linked-panels">4.4</a> uses the <code>highlight()</code> function from the <strong>plotly</strong> package to specify the type of plotly event for triggering a selection (via the <code>on</code> argument), the color of the selection (via the <code>color</code> argument), and set a default selection (via the <code>defaultValues</code> argument). The <code>off</code> argument controls the type of event that clears selections, and by default, is set to a <code>plotly_relayout</code> event, which can be triggered by clicking the home icon in the mode bar (or via zoom/pan). The <code>highlight()</code> function can also be used to control <a href="linking-views-without-shiny.html#transient-versus-persistent-selection">Transient versus persistent selection</a> modes, and dynamically control selection colors, which is very useful for making comparisons.</p>
<!--
TODO: Talk about the convenience of having "standard" events generated across chart types. When working with something like D3, you typically have to bind to DOM elements when attaching listeners, which does not generalize well.
-->
<p>Figure <a href="linking-views-without-shiny.html#fig:linked-ggally">4.5</a> shows another example of using <code>SharedData</code> objects to link multiple views, this time to enable linked brushing in a scatterplot matrix via the <code>ggpairs()</code> function from the <strong>GGally</strong> package. As discussed in <a href="scatter-traces.html#scatterplot-matrices">Scatterplot matrices</a>, the <code>ggpairs()</code> function implements the generalized pairs plot – a generalization of the scatterplot matrix – an incredibly useful tool for exploratory data analysis. Since the <code>Species</code> variable (as discrete variable) is mapped to color in Figure <a href="linking-views-without-shiny.html#fig:linked-ggally">4.5</a>, we can inspect both correlations, and marginal densities, dependent upon Species type. By adding the brushing capabilities via <code>ggplotly()</code>, we add the ability to examine the dependence between a continuous conditional distribution and other variables. For this type of interaction, a unique key should be attached to each observation in the original data, which is the default behavior of the <code>SharedData</code> object’s <code>new()</code> method when no key is provided.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(iris)
p &lt;-<span class="st"> </span>GGally::<span class="kw">ggpairs</span>(d, <span class="kw">aes</span>(<span class="dt">color =</span> Species), <span class="dt">columns =</span> <span class="dv">1</span>:<span class="dv">4</span>)
<span class="kw">layout</span>(<span class="kw">ggplotly</span>(p), <span class="dt">dragmode =</span> <span class="st">&quot;select&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:linked-ggally"></span>
<img src="images/plotlyGGally.gif" alt="Brushing a scatterplot matrix via the `ggpairs()` function in the **GGally** package. A video demonstrating the graphical queries can be viewed [here](http://i.imgur.com/dPTtH3H.gif)" width="700" align:"center" />
<p class="caption">
Figure 4.5: Brushing a scatterplot matrix via the <code>ggpairs()</code> function in the <strong>GGally</strong> package. A video demonstrating the graphical queries can be viewed <a href="http://i.imgur.com/dPTtH3H.gif">here</a>
</p>
</div>
<p>When the graphical query is made is <a href="linking-views-without-shiny.html#fig:linked-ggally">4.5</a>, the marginal densities do not update. This points out one of the weaknesses of implementing multiple linked views without shiny (or some other R backend). The browser knows nothing about the algorithm <strong>GGally</strong> (or <strong>ggplot2</strong>) uses to compute a density, so updating the densities in a consistent way is not realistic without being able to call R from the browser. It is true that we could try to precompute densities for every possible selection state, but this does not generally scale well when the number of selection states is large, even as large as Figure <a href="linking-views-without-shiny.html#fig:linked-ggally">4.5</a>. As discussed briefly in <a href="bars-histograms.html#bars-histograms">bars &amp; histograms</a>, <a href="boxplots.html#boxplots">Boxplots</a>, and <a href="#2D-distributions">2D distributions</a>, plotly.js does have some statistical functionality that we can leverage to display <a href="linking-views-without-shiny.html#dynamic-aggregates">Dynamic aggregates</a>, but this currently covers only a few types of statistical displays.</p>
</div>
<div id="transient-versus-persistent-selection" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Transient versus persistent selection</h3>
<p>The examples in the previous section use transient selection, meaning that when a value is selected, previous selection(s) are forgotten. Sometimes it is more useful to allow selections to accumulate – a type of selection known as persistent selection. To demonstrate the difference, Figure <a href="linking-views-without-shiny.html#fig:persistent">4.6</a> presents two different takes a single view, one with transient selection (on the left) and one with persistent selection (on the right). Both selection modes can be used when linking multiple views, but as Figure <a href="linking-views-without-shiny.html#fig:persistent">4.6</a> shows, highlighting graphical elements, even in a single view, can be useful tool to avoid overplotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sd &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(txhousing, ~city)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sd, <span class="kw">aes</span>(date, median)) +<span class="st"> </span><span class="kw">geom_line</span>()
gg &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;city&quot;</span>)

<span class="kw">highlight</span>(gg, <span class="dt">on =</span> <span class="st">&quot;plotly_hover&quot;</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>)
<span class="kw">highlight</span>(gg, <span class="dt">on =</span> <span class="st">&quot;plotly_hover&quot;</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>, <span class="dt">persistent =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure"><span id="fig:persistent"></span>
<img src="images/transientVsPersist.gif" alt="Highlighting lines with transient versus persistent selection. In the left hand panel, transient selection (the default); and in the right hand panel, persistent selection. The video may be accessed [here](http://i.imgur.com/WyBmdv3.gif)" width="700" align:"center" />
<p class="caption">
Figure 4.6: Highlighting lines with transient versus persistent selection. In the left hand panel, transient selection (the default); and in the right hand panel, persistent selection. The video may be accessed <a href="http://i.imgur.com/WyBmdv3.gif">here</a>
</p>
</div>
<p>Figure <a href="linking-views-without-shiny.html#fig:persistent">4.6</a> also sets the <code>dynamic</code> argument to <code>TRUE</code> to populate a widget, powered by the <strong>colourpicker</strong> package <span class="citation">(Attali <a href="#ref-colourpicker">2016</a>)</span>, for dynamically altering the selection color. When paired with persistent selection, this makes for a powerful tool for making comparisons between two selection sets. However, for Figure <a href="linking-views-without-shiny.html#fig:persistent">4.6</a>, transient selection is probably the better mode for an initial look at the data (to help reveal any structure in missingness or anomalies for a given city), whereas persistent selection is better for making comparisons once have a better idea of what cities might be interesting to compare.</p>
</div>
<div id="linking-with-other-htmlwidgets" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Linking with other htmlwidgets</h3>
<p>Perhaps the most exciting thing about building a linked views framework on top of the <strong>crosstalk</strong> package is that it provides a standardized protocol for working with selections that other <strong>htmlwidget</strong> packages may build upon. If implemented carefully, this effectively provides a way to link views between two independent graphical systems – a fairly foreign technique within the realm of interactive statistical graphics. This grants a tremendous amount of power to the analyst since she/he may leverage the strengths of multiple systems in a single linked views analysis. Figure <a href="linking-views-without-shiny.html#fig:leaflet">4.7</a> shows an example of linked views between plotly and leaflet for exploring the relationship between the magnitude and geographic location of earthquakes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
<span class="kw">library</span>(leaflet)

sd &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(quakes)

p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(sd, <span class="dt">x =</span> ~depth, <span class="dt">y =</span> ~mag) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) %&gt;%
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">dragmode =</span> <span class="st">&quot;select&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">highlight</span>(<span class="dt">dynamic =</span> <span class="ot">TRUE</span>, <span class="dt">persistent =</span> <span class="ot">TRUE</span>)

map &lt;-<span class="st"> </span><span class="kw">leaflet</span>(sd) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">addCircles</span>()

htmltools::<span class="kw">tagList</span>(p, map)</code></pre></div>
<div class="figure"><span id="fig:leaflet"></span>
<img src="images/plotlyLeaflet.gif" alt="Linking views between plotly and leaflet to explore the relation between magnitude and geographic location of earthquakes around Fiji. The video may be accessed [here](http://i.imgur.com/hd0tG0r.gif)" width="700" align:"center" />
<p class="caption">
Figure 4.7: Linking views between plotly and leaflet to explore the relation between magnitude and geographic location of earthquakes around Fiji. The video may be accessed <a href="http://i.imgur.com/hd0tG0r.gif">here</a>
</p>
</div>
<p>In Figure <a href="linking-views-without-shiny.html#fig:leaflet">4.7</a>, the user first highlights earthquakes with a magnitude of 5 or higher in red (via plotly), then earthquakes with a magnitude of 4.5 or lower, and the corresponding earthquakes are highlighted in the leaflet map. This immediately reveals an interesting relationship in magnitude and geographic location, and leaflet provides the ability to zoom and pan on the map to investigate regions that have a high density of quakes. It’s worth noting that the <strong>crosstalk</strong> package itself does not provide semantics for describing persistent/dynamic selections, but <strong>plotly</strong> does inform crosstalk about these semantics which other <strong>htmlwidget</strong> authors can access in their JavaScript rendering logic.</p>
</div>
<div id="selection-via-indirect-manipulation" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Selection via indirect manipulation</h3>
<p>The interactions described thus far in <a href="linking-views-without-shiny.html#linking-views-without-shiny">Linking views without shiny</a> is what <span class="citation">Cook and Swayne (<a href="#ref-ggobi:2007">2007</a>)</span> calls direct manipulation, where the user makes graphical queries by directly interacting with graphical elements. In Figure <a href="linking-views-without-shiny.html#fig:indirect-manip">4.8</a>, cities are queried indirectly via a dropdown powered by the selectize.js library <span class="citation">(B. R. &amp; Contributors <a href="#ref-selectizejs">2016</a>)</span>. Indirect manipulation is especially useful when you have unit(s) of interest (e.g. your favorite city), but can not easily find that unit in the graphical space. The combination of direct and indirect manipulation is powerful, especially when the interactive widgets for indirect manipulation are synced with direct manipulation events. As shown in Figure <a href="linking-views-without-shiny.html#fig:indirect-manip">4.8</a>, when cities are queried indirectly, the graph updates accordingly, and when cities are queried directly, the select box updates accordingly. If the time series was linked to other view(s), as it is in the next section, selecting a city via the dropdown menu would highlight all of the relevant view(s).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The group name is currently used to populate a title for the selectize widget</span>
sd &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(txhousing, ~city, <span class="st">&quot;Choose a city&quot;</span>)
<span class="kw">plot_ly</span>(sd, <span class="dt">x =</span> ~date, <span class="dt">y =</span> ~median) %&gt;%
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">text =</span> ~city, <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">highlight</span>(<span class="dt">on =</span> <span class="st">&quot;plotly_hover&quot;</span>, <span class="dt">persistent =</span> <span class="ot">TRUE</span>, <span class="dt">selectize =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure"><span id="fig:indirect-manip"></span>
<img src="images/plotlySelectize.gif" alt="Selecting cities by indirect manipulation. The video may be accessed [here]()" width="700" align:"center" />
<p class="caption">
Figure 4.8: Selecting cities by indirect manipulation. The video may be accessed <a href="">here</a>
</p>
</div>
</div>
<div id="the-shareddata-plot-pipeline" class="section level3">
<h3><span class="header-section-number">4.2.5</span> The SharedData plot pipeline</h3>
<p>Sometimes it is useful to display a summary (i.e., overview) in one view and link that summary to more detailed views. Figure <a href="linking-views-without-shiny.html#fig:bars-lines">4.9</a> is one such example that displays a bar chart of all Texan cities with one or more missing values (the summary) linked with their values over time (the details). By default, the bar chart allows us to quickly see which cities have the most missing values, and by clicking a specific bar, it reveals the relationship between missing values and time for a given city. In cities with the most missing values, data did not start appearing until somewhere around 2006-2010, but for most other cities (e.g., Harlingen, Galveston, Temple-Belton, etc), values started appearing in 2000, but for some reason go missing around 2002-2003.</p>
<div class="figure"><span id="fig:bars-lines"></span>
<img src="images/plotlyLinkedBars.gif" alt="A bar chart of cities with one or more missing median house sales linked to a time series of those sales over time. The video may be accessed [here](http://i.imgur.com/hzVe2FR.gif)" width="700" align:"center" />
<p class="caption">
Figure 4.9: A bar chart of cities with one or more missing median house sales linked to a time series of those sales over time. The video may be accessed <a href="http://i.imgur.com/hzVe2FR.gif">here</a>
</p>
</div>
<p>When implementing linked views like Figure <a href="linking-views-without-shiny.html#fig:bars-lines">4.9</a>, it can be helpful to conceptualize a pipeline between a central data frame and the corresponding views. Figure <a href="linking-views-without-shiny.html#fig:pipeline">4.10</a> is a visual depiction of this conceptual model between the central data frame and the eventual linked views in Figure <a href="linking-views-without-shiny.html#fig:bars-lines">4.9</a>. In order to generate the bar chart on the left, the pipeline contains a function for computing summary statistics (the number of missing values per city). On the other hand, the time series does not require any summarization – implying the pipeline for this view is the identity function.</p>
<div class="figure"><span id="fig:pipeline"></span>
<img src="images/pipeline.png" alt="A diagram of the pipeline between the data and graphics." width="700" align:"center" />
<p class="caption">
Figure 4.10: A diagram of the pipeline between the data and graphics.
</p>
</div>
<p>Since the pipeline from data to graphic is either an identity function or a summarization of some kind, it is good idea to use the most granular form of the data for the <code>SharedData</code> object, and use <a href="a-case-study-of-housing-sales-in-texas.html#the-data-plot-pipeline">the data-plot-pipeline</a> to define a pipeline from the data to the plot. As <span class="citation">Wickham et al. (<a href="#ref-plumbing">2010</a>)</span> writes, a true interactive graphics system is aware of the both the function from the central data object to the graphic, as well as the inverse function (i.e., the function from the graphic back to the central data object). As it currently stands, <strong>plotly</strong> loses this information when the result is pushed to the web browser, but that does not matter for Figure <a href="linking-views-without-shiny.html#fig:bars-lines">4.9</a> since pipelines do not have to re-execute upon user selections.<a href="#fn14" class="footnoteRef" id="fnref14"><sup>14</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sd &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(txhousing, ~city)

base &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(sd, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(city)

p1 &lt;-<span class="st"> </span>base %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">has =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(median))) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(has &gt;<span class="st"> </span><span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(has) %&gt;%
<span class="st">  </span><span class="kw">add_bars</span>(<span class="dt">x =</span> ~has, <span class="dt">y =</span> ~<span class="kw">factor</span>(city, <span class="dt">levels =</span> city), <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">layout</span>(
    <span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Number of months missing&quot;</span>),
    <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>)
  ) 

p2 &lt;-<span class="st"> </span>base %&gt;%
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">x =</span> ~date, <span class="dt">y =</span> ~median, <span class="dt">alpha =</span> <span class="fl">0.3</span>) %&gt;%
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>))

<span class="kw">subplot</span>(p1, p2, <span class="dt">titleX =</span> <span class="ot">TRUE</span>, <span class="dt">widths =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">margin =</span> <span class="kw">list</span>(<span class="dt">l =</span> <span class="dv">120</span>)) %&gt;%
<span class="st">  </span><span class="kw">highlight</span>(<span class="dt">on =</span> <span class="st">&quot;plotly_click&quot;</span>, <span class="dt">off =</span> <span class="st">&quot;plotly_unhover&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
</div>
<div id="dynamic-aggregates" class="section level3">
<h3><span class="header-section-number">4.2.6</span> Dynamic aggregates</h3>
<p>As discussed in the plotly cookbook, there are a number of way to compute statistical summaries in the browser via plotly.js (e.g., <code>add_histogram()</code>, <code>add_boxplot()</code>, <code>add_histogram2d()</code>, and <code>add_histogram2dcontour()</code>). When linking views with the <strong>plotly</strong> package, we can take advantage of this functionality to display aggregated views of selections. Figure <a href="linking-views-without-shiny.html#fig:highlight-boxplot">4.11</a> shows a basic example of brushing a scatterplot to select cars with 10-20 miles per gallon, then a 5 number summary of the corresponding engine displacement is dynamically computed and displayed as a boxplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(mtcars)
scatterplot &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(d, <span class="dt">x =</span> ~mpg, <span class="dt">y =</span> ~disp) %&gt;%
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">dragmode =</span> <span class="st">&quot;select&quot;</span>)

<span class="kw">subplot</span>(
  <span class="kw">plot_ly</span>(d, <span class="dt">y =</span> ~disp, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) %&gt;%<span class="st"> </span><span class="kw">add_boxplot</span>(<span class="dt">name =</span> <span class="st">&quot;overall&quot;</span>),
  scatterplot, <span class="dt">shareY =</span> <span class="ot">TRUE</span>
) %&gt;%<span class="st"> </span><span class="kw">layout</span>(<span class="dt">dragmode =</span> <span class="st">&quot;select&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:highlight-boxplot"></span>
<img src="images/highlight-boxplot.gif" alt="Dynamically populating a boxplot reflecting brushed observations" width="700" align:"center" />
<p class="caption">
Figure 4.11: Dynamically populating a boxplot reflecting brushed observations
</p>
</div>
<p>Figure <a href="linking-views-without-shiny.html#fig:highlight-boxplot">4.11</a> is very similar to Figure <a href="linking-views-without-shiny.html#fig:highlight-bars">4.12</a>, but uses <code>add_histogram()</code> to link to a bar chart of the number of cylinders rather than a boxplot of engine displacement. By brushing to select cars with a low engine displacement, we can see that (obviously) displacement is related with to the number of cylinders.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">subplot</span>(
  <span class="kw">plot_ly</span>(d, <span class="dt">x =</span> ~<span class="kw">factor</span>(vs)) %&gt;%<span class="st"> </span><span class="kw">add_histogram</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)),
  scatterplot
) 

<span class="co"># Selections are actually additional traces, and, by default, </span>
<span class="co"># plotly.js will try to dodge bars placed under the same category</span>
<span class="kw">layout</span>(p, <span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:highlight-bars"></span>
<img src="images/highlight-bars.gif" alt="Dynamically populating a bar chart reflecting brushed observations" width="700" align:"center" />
<p class="caption">
Figure 4.12: Dynamically populating a bar chart reflecting brushed observations
</p>
</div>
</div>
<div id="nested-selections" class="section level3">
<h3><span class="header-section-number">4.2.7</span> Nested selections</h3>
<div id="grouped-selections-via-ggplotly" class="section level4">
<h4><span class="header-section-number">4.2.7.1</span> Grouped selections via <code>ggplotly()</code></h4>
<p>In statistical graphics, it is quite common for a graphical element to be tied to multiple observations. For example, a line representing the fitted values from a linear model is inherently connected to the observations used to fit the model. In fact, any graphical summary (e.g. boxplot, histogram, density, etc.) can be linked back the original data used to derive them. Especially when comparing multiple summaries, it can be useful to highlight group(s) of summaries, as well as the raw data that created them. Figure <a href="linking-views-without-shiny.html#fig:smooth-highlight">4.13</a> uses <code>ggplotly()</code>’s built-in support for linking graphical summaries with raw data to enable highlighting of linear models.<a href="#fn15" class="footnoteRef" id="fnref15"><sup>15</sup></a> Furthermore, notice how there are actually two levels of selection in Figure <a href="linking-views-without-shiny.html#fig:smooth-highlight">4.13</a> – when hovering over a single point, just that point is selected, but when hovering over a fitted line, all the observations tied to that line are selected.</p>
<!--
Figure \@ref(fig:bars-lines) is one such example where each bar (i.e., each city) is tied to multiple observations (i.e., monthly sales within city). In that example, the group and key variables are the same (`city`), but what happens when they are different? In the case that a key variable is _nested_ inside a **ggplot2** group, `ggplotly()` will automatically track each group.
-->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># if you don&#39;t want to highlight individual points, you could specify</span>
<span class="co"># `class` as the key variable here, instead of the default (rownames)</span>
m &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(mpg)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> class)) +
<span class="st">    </span><span class="kw">geom_point</span>() +
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)
<span class="kw">ggplotly</span>(p) %&gt;%<span class="st"> </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_hover&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:smooth-highlight"></span>
<img src="images/smooth-highlight.gif" alt="Engine displacement versus highway miles per gallon by class of car. The linear model for each class, as well as the individual observations, can be selected by hovering over the line of fitted values. An individual observation can also be selected by hovering over the relevant point." width="700" align:"center" />
<p class="caption">
Figure 4.13: Engine displacement versus highway miles per gallon by class of car. The linear model for each class, as well as the individual observations, can be selected by hovering over the line of fitted values. An individual observation can also be selected by hovering over the relevant point.
</p>
</div>
<p>At first, it might not seem as though “nested” selections are that useful. After all, the highlighting of individual points in Figure <a href="linking-views-without-shiny.html#fig:smooth-highlight">4.13</a> does not supply us with any additional information. However, applying this same idea to multiple views of the same observations can be quite useful. Figure <a href="linking-views-without-shiny.html#fig:ggnostic">4.14</a> demonstrates a useful application via the <code>ggnostic()</code> function from the <strong>GGally</strong> package <span class="citation">(Schloerke et al. <a href="#ref-GGally">2016</a>)</span>. This function produces a matrix of diagnostic plots from a fitted model object, with different diagnostic measures in each row, and different explanatory variables in each column. Figure <a href="linking-views-without-shiny.html#fig:ggnostic">4.14</a> shows the default display for a linear model, which includes residuals (<code>resid</code>), estimates of residual standard deviation when a particular observation is excluded (<code>sigma</code>), diagonals from the projection matrix (<code>hat</code>), and cooks distance (<code>cooksd</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for better tick labels</span>
mtcars$am &lt;-<span class="st"> </span>dplyr::<span class="kw">recode</span>(mtcars$am, <span class="st">`</span><span class="dt">0</span><span class="st">`</span> =<span class="st"> &quot;automatic&quot;</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> &quot;manual&quot;</span>)
<span class="co"># choose a model by AIC stepping backwards </span>
mod &lt;-<span class="st"> </span><span class="kw">step</span>(<span class="kw">lm</span>(mpg ~<span class="st"> </span>., <span class="dt">data =</span> mtcars), <span class="dt">trace =</span> <span class="ot">FALSE</span>)
<span class="co"># produce diagnostic plots, coloring by automatic/manual</span>
pm &lt;-<span class="st"> </span>GGally::<span class="kw">ggnostic</span>(mod, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> am))
<span class="co"># ggplotly() will automatically add rownames as a key if none is provided</span>
<span class="kw">ggplotly</span>(pm) %&gt;%<span class="st"> </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_click&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:ggnostic"></span>
<img src="images/ggnostic.gif" alt="Using nested selections to highlight numerous diagnostics from different regions of the design matrix." width="700" align:"center" />
<p class="caption">
Figure 4.14: Using nested selections to highlight numerous diagnostics from different regions of the design matrix.
</p>
</div>
<p>Injecting interactivity into <code>ggnostic()</code> via <code>ggplotly()</code> enhances the diagnostic plot in at least two ways. Coloring by a factor variable in the model allows us to highlight that region of the design matrix by selecting a relevant statistical summary, which can help avoid overplotting when dealing with numerous factor levels. For example, in Figure <a href="linking-views-without-shiny.html#fig:ggnostic">4.14</a>, the user first highlights diagnostics for cars with manual transmission (in blue), then cars with automatic transmission (in red). Perhaps more widely useful is the ability to highlight individual observations since most of these diagnostics are designed to identify highly influential or unusual observations.</p>
<p>In Figure <a href="linking-views-without-shiny.html#fig:ggnostic">4.14</a>, there is one observation with a noticeably high value of <code>cooksd</code>, which suggests the observation has a large influence on the fitted model. Clicking on that point highlights its corresponding diagnostic measures, plotted against each explanatory variable. Doing so makes it obvious that this observation is influential since it has a unusually high response/residual in a fairly sparse region of the design space (i.e., it has a pretty high value of <code>wt</code>) and removing it would significantly reduce the estimated standard deviation (<code>sigma</code>). By comparison, the other two observations with similar values of <code>wt</code> have a response value very close to the overall mean, so even though their value of <code>hat</code> is high, their value of <code>sigma</code> is low.</p>
<p>Highlighting groups via fitted lines is certainly useful, but it is not the only way to highlight groups via a graphical summary. In fact, anytime a key variable is supplied to <strong>ggplot2</strong> layer with a non-identity statistic, it automatically attaches all the unique key values tied to all the observations that went into creating the group – enabling linked selections between raw and aggregated forms of the data. For example, Figure <a href="linking-views-without-shiny.html#fig:density2scatter">4.15</a> links several density estimates back to the original data, and by clicking on a particular density estimate, it highlights all of the observations associated with that group. Yet again, this is an effective strategy to combat overplotting by bring groups of interests to the foreground of the graphic.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span>SharedData$<span class="kw">new</span>(mpg)
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, <span class="dt">fill =</span> class)) +<span class="st"> </span><span class="kw">geom_density</span>()
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, hwy, <span class="dt">fill =</span> class)) +<span class="st"> </span><span class="kw">geom_point</span>()
<span class="kw">subplot</span>(p1, p2) %&gt;%<span class="st"> </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_click&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">hide_legend</span>()</code></pre></div>
<div class="figure"><span id="fig:density2scatter"></span>
<img src="images/density2scatter.gif" alt="Clicking on a density estimate to highlight all the raw observations that went into that estimate." width="700" align:"center" />
<p class="caption">
Figure 4.15: Clicking on a density estimate to highlight all the raw observations that went into that estimate.
</p>
</div>
<!--
All of the sections under [linking views without shiny](#linking-views-without-shiny) thus far have attached a _single value_ to a graphical mark or group of marks. In mathematical terms, this implies that the mapping from visual space to data space can be described through a surjective function. However, there are also situations where it is useful to attach numerous key values to a graphical mark (i.e. nested keys). 
-->
</div>
<div id="hierarchical-selection" class="section level4">
<h4><span class="header-section-number">4.2.7.2</span> Hierarchical selection</h4>
<p>In the previous section, we leveraged <code>ggplotly()</code>’s ability to attach multiple key values to a graphical object to perform “grouped selections” on statistical objects (e.g., selecting a density estimate selects all the corresponding observations). In all those examples, groups are distinct (specifically, no one observation can be an input to more than one group), so what happens when groups are not distinct? Under the hood, <strong>plotly</strong> considers each graphical mark to be a “group”, in the sense that a <em>set of element(s)/value(s)</em> can be associated with each mark. Given selected mark(s) (i.e. groups of interest), it considers any subset of the selection(s) to be match, leading to a notion of hierarchical selection. For a simple example, suppose I have 4 (x, y) pairs, and each pair is associated with a different set of categorical values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data frames do support list columns,</span>
<span class="co"># but tibble::tibble() provides a nicer API for this...</span>
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>:<span class="dv">4</span>, <span class="dt">y =</span> <span class="dv">1</span>:<span class="dv">4</span>)
d$key &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:<span class="dv">4</span>, function(x) letters[<span class="kw">seq_len</span>(x)])
d
<span class="co">#&gt;   x y        key</span>
<span class="co">#&gt; 1 1 1          a</span>
<span class="co">#&gt; 2 2 2       a, b</span>
<span class="co">#&gt; 3 3 3    a, b, c</span>
<span class="co">#&gt; 4 4 4 a, b, c, d</span></code></pre></div>
<p>Suppose point (3, 3) is selected – implying the set <span class="math inline">\(\{ a, b, c \}\)</span> is of interest – what key sets should be considered a match? The most sensible approach is to match any subsets of the selected set, so for example, this key set would match the sets <span class="math inline">\(\{ a \}\)</span>, <span class="math inline">\(\{ b \}\)</span>, <span class="math inline">\(\{ c \}\)</span>, <span class="math inline">\(\{ a, b \}\)</span>, <span class="math inline">\(\{ a, c \}\)</span>, and <span class="math inline">\(\{ b, c \}\)</span>. This leads to a type of selection I will refer to as <em>hierarchical</em> selection. Figure <a href="linking-views-without-shiny.html#fig:hierarchical">4.16</a> provides a visual demo of this example in action:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SharedData$<span class="kw">new</span>(d, ~key) %&gt;%
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> ~x, <span class="dt">y =</span> ~y)</code></pre></div>
<div class="figure"><span id="fig:hierarchical"></span>
<img src="images/hierarchical.gif" alt="A simple example of hierarchial selection" width="700" align:"center" />
<p class="caption">
Figure 4.16: A simple example of hierarchial selection
</p>
</div>
<p>Another way to think of hierarchical selection is to select all the “children” of a given “parent” node, which has a natural extension to dendrograms as <a href="linking-views-without-shiny.html#fig:dendro">4.17</a> demonstrates:</p>
<div class="figure"><span id="fig:dendro"></span>
<img src="images/dendro.gif" alt="Leveraging hierarchical selection and persistent brushing to paint branches of a dendrogram." width="700" align:"center" />
<p class="caption">
Figure 4.17: Leveraging hierarchical selection and persistent brushing to paint branches of a dendrogram.
</p>
</div>
</div>
</div>
<div id="more-examples" class="section level3">
<h3><span class="header-section-number">4.2.8</span> More examples</h3>
<p>The <strong>plotly</strong> package bundles a bunch of demos that illustrate all the options available when linking views without <strong>shiny</strong> via <strong>crosstalk</strong>’s <code>SharedData</code> class and <strong>plotly</strong>’s <code>highlight()</code> function. To list all the examples, enter <code>demo(package = &quot;plotly&quot;)</code> into your R prompt, and pick a topic (e.g., <code>demo(&quot;highlight-intro&quot;, package = &quot;plotly&quot;)</code>).</p>
</div>
<div id="limitations" class="section level3">
<h3><span class="header-section-number">4.2.9</span> Limitations</h3>
<p>In terms of <a href="linking-views-without-shiny.html#linking-views-without-shiny">linking views without shiny</a>, the biggest limitation is the lack of ability to perform statistical aggregations in real time based on user queries. For example, Figure <a href="linking-animated-views.html#fig:animation-gapminder">5.6</a> could be improved by layering on a linear model specific to the user selection, to make it easier to compare and track those relationships over time. In this case, one may want to opt into <a href="linking-views-without-shiny.html#linking-views-without-shiny">linking views with shiny</a> to trigger the execution of R code in response to a user query. Also, at least currently, there are a limited number of selection modes to choose from (e.g., XOR, COMPLEMENT modes are not yet supported), but these modes can also be implemented within a shiny app (the <a href="https://github.com/ropensci/plotly/blob/cd93ab303efa56007b8bba725bab140e8a8aae39/inst/examples/lmGadget/app.R">lmGadget</a> shiny gadget would be one such example of XOR selection).</p>
<!--

* Currently leaflet is the only htmlwidget, with crosstalk support, that will respect non-default arguments in plotly's highlight() function.

As discussed in previous chapters, **plotly** graphs have zoom, pan, and identification type interactions enabled by default. This chapter discusses methods that enable other types of useful interactions listed in Table \@ref(tab:techniques).
-->

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-crosstalk">
<p>Cheng, Joe. 2016. <em>Crosstalk: Inter-Widget Interactivity for Html Widgets</em>.</p>
</div>
<div id="ref-colourpicker">
<p>Attali, Dean. 2016. <em>Colourpicker: A Colour Picker Widget for Shiny Apps, Rstudio, R-Markdown, and ’Htmlwidgets’</em>. <a href="https://CRAN.R-project.org/package=colourpicker" class="uri">https://CRAN.R-project.org/package=colourpicker</a>.</p>
</div>
<div id="ref-ggobi:2007">
<p>Cook, Dianne, and Deborah F. Swayne. 2007. <em>Interactive and Dynamic Graphics for Data Analysis : With R and Ggobi</em>. Use R ! New York: Springer. <a href="http://www.ggobi.org/book/" class="uri">http://www.ggobi.org/book/</a>.</p>
</div>
<div id="ref-selectizejs">
<p>Contributors, Brian Reavis &amp;. 2016. “Selectize Is an Extensible JQuery-Based Custom &lt;select&gt; Ui Control.” <a href="https://github.com/selectize/selectize.js" class="uri">https://github.com/selectize/selectize.js</a>.</p>
</div>
<div id="ref-plumbing">
<p>Wickham, Hadley, Michael Lawrence, Dianne Cook, Andreas Buja, Heike Hofmann, and Deborah F Swayne. 2010. “The Plumbing of Interactive Graphics.” <em>Computational Statistics</em>, April, 1–7.</p>
</div>
<div id="ref-GGally">
<p>Schloerke, Barret, Jason Crowley, Di Cook, Francois Briatte, Moritz Marbach, Edwin Thoen, Amos Elberg, and Joseph Larmarange. 2016. <em>GGally: Extension to ’Ggplot2’</em>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p>Since <strong>dplyr</strong> semantics translate to <code>SQL</code> primitives, you could imagine a system that translates a data-plot-pipeline to <code>SQL</code> queries, and dynamically re-executes within the browser via something like <code>SQL.js</code> <span class="citation">(O. L. &amp; Contributors <a href="#ref-SQLjs">2016</a>)</span>.<a href="linking-views-without-shiny.html#fnref14">↩</a></p></li>
<li id="fn15"><p>Strictly speaking, as long as a key is provided to a <strong>ggplot2</strong> layer with a non-identity statistic, <code>ggplotly()</code> will nest keys within group.<a href="linking-views-without-shiny.html#fnref15">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linking-views-with-shiny.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="animating-views.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/linked-views.Rmd",
"text": "Edit"
},
"download": ["plotly_book.pdf", "plotly_book.epub", "plotly_book.mobi"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-39373211-1', 'auto');ga('send', 'pageview');</script>
</body>

</html>
