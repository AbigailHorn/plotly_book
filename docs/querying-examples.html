<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5.3 Examples | plotly for R</title>
  <meta name="description" content="An overview of the R package plotly">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5.3 Examples | plotly for R />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://ropensci.github.io/plotly/" />
  <meta property="og:image" content="http://ropensci.github.io/plotly/images/plotly.png" />
  <meta property="og:description" content="An overview of the R package plotly" />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.3 Examples | plotly for R />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="An overview of the R package plotly" />
  <meta name="twitter:image" content="http://ropensci.github.io/plotly/images/plotly.png" />

<meta name="author" content="Carson Sievert">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="filter.html">
<link rel="next" href="limitations.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/jsoneditor/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding/jsonedit.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap/js/bootstrap.min.js"></script>
<link href="libs/ionrangeslider/css/ion.rangeSlider.css" rel="stylesheet" />
<link href="libs/ionrangeslider/css/ion.rangeSlider.skinShiny.css" rel="stylesheet" />
<script src="libs/ionrangeslider/js/ion.rangeSlider.min.js"></script>
<script src="libs/strftime/strftime-min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="get-started.html"><a href="get-started.html"><i class="fa fa-check"></i>Get started</a></li>
<li class="chapter" data-level="" data-path="plot-ly-for-collaboration.html"><a href="plot-ly-for-collaboration.html"><i class="fa fa-check"></i>plot.ly for collaboration</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="two-approaches-one-object.html"><a href="two-approaches-one-object.html"><i class="fa fa-check"></i><b>1</b> Two approaches, one object</a><ul>
<li class="chapter" data-level="1.1" data-path="txhousing-case-study.html"><a href="txhousing-case-study.html"><i class="fa fa-check"></i><b>1.1</b> A case study of housing sales in Texas</a><ul>
<li class="chapter" data-level="1.1.1" data-path="txhousing-case-study.html"><a href="txhousing-case-study.html#ggplotly"><i class="fa fa-check"></i><b>1.1.1</b> The <code>ggplotly()</code> function</a></li>
<li class="chapter" data-level="1.1.2" data-path="txhousing-case-study.html"><a href="txhousing-case-study.html#the-plot_ly-interface"><i class="fa fa-check"></i><b>1.1.2</b> The <code>plot_ly()</code> interface</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html"><i class="fa fa-check"></i><b>1.2</b> Extending <code>ggplotly()</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#customizing-the-layout"><i class="fa fa-check"></i><b>1.2.1</b> Customizing the layout</a></li>
<li class="chapter" data-level="1.2.2" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#modifying-layers"><i class="fa fa-check"></i><b>1.2.2</b> Modifying layers</a></li>
<li class="chapter" data-level="1.2.3" data-path="extending-ggplotly.html"><a href="extending-ggplotly.html#leveraging-statistical-output"><i class="fa fa-check"></i><b>1.2.3</b> Leveraging statistical output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-plotly-cookbook.html"><a href="the-plotly-cookbook.html"><i class="fa fa-check"></i><b>2</b> The plotly cookbook</a><ul>
<li class="chapter" data-level="2.1" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>2.1</b> Scatter traces</a><ul>
<li class="chapter" data-level="2.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#scatterplots"><i class="fa fa-check"></i><b>2.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="2.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#dotplots-error-bars"><i class="fa fa-check"></i><b>2.1.2</b> Dotplots &amp; error bars</a></li>
<li class="chapter" data-level="2.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#line-plots"><i class="fa fa-check"></i><b>2.1.3</b> Line plots</a></li>
<li class="chapter" data-level="2.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>2.1.4</b> Segments</a></li>
<li class="chapter" data-level="2.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>2.1.5</b> Ribbons</a></li>
<li class="chapter" data-level="2.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>2.1.6</b> Polygons</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>2.2</b> Maps</a><ul>
<li class="chapter" data-level="2.2.1" data-path="maps.html"><a href="maps.html#using-scatter-traces"><i class="fa fa-check"></i><b>2.2.1</b> Using scatter traces</a></li>
<li class="chapter" data-level="2.2.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>2.2.2</b> Choropleths</a></li>
<li class="chapter" data-level="2.2.3" data-path="maps.html"><a href="maps.html#using-geom_sf"><i class="fa fa-check"></i><b>2.2.3</b> Using <code>geom_sf()</code></a></li>
<li class="chapter" data-level="2.2.4" data-path="maps.html"><a href="maps.html#using-ggmap"><i class="fa fa-check"></i><b>2.2.4</b> Using ggmap</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>2.3</b> Bars &amp; histograms</a><ul>
<li class="chapter" data-level="2.3.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>2.3.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="2.3.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>2.3.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>2.4</b> Boxplots</a></li>
<li class="chapter" data-level="2.5" data-path="d-frequencies.html"><a href="d-frequencies.html"><i class="fa fa-check"></i><b>2.5</b> 2D frequencies</a><ul>
<li class="chapter" data-level="2.5.1" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>2.5.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="2.5.2" data-path="d-frequencies.html"><a href="d-frequencies.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>2.5.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="2.5.3" data-path="d-frequencies.html"><a href="d-frequencies.html#categorical-axes"><i class="fa fa-check"></i><b>2.5.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="other-3d-plots.html"><a href="other-3d-plots.html"><i class="fa fa-check"></i><b>2.6</b> Other 3D plots</a></li>
<li class="chapter" data-level="2.7" data-path="raster-images.html"><a href="raster-images.html"><i class="fa fa-check"></i><b>2.7</b> Raster images</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="whats-a-data-view.html"><a href="whats-a-data-view.html"><i class="fa fa-check"></i><b>3</b> What’s a data view?</a></li>
<li class="chapter" data-level="4" data-path="arranging-multiple-views.html"><a href="arranging-multiple-views.html"><i class="fa fa-check"></i><b>4</b> Arranging multiple views</a><ul>
<li class="chapter" data-level="4.1" data-path="arranging-htmlwidgets.html"><a href="arranging-htmlwidgets.html"><i class="fa fa-check"></i><b>4.1</b> Arranging htmlwidgets</a></li>
<li class="chapter" data-level="4.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html"><i class="fa fa-check"></i><b>4.2</b> Merging plotly objects</a><ul>
<li class="chapter" data-level="4.2.1" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#recursive-subplots"><i class="fa fa-check"></i><b>4.2.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="4.2.2" data-path="merging-plotly-objects.html"><a href="merging-plotly-objects.html#ggplot2-subplots"><i class="fa fa-check"></i><b>4.2.2</b> ggplot2 subplots</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="navigating-many-views.html"><a href="navigating-many-views.html"><i class="fa fa-check"></i><b>4.3</b> Navigating many views</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linking-views-client-side.html"><a href="linking-views-client-side.html"><i class="fa fa-check"></i><b>5</b> Linking views client-side</a><ul>
<li class="chapter" data-level="5.1" data-path="graphical-queries.html"><a href="graphical-queries.html"><i class="fa fa-check"></i><b>5.1</b> Graphical queries</a></li>
<li class="chapter" data-level="5.2" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>5.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="5.3" data-path="querying-examples.html"><a href="querying-examples.html"><i class="fa fa-check"></i><b>5.3</b> Examples</a><ul>
<li class="chapter" data-level="5.3.1" data-path="querying-examples.html"><a href="querying-examples.html#trellis-linking"><i class="fa fa-check"></i><b>5.3.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="5.3.2" data-path="querying-examples.html"><a href="querying-examples.html#statistical-queries"><i class="fa fa-check"></i><b>5.3.2</b> Statistical queries</a></li>
<li class="chapter" data-level="5.3.3" data-path="querying-examples.html"><a href="querying-examples.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>5.3.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="5.3.4" data-path="querying-examples.html"><a href="querying-examples.html#geo-spatial-queries"><i class="fa fa-check"></i><b>5.3.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="5.3.5" data-path="querying-examples.html"><a href="querying-examples.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>5.3.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="5.3.6" data-path="querying-examples.html"><a href="querying-examples.html#generalized-pairs-plots"><i class="fa fa-check"></i><b>5.3.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="5.3.7" data-path="querying-examples.html"><a href="querying-examples.html#querying-diagnostic-plots"><i class="fa fa-check"></i><b>5.3.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="limitations.html"><a href="limitations.html"><i class="fa fa-check"></i><b>5.4</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linking-server-side.html"><a href="linking-server-side.html"><i class="fa fa-check"></i><b>6</b> Linking views server-side</a><ul>
<li class="chapter" data-level="6.1" data-path="hello-shiny.html"><a href="hello-shiny.html"><i class="fa fa-check"></i><b>6.1</b> Embedding plotly in shiny</a><ul>
<li class="chapter" data-level="6.1.1" data-path="hello-shiny.html"><a href="hello-shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>6.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="6.1.2" data-path="hello-shiny.html"><a href="hello-shiny.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>6.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html"><i class="fa fa-check"></i><b>6.2</b> Accessing plotly input events</a><ul>
<li class="chapter" data-level="6.2.1" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#dragging-events"><i class="fa fa-check"></i><b>6.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="6.2.2" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#d-events"><i class="fa fa-check"></i><b>6.2.2</b> 3D events</a></li>
<li class="chapter" data-level="6.2.3" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#mapping-events-to-input-data"><i class="fa fa-check"></i><b>6.2.3</b> Mapping events to input data</a></li>
<li class="chapter" data-level="6.2.4" data-path="shiny-plotly-inputs.html"><a href="shiny-plotly-inputs.html#accessing-edit-events"><i class="fa fa-check"></i><b>6.2.4</b> Accessing edit events</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="updating-views.html"><a href="updating-views.html"><i class="fa fa-check"></i><b>6.3</b> Responding to input events</a></li>
<li class="chapter" data-level="6.4" data-path="shiny-performance.html"><a href="shiny-performance.html"><i class="fa fa-check"></i><b>6.4</b> Improving performance</a><ul>
<li class="chapter" data-level="6.4.1" data-path="shiny-performance.html"><a href="shiny-performance.html#proxies"><i class="fa fa-check"></i><b>6.4.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="6.4.2" data-path="shiny-performance.html"><a href="shiny-performance.html#partial-update-examples"><i class="fa fa-check"></i><b>6.4.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="advanced-applications.html"><a href="advanced-applications.html"><i class="fa fa-check"></i><b>6.5</b> Advanced applications</a><ul>
<li class="chapter" data-level="6.5.1" data-path="advanced-applications.html"><a href="advanced-applications.html#drill-down"><i class="fa fa-check"></i><b>6.5.1</b> Drill-down</a></li>
<li class="chapter" data-level="6.5.2" data-path="advanced-applications.html"><a href="advanced-applications.html#cross-filter"><i class="fa fa-check"></i><b>6.5.2</b> Cross-filter</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>6.6</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>7</b> Animating views</a><ul>
<li class="chapter" data-level="7.1" data-path="key-frame-animations.html"><a href="key-frame-animations.html"><i class="fa fa-check"></i><b>7.1</b> Key frame animations</a></li>
<li class="chapter" data-level="7.2" data-path="linking-animated-views.html"><a href="linking-animated-views.html"><i class="fa fa-check"></i><b>7.2</b> Linking animated views</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced-topics.html"><a href="advanced-topics.html"><i class="fa fa-check"></i><b>8</b> Advanced topics</a><ul>
<li class="chapter" data-level="8.1" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>8.1</b> Custom behavior via JavaScript</a></li>
<li class="chapter" data-level="8.2" data-path="translating-custom-ggplot2-geoms.html"><a href="translating-custom-ggplot2-geoms.html"><i class="fa fa-check"></i><b>8.2</b> Translating custom ggplot2 geoms</a></li>
<li class="chapter" data-level="8.3" data-path="designing-an-htmlwidget-interface.html"><a href="designing-an-htmlwidget-interface.html"><i class="fa fa-check"></i><b>8.3</b> Designing an htmlwidget interface</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">plotly for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="querying-examples" class="section level2">
<h2><span class="header-section-number">5.3</span> Examples</h2>
<div id="trellis-linking" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Querying facetted charts</h3>
<p>A facetted chart, also known as a trellis or small multiples display, is an effective way to observe how a certain relationship or visual pattern changes with a discrete variable <span class="citation">(Richard A. Becker <a href="#ref-trellis">1996</a>)</span> <span class="citation">(Tufte <a href="#ref-tufte2001">2001</a>)</span>. The implementation of a facetted chart partitions a data set into groups, then produces a graphical panel for each group using a fixed visual encoding (e.g. a scatterplot). When these groups are related in some way, it can be useful to consider linking the panels through graphical queries to reveal greater insight, especially when it comes to making comparisons both within and across multiple groups.</p>
<p>Figure <a href="querying-examples.html#fig:epl">5.12</a> is an example of making comparisons both within and across panels via graphical querying in a facetted chart. Each panel represents one year of English Premier League standings across time and each line represents a team (the querying variable). Since the x-axis represents the number of games within season and y-axis tracks cumulative points relative to the league average, lines with a positive slope represent above average performance and a negative slope represents below average performance. This design makes it easy to query a good (or bad) team for a particular year (via direct manipulation) to see who the team is as well as how they’ve compared to the competition in other years. In addition, the dynamic and persistent color brush allows us to query other teams to compare both within and across years. This example is shipped as a demo with the <strong>plotly</strong> package and uses data from the <strong>engsoccerdata</strong> package <span class="citation">(Curley <a href="#ref-engsoccerdata">2016</a>)</span>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># By entering this demo in your R console it will print out the actual source code necessary to recreate the graphic</span>
<span class="co"># Also, `demo(package = &quot;plotly&quot;)` will list of all demos shipped with plotly</span>
<span class="kw">demo</span>(<span class="st">&quot;crosstalk-highlight-epl-2&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;plotly&quot;</span>)</code></pre>
<div class="figure"><span id="fig:epl"></span>
<img src="https://i.imgur.com/Id2nVFG.gif" alt="Graphical querying in a facetted display of English Premier League standings over time. The combination of direct and indirect manipulation with the dynamic color brush makes it easy to make comparisons between good and/or bad teams relative to their known rivals." width="100%" />
<p class="caption">
Figure 5.12: Graphical querying in a facetted display of English Premier League standings over time. The combination of direct and indirect manipulation with the dynamic color brush makes it easy to make comparisons between good and/or bad teams relative to their known rivals.
</p>
</div>
<p>The demo above requires some fairly advanced data pre-processing, so to learn how to implement graphical queries in trellis displays, let’s work with more minimal examples. Figure <a href="querying-examples.html#fig:trellis-txhousing">5.13</a> gives us yet another look at the <code>txhousing</code> dataset. This time we focus on just four cities and give each city it’s own panel in the trellis display by leveraging <code>facet_wrap()</code> from <strong>ggplot2</strong>. Within each panel, we’ll wrap the house price time series by year by putting the month on the x-axis and grouping by year. Then, to link these panels, we can ulitize year as a querying variable. As a result, not only do we have the ability to analyze annual trends within city, but we can also query specific years to compare unusual or interesting years both within and across cities.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
txsmall &lt;-<span class="st"> </span>txhousing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(city, year, month, median) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(city <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Galveston&quot;</span>, <span class="st">&quot;Midland&quot;</span>, <span class="st">&quot;Odessa&quot;</span>, <span class="st">&quot;South Padre Island&quot;</span>))

txsmall <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight_key</span>(<span class="op">~</span>year) <span class="op">%&gt;%</span><span class="st"> </span>{
    <span class="kw">ggplot</span>(., <span class="kw">aes</span>(month, median, <span class="dt">group =</span> year)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">      </span><span class="kw">facet_wrap</span>(<span class="op">~</span>city, <span class="dt">ncol =</span> <span class="dv">2</span>)
  } <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplotly</span>(<span class="dt">tooltip =</span> <span class="st">&quot;year&quot;</span>)</code></pre>
<div class="figure"><span id="fig:trellis-txhousing"></span>
<div id="htmlwidget-629a11fa78e341dcfc1f" style="width:100%;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-629a11fa78e341dcfc1f">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[95000,100000,98300,111100,89200,108600,99000,96200,104000,118800,102000,93000,null,113300,127100,132000,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,95000,120000,null,130000,110000,143600,113800,131800,125000,124000,null,120000,null,124300,135000,137500,124500,163000,143000,140000,124000,139200,147100,120000,138200,null,165000,144000,106700,162400,157900,172900,172200,163800,178000,172000,160000,158000,null,172500,182000,183800,166900,177500,171300,163800,176700,171000,180000,165000,156000,null,168000,190000,195000,163300,168000,174400,163300,182200,165000,192500,176000,171400,null,140000,170000,222200,176000,180000,205000,194000,208300,165000,163300,130000,110000,null,91700,90000,97500,85000,132000,163300,150000,138600,150000,151700,121400,125000,null,145000,170000,145000,153300,157000,176700,187500,180000,133300,172200,165000,183300,null,170000,177500,190000,186000,171200,150000,170000,160000,174000,173300,126700,166000,null,122500,186000,146700,153800,182900,168800,152500,156200,172000,186000,178600,160000,null,165000,183300,192500,216700,202100,202800,165000,211200,187800,156000,180000,180000,null,176700,177500,204200,173600,229500,210400,196700,214300,188000,212500,228600,182000,null,187500,205800,203800,187500,210700,206900,203800],"text":["year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000",null,"year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001",null,"year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002",null,"year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003",null,"year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004",null,"year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005",null,"year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006",null,"year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007",null,"year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008",null,"year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009",null,"year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010",null,"year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011",null,"year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012",null,"year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013",null,"year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014",null,"year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015"],"key":["2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000",null,"2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001",null,"2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002",null,"2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003",null,"2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004",null,"2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","set":"SharedData00b5a1c5","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","_isNestedKey":false,"frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,98800,null,127000,127400,143000,130000,132000,125000,145900,137000,141800,null,150600,135600,148600,151100,163600,171500,156900,167500,167900,167600,152500,186000,null,165600,161400,177300,162400,164500,179500,182200,186900,180500,170000,166300,175000,null,166700,170000,169400,174400,176800,191800,167300,168500,164800,165500,161700,168900,null,167500,175400,162300,162800,171800,174000,192000,174700,189100,170600,180000,185000,null,176200,178800,186900,148500,194500,186700,190000,196200,200000,176000,202100,184000,null,203900,185700,196000,201900,231600,206700,190500,218900,201000,222400,212500,214500,null,216200,226000,177100,211500,230600,229700,231400,246800,244000,225800,235200,235700,null,251500,233300,230800,227000,240400,283100,247900,249200,246800,260300,250000,237500,null,235900,231800,235700,234400,244200,257700,null],"text":["year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000",null,"year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001",null,"year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002",null,"year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003",null,"year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004",null,"year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005",null,"year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006",null,"year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007",null,"year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008",null,"year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009",null,"year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010",null,"year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011",null,"year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012",null,"year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013",null,"year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014",null,"year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015"],"key":["2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000",null,"2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001",null,"2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002",null,"2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003",null,"2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004",null,"2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","set":"SharedData00b5a1c5","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","_isNestedKey":false,"frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,62900,71600,78500,81000,81400,91200,86200,101400,91800,89000,101300,116700,null,105700,105500,98300,109200,110000,123000,126000,122100,121300,103300,112500,121100,null,112900,104600,120000,118800,119500,143300,127500,136700,121600,126400,116700,110000,null,135700,130000,136400,128800,144300,133300,137800,113300,127800,130000,118500,138200,null,117500,123100,120000,117800,126900,125300,138800,150000,132900,113000,155000,128900,null,136700,137500,146700,136300,142700,144000,144000,142500,141100,148300,125000,129300,null,152000,142500,138300,135400,156400,156200,142700,158800,155700,155000,150500,158000,null,163300,150800,152700,154000,167300,158800,162500,170000,182000,160000,155700,164700,null,148600,157100,163000,162700,180000,176500,178000,171800,185000,170600,194000,175300,null,156200,165000,187300,174700,188000,176800,184800],"text":["year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000",null,"year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001",null,"year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002",null,"year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003",null,"year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004",null,"year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005",null,"year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006",null,"year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007",null,"year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008",null,"year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009",null,"year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010",null,"year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011",null,"year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012",null,"year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013",null,"year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014",null,"year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015"],"key":["2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000",null,"2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001",null,"2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002",null,"2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003",null,"2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004",null,"2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","set":"SharedData00b5a1c5","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","_isNestedKey":false,"frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,180000,241700,200000,140000,null,200000,195000,183300,225000,208300,193300,262500,165000,225000,175000,160000,190000,null,225000,262500,180000,182000,140000,123300,150000,197500,160000,140000,243800,150000,null,250000,206200,160000,210000,147500,180000,190000,150000,175000,170000,200000,190000,null,225000,200000,168000,208300,126000,175000,165000,196700,254200,133300,136000,172000,null,160000,180000,120000,110000,180000,160000,184000,175000,157500,173300,152500,215000,null,180000,225000,146700,180000,212500,166700,172200],"text":["year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000","year: 2000",null,"year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001","year: 2001",null,"year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002","year: 2002",null,"year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003","year: 2003",null,"year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004","year: 2004",null,"year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005","year: 2005",null,"year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006","year: 2006",null,"year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007","year: 2007",null,"year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008","year: 2008",null,"year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009","year: 2009",null,"year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010","year: 2010",null,"year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011","year: 2011",null,"year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012","year: 2012",null,"year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013","year: 2013",null,"year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014","year: 2014",null,"year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015","year: 2015"],"key":["2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000",null,"2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001","2001",null,"2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002","2002",null,"2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003","2003",null,"2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004",null,"2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","set":"SharedData00b5a1c5","showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","_isNestedKey":false,"frame":null}],"layout":{"margin":{"t":37.9178082191781,"r":7.30593607305936,"b":40.1826484018265,"l":60.6392694063927},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.45,12.55],"tickmode":"array","ticktext":["2.5","5.0","7.5","10.0","12.5"],"tickvals":[2.5,5,7.5,10,12.5],"categoryorder":"array","categoryarray":["2.5","5.0","7.5","10.0","12.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y2","title":"","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"annotations":[{"text":"month","x":0.5,"y":-0.0471841704718417,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis"},{"text":"median","x":-0.0684931506849315,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"Galveston","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Midland","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Odessa","x":0.244564035659926,"y":0.460426179604262,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"South Padre Island","x":0.755435964340074,"y":0.460426179604262,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0.539573820395738,1],"automargin":true,"type":"linear","autorange":false,"range":[51890,294110],"tickmode":"array","ticktext":["100000","150000","200000","250000"],"tickvals":[100000,150000,200000,250000],"categoryorder":"array","categoryarray":["100000","150000","200000","250000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0.539573820395738,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0.539573820395738,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":0.460426179604262},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":0.460426179604262,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":0.460426179604262},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":0.460426179604262,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.45,12.55],"tickmode":"array","ticktext":["2.5","5.0","7.5","10.0","12.5"],"tickvals":[2.5,5,7.5,10,12.5],"categoryorder":"array","categoryarray":["2.5","5.0","7.5","10.0","12.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y2","title":"","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis2":{"type":"linear","autorange":false,"range":[51890,294110],"tickmode":"array","ticktext":["100000","150000","200000","250000"],"tickvals":[100000,150000,200000,250000],"categoryorder":"array","categoryarray":["100000","150000","200000","250000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0,0.460426179604262],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative","dragmode":"zoom"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"source":"A","attrs":{"6abc643bf6af":{"key":{},"x":{},"y":{},"type":"scatter"}},"cur_data":"6abc643bf6af","visdat":{"6abc643bf6af":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["SharedData00b5a1c5"]},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p class="caption">
Figure 5.13: Monthly median house prices in four Texan cities. Querying by year allows one to compare unusual or interesting years both within and across cities.
</p>
</div>
<p>Figure <a href="querying-examples.html#fig:trellis-txhousing-plotly">5.14</a> displays the same information as <a href="querying-examples.html#fig:trellis-txhousing">5.13</a>, but shows a way to implement a linked trellis display via <code>plot_ly()</code> instead of <code>ggplotly()</code>. This approach leverages <code>dplyr::do()</code> to create <strong>plotly</strong> object for each city/panel, then routes that list of plots into <code>subplot()</code>. One nuance here is that the querying variable has to be defined within the <code>do()</code> statement, but everytime <code>highlight_key()</code> is called, it creates a <code>crosstalk::SharedData</code> object belonging to a new unique <code>group</code>, so to link these panels together the <code>group</code> must be set to a constant value (here we’ve set <code>group = "txhousing-trellis"</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">txsmall <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(city) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(
    <span class="dt">p =</span> <span class="kw">highlight_key</span>(., <span class="op">~</span>year, <span class="dt">group =</span> <span class="st">&quot;txhousing-trellis&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">plot_ly</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_lines</span>(
        <span class="dt">x =</span> <span class="op">~</span>month, <span class="dt">y =</span> <span class="op">~</span>median, <span class="dt">text =</span> <span class="op">~</span>year, 
        <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>
      ) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_annotations</span>(
        <span class="dt">text =</span> <span class="op">~</span><span class="kw">unique</span>(city), 
        <span class="dt">x =</span> <span class="fl">0.5</span>, <span class="dt">y =</span> <span class="dv">1</span>, 
        <span class="dt">xref =</span> <span class="st">&quot;paper&quot;</span>, <span class="dt">yref =</span> <span class="st">&quot;paper&quot;</span>, 
        <span class="dt">xanchor =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">yanchor =</span> <span class="st">&quot;bottom&quot;</span>, 
        <span class="dt">showarrow =</span> <span class="ot">FALSE</span>
      )
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">subplot</span>(<span class="dt">nrows =</span> <span class="dv">2</span>, <span class="dt">margin =</span> <span class="fl">0.05</span>, <span class="dt">shareY =</span> <span class="ot">TRUE</span>, <span class="dt">shareX =</span> <span class="ot">TRUE</span>, <span class="dt">titleY =</span> <span class="ot">FALSE</span>)</code></pre>
<div class="figure"><span id="fig:trellis-txhousing-plotly"></span>
<div id="htmlwidget-9739e620a8c2be6aa66a" style="width:100%;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9739e620a8c2be6aa66a">{"x":{"data":[{"showlegend":false,"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,null,1,2,null,4,5,6,7,8,9,10,null,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[95000,100000,98300,111100,89200,108600,99000,96200,104000,118800,102000,93000,null,113300,127100,132000,null,95000,120000,null,130000,110000,143600,113800,131800,125000,124000,null,120000,null,124300,135000,137500,124500,163000,143000,140000,124000,139200,147100,120000,138200,null,165000,144000,106700,162400,157900,172900,172200,163800,178000,172000,160000,158000,null,172500,182000,183800,166900,177500,171300,163800,176700,171000,180000,165000,156000,null,168000,190000,195000,163300,168000,174400,163300,182200,165000,192500,176000,171400,null,140000,170000,222200,176000,180000,205000,194000,208300,165000,163300,130000,110000,null,91700,90000,97500,85000,132000,163300,150000,138600,150000,151700,121400,125000,null,145000,170000,145000,153300,157000,176700,187500,180000,133300,172200,165000,183300,null,170000,177500,190000,186000,171200,150000,170000,160000,174000,173300,126700,166000,null,122500,186000,146700,153800,182900,168800,152500,156200,172000,186000,178600,160000,null,165000,183300,192500,216700,202100,202800,165000,211200,187800,156000,180000,180000,null,176700,177500,204200,173600,229500,210400,196700,214300,188000,212500,228600,182000,null,187500,205800,203800,187500,210700,206900,203800],"type":"scatter","mode":"lines","text":[2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,null,2001,2001,2001,null,2003,2003,null,2003,2003,2003,2003,2003,2003,2003,null,2003,null,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,null,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,null,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,null,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,null,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,null,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,null,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,null,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,null,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,null,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,null,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,null,2015,2015,2015,2015,2015,2015,2015],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text",null,"text","text",null,"text","text","text","text","text","text","text",null,"text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text"],"key":["2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000","2000",null,"2001","2001","2001",null,"2003","2003",null,"2003","2003","2003","2003","2003","2003","2003",null,"2003",null,"2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004","2004",null,"2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005","2005",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"set":"txhousing-trellis","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"showlegend":false,"x":[2,null,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6],"y":[98800,null,127000,127400,143000,130000,132000,125000,145900,137000,141800,null,150600,135600,148600,151100,163600,171500,156900,167500,167900,167600,152500,186000,null,165600,161400,177300,162400,164500,179500,182200,186900,180500,170000,166300,175000,null,166700,170000,169400,174400,176800,191800,167300,168500,164800,165500,161700,168900,null,167500,175400,162300,162800,171800,174000,192000,174700,189100,170600,180000,185000,null,176200,178800,186900,148500,194500,186700,190000,196200,200000,176000,202100,184000,null,203900,185700,196000,201900,231600,206700,190500,218900,201000,222400,212500,214500,null,216200,226000,177100,211500,230600,229700,231400,246800,244000,225800,235200,235700,null,251500,233300,230800,227000,240400,283100,247900,249200,246800,260300,250000,237500,null,235900,231800,235700,234400,244200,257700],"type":"scatter","mode":"lines","text":[2006,null,2006,2006,2006,2006,2006,2006,2006,2006,2006,null,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,null,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,null,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,null,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,null,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,null,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,null,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,null,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,null,2015,2015,2015,2015,2015,2015],"hoverinfo":["text",null,"text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text"],"key":["2006",null,"2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015"],"set":"txhousing-trellis","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x2","yaxis":"y","_isNestedKey":false,"frame":null},{"showlegend":false,"x":[1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[62900,71600,78500,81000,81400,91200,86200,101400,91800,89000,101300,116700,null,105700,105500,98300,109200,110000,123000,126000,122100,121300,103300,112500,121100,null,112900,104600,120000,118800,119500,143300,127500,136700,121600,126400,116700,110000,null,135700,130000,136400,128800,144300,133300,137800,113300,127800,130000,118500,138200,null,117500,123100,120000,117800,126900,125300,138800,150000,132900,113000,155000,128900,null,136700,137500,146700,136300,142700,144000,144000,142500,141100,148300,125000,129300,null,152000,142500,138300,135400,156400,156200,142700,158800,155700,155000,150500,158000,null,163300,150800,152700,154000,167300,158800,162500,170000,182000,160000,155700,164700,null,148600,157100,163000,162700,180000,176500,178000,171800,185000,170600,194000,175300,null,156200,165000,187300,174700,188000,176800,184800],"type":"scatter","mode":"lines","text":[2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,null,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,null,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,null,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,null,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,null,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,null,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,null,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,null,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,null,2015,2015,2015,2015,2015,2015,2015],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text"],"key":["2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006","2006",null,"2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007","2007",null,"2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008","2008",null,"2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"set":"txhousing-trellis","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y2","_isNestedKey":false,"frame":null},{"showlegend":false,"x":[9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7,8,9,10,11,12,null,1,2,3,4,5,6,7],"y":[180000,241700,200000,140000,null,200000,195000,183300,225000,208300,193300,262500,165000,225000,175000,160000,190000,null,225000,262500,180000,182000,140000,123300,150000,197500,160000,140000,243800,150000,null,250000,206200,160000,210000,147500,180000,190000,150000,175000,170000,200000,190000,null,225000,200000,168000,208300,126000,175000,165000,196700,254200,133300,136000,172000,null,160000,180000,120000,110000,180000,160000,184000,175000,157500,173300,152500,215000,null,180000,225000,146700,180000,212500,166700,172200],"type":"scatter","mode":"lines","text":[2009,2009,2009,2009,null,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,null,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,null,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,null,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,null,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,null,2015,2015,2015,2015,2015,2015,2015],"hoverinfo":["text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text","text","text","text","text","text",null,"text","text","text","text","text","text","text"],"key":["2009","2009","2009","2009",null,"2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010","2010",null,"2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011","2011",null,"2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012","2012",null,"2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013","2013",null,"2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014","2014",null,"2015","2015","2015","2015","2015","2015","2015"],"set":"txhousing-trellis","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","_isNestedKey":false,"frame":null}],"layout":{"xaxis":{"domain":[0,0.45],"automargin":true,"title":"month","anchor":"y2"},"xaxis2":{"domain":[0.55,1],"automargin":true,"title":"month","anchor":"y2"},"yaxis2":{"domain":[0,0.45],"automargin":true,"anchor":"x"},"yaxis":{"domain":[0.55,1],"automargin":true,"anchor":"x"},"annotations":[{"text":"Galveston","x":0.225,"y":1,"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false},{"text":"Midland","x":0.775,"y":1,"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false},{"text":"Odessa","x":0.225,"y":0.45,"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false},{"text":"South Padre Island","x":0.775,"y":0.45,"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false}],"margin":{"b":40,"l":60,"t":25,"r":10},"dragmode":"zoom","hovermode":"closest","showlegend":false},"attrs":{"6abc60f63ad0":{"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","text":{},"hoverinfo":"text","inherit":true},"6abc47c18d7a":{"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","text":{},"hoverinfo":"text","inherit":true},"6abc54b01e2c":{"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","text":{},"hoverinfo":"text","inherit":true},"6abc248e20a3":{"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","text":{},"hoverinfo":"text","inherit":true}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["txhousing-trellis"]},"subplot":true,"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p class="caption">
Figure 5.14: Using <code>plot_ly()</code> instead of <code>ggplotly()</code> to implement a linked trellis display.
</p>
</div>
</div>
<div id="statistical-queries" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Statistical queries</h3>
<div id="statistical-queries-with-plot_ly" class="section level4">
<h4><span class="header-section-number">5.3.2.1</span> Statistical queries with <code>plot_ly()</code></h4>
<p>Figure <a href="graphical-queries.html#fig:txhousing-aggregates">5.7</a> introduced the concept of leveraging statistical trace types inside the graphical querying framework. This section gives some more examples of leveraging these trace types to dynamically produce statistical summaries of graphical queries. But first, to help understand what makes a trace “statistical”, consider the difference between <code>add_bars()</code> and <code>add_histogram()</code> (described in detail in Section <a href="bars-histograms.html#bars-histograms">2.3</a>). The important difference here is that <code>add_bars()</code> requires the bar heights to be pre-specified, whereas plotly.js does the relevant computations in <code>add_histogram()</code>. More generally, with a statistical trace, you provide a collection of “raw” values and plotly.js performs the statistical summaries necessary to render the graphic. As Figure <a href="querying-examples.html#fig:mapbox-bars">5.22</a> shows, sometimes you’ll want to fix certain parameters of the summary (e.g., number of bins in a histogram) to ensure the selection layer is comparable to original layer.</p>
<p>Figure <a href="querying-examples.html#fig:2-way-anova">5.15</a> demonstrates routing of a scatterplot brushing event to two different statistical trace types: <code>add_boxplot()</code> and <code>add_histogram()</code>. Here we’ve selected all cars with 4 cylinders to show that cylinders appears to have a significant impact on miles per gallon for pickups and sport utility vehicles, but the interactive graphic allows us to query any subset of cars. Often times, with scatterplot brushing, it’s desirable to have the row index inform the SQL query (i.e., have a 1-to-1 mapping between a row of data and the marker encoding that row). This happens to be the default behavior of <code>highlight_key()</code> – if no data variable is specified, then it automatically uses the row index as the querying variable.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">demo</span>(<span class="st">&quot;crosstalk-highlight-binned-target-a&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;plotly&quot;</span>)</code></pre>
<div class="figure"><span id="fig:2-way-anova"></span>
<img src="https://i.imgur.com/yKAlCs0.gif" alt="Linking a (jittered) dotplot of engine displacement by number of cylinders with boxplots of miles per gallon split by class and a bar chart of Dynamic 2-way ANOVA." width="100%" />
<p class="caption">
Figure 5.15: Linking a (jittered) dotplot of engine displacement by number of cylinders with boxplots of miles per gallon split by class and a bar chart of Dynamic 2-way ANOVA.
</p>
</div>
<p>When using a statistical trace type with graphical queries, it’s often desirable to set the querying variable as the row index. That’s because, with a statistical trace, numerous data values are attached to each graphical mark; and in that case, it’s most intuitive if each value queries just one observation. Figure <a href="querying-examples.html#fig:mpg-linked-bars">5.16</a> gives a simple example of linking a (dynamic) bar chart with a scatterplot in this way to allow us to query interesting regions of the data space defined by engine displacement (<code>disp</code>), miles per gallon highway (<code>hwy</code>), and the class of car (<code>class</code>). Notice how selections can derive from either view, and since we’ve specified <code>"plotly_selected"</code> as the <code>on</code> event, either rectangular or lasso selections can be used to trigger the query.</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(mpg)
base &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(d, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">showlegend =</span> <span class="ot">FALSE</span>)

<span class="kw">subplot</span>(
  <span class="kw">add_histogram</span>(base, <span class="dt">x =</span> <span class="op">~</span>class),
  <span class="kw">add_markers</span>(base, <span class="dt">x =</span> <span class="op">~</span>displ, <span class="dt">y =</span> <span class="op">~</span>hwy)
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Selections are actually additional traces, and, by default, </span>
<span class="st">  </span><span class="co"># plotly.js will try to dodge bars placed under the same category</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>, <span class="dt">dragmode =</span> <span class="st">&quot;lasso&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>)</code></pre>
<div class="figure"><span id="fig:mpg-linked-bars"></span>
<img src="https://i.imgur.com/SxpkwQa.gif" alt="Linking a bar chart with a scatterplot to query interesting regions of the data space defined by engine displacement (`disp`), miles per gallon highway (`hwy`), and the class of car (`class`). Notice how, by using `add_histogram()`, the number of cars within each class is dynamically computed by plotly.js." width="100%" />
<p class="caption">
Figure 5.16: Linking a bar chart with a scatterplot to query interesting regions of the data space defined by engine displacement (<code>disp</code>), miles per gallon highway (<code>hwy</code>), and the class of car (<code>class</code>). Notice how, by using <code>add_histogram()</code>, the number of cars within each class is dynamically computed by plotly.js.
</p>
</div>
<p>Figure <a href="querying-examples.html#fig:mpg-linked">5.17</a> adds two more statistical trace types to Figure <a href="querying-examples.html#fig:mpg-linked-bars">5.16</a> to further explore how miles per gallon highway is related to fuel type (<code>fl</code>) and front/rear/4 wheel drive (<code>drv</code>). In particular, one can effectively condition on these discrete variables to see how the other distributions respond by brushing and dragging over markers. For example, in Figure <a href="querying-examples.html#fig:mpg-linked">5.17</a>, front-wheel drive cars are highlighted in red, then 4-wheel drive cars in blue, and as a result, we can see that the main effect of going from 4 to front wheel-drive is are also large interaction effect sizes with regular and diesel fuel types.</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(mpg)
base &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(d, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">showlegend =</span> <span class="ot">FALSE</span>)

<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(base, <span class="dt">x =</span> <span class="op">~</span>displ, <span class="dt">y =</span> <span class="op">~</span>hwy),
  <span class="kw">add_boxplot</span>(base, <span class="dt">x =</span> <span class="op">~</span>fl, <span class="dt">y =</span> <span class="op">~</span>hwy) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_markers</span>(<span class="dt">x =</span> <span class="op">~</span>fl, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.1</span>),
  <span class="kw">add_trace</span>(base, <span class="dt">x =</span> <span class="op">~</span>drv, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">type =</span> <span class="st">&quot;violin&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_markers</span>(<span class="dt">x =</span> <span class="op">~</span>drv, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.1</span>),
  <span class="dt">shareY =</span> <span class="ot">TRUE</span>
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">subplot</span>(<span class="kw">add_histogram</span>(base, <span class="dt">x =</span> <span class="op">~</span>class), <span class="dt">nrows =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Selections are actually additional traces, and, by default, </span>
<span class="st">  </span><span class="co"># plotly.js will try to dodge bars placed under the same category</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>)</code></pre>
<div class="figure"><span id="fig:mpg-linked"></span>
<img src="https://i.imgur.com/1oKqiRB.gif" alt="Using statistical queries to perform a 2-way ANOVA on the `mpg` dataset. Cars with front-wheel drive are highlighted in red and 4-wheel drive highlighted in blue. The dynamically rendered boxplots by fuel type indicate significant interaction effects." width="100%" />
<p class="caption">
Figure 5.17: Using statistical queries to perform a 2-way ANOVA on the <code>mpg</code> dataset. Cars with front-wheel drive are highlighted in red and 4-wheel drive highlighted in blue. The dynamically rendered boxplots by fuel type indicate significant interaction effects.
</p>
</div>
</div>
</div>
<div id="statistical-queries-ggplot" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Statistical queries with <code>ggplotly()</code></h3>
<p>Compared to <code>plot_ly()</code>, statistical queries (client-side) with <code>ggplotly()</code> are fundamentally limited. That’s because, the statistical R functions that <strong>ggplot2</strong> relies on to generate the graphical layers can’t necessarily be recomputed with different input data in your web browser. That being said, this is really only an issue when attempting to <em>target</em> a <strong>ggplot2</strong> layer with a non-identity statistic (e.g., <code>geom_smooth()</code>, <code>stat_summary()</code>, etc). In that case, one should consider linking views server-side, as covered in section <a href="linking-server-side.html#linking-server-side">6</a>.</p>
<p>As Figure <a href="querying-examples.html#fig:smooth-highlight">5.18</a> demonstrates, you can still have a <strong>ggplot2</strong> layer with a non-identity statistic serve as the <em>source</em> of a selection. In that case, <code>ggplotly()</code> will automatically attach all the input values of the querying variable into the creation of the relevant graphical object (e.g. the fitted line). That is why, in the example below, when a fitted line is hovered upon, all the points belonging to that particular group are highlighted, even when the querying variable is the row index.</p>
<pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(mpg)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)
<span class="kw">ggplotly</span>(p) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_hover&quot;</span>)</code></pre>
<div class="figure"><span id="fig:smooth-highlight"></span>
<img src="images/smooth-highlight.gif" alt="Engine displacement versus highway miles per gallon by class of car. The linear model for each class, as well as the individual observations, can be selected by hovering over the line of fitted values. An individual observation can also be selected by hovering over the relevant point." width="100%" />
<p class="caption">
Figure 5.18: Engine displacement versus highway miles per gallon by class of car. The linear model for each class, as well as the individual observations, can be selected by hovering over the line of fitted values. An individual observation can also be selected by hovering over the relevant point.
</p>
</div>
<p>Figure <a href="querying-examples.html#fig:smooth-highlight">5.18</a> demonstrates highlighting in a single view when the querying variable is the row index, but the linking could also be done by matching the querying variable with the <strong>ggplot2</strong> group of interest, as is done in Figure <a href="querying-examples.html#fig:ggplotly-linked-densities">5.19</a>. This way, when a user highlights an individual point, it highlights the entire group instead of just that point.</p>
<pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(mpg, <span class="op">~</span>class)
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, <span class="dt">fill =</span> class)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(m, <span class="kw">aes</span>(displ, hwy, <span class="dt">fill =</span> class)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
<span class="kw">subplot</span>(p1, p2) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hide_legend</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_hover&quot;</span>)</code></pre>
<div class="figure"><span id="fig:ggplotly-linked-densities"></span>
<img src="https://i.imgur.com/we2E76e.gif" alt="Clicking on a density estimate to highlight all the raw observations that went into that estimate." width="100%" />
<p class="caption">
Figure 5.19: Clicking on a density estimate to highlight all the raw observations that went into that estimate.
</p>
</div>
<p>In summary, we’ve learned numerous things about statistical queries:</p>
<ul>
<li>A statistical trace (e.g., <code>add_histogram()</code>, <code>add_boxplot()</code>, etc) can be used as both the source and target of a graphical query.</li>
<li>When a statistical trace is the target of a graphical query, it’s often desirable to have the row index assigned as the querying variable.</li>
<li>A <strong>ggplot2</strong> layer can be used as the source of a graphical query, but when it is the target, non-trivial statistical functions can not be recomputed client-side. In that case, one should consider linking views server side, as covered in section <a href="linking-server-side.html#linking-server-side">6</a>.</li>
</ul>
</div>
<div id="geo-spatial-queries" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Geo-spatial queries</h3>
<p>Section <a href="maps.html#maps">2.2</a> covers several different approaches<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> for rendering geo-spatial information, and each approach supports graphical querying. One clever approach is to render a 3D globe as a surface, then layer on geo-spatial data on top of that globe with a scatter3d trace. Not only is 3D a nice way to visualize geospatial data that has altitude (in addition to latitude and longitude), but it also grants the ability to interpolate color along a path. Figure <a href="querying-examples.html#fig:storms">5.20</a> renders tropical storms paths on a 3D globe and uses color to encode the altitude of the storm at that point. Below the 3D view is a 2D view of altitude versus distance traveled. These views are linked by a graphical query where the querying variable is the storm ID.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">demo</span>(<span class="st">&quot;sf-plotly-3D-globe&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;plotly&quot;</span>)</code></pre>
<div class="figure"><span id="fig:storms"></span>
<img src="https://i.imgur.com/3wl38E2.gif" alt="Linking a 3D globe with tropical storm paths to a 2D view of the storm altitude versus distance traveled. " width="100%" />
<p class="caption">
Figure 5.20: Linking a 3D globe with tropical storm paths to a 2D view of the storm altitude versus distance traveled.
</p>
</div>
<p>A more widely used approach to geo-spatial data visualization is to render lat/lon data on a basemap layer that updates in response to zoom events. The <code>plot_mapbox()</code> function from <strong>plotly</strong> does this via integration with <a href="https://www.mapbox.com/">mapbox</a>. Figure <a href="querying-examples.html#fig:mapbox-quakes">5.21</a> uses <code>plot_mapbox()</code> highlighting earthquakes west of Fiji to compare the relative frequency of their magnitude and number of reporting stations (to the overall relative frequency).</p>
<pre class="sourceCode r"><code class="sourceCode r">eqs &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(quakes)
 
<span class="co"># you need a mapbox API key to use plot_mapbox()</span>
<span class="co"># https://www.mapbox.com/signup/?route-to=https://www.mapbox.com/studio/account/tokens/</span>
map &lt;-<span class="st"> </span><span class="kw">plot_mapbox</span>(eqs, <span class="dt">x =</span> <span class="op">~</span>long, <span class="dt">y =</span> <span class="op">~</span>lat) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">color =</span> <span class="op">~</span>depth) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(
    <span class="dt">mapbox =</span> <span class="kw">list</span>(
      <span class="dt">zoom =</span> <span class="dv">2</span>,
      <span class="dt">center =</span> <span class="kw">list</span>(<span class="dt">lon =</span> <span class="op">~</span><span class="kw">mean</span>(long), <span class="dt">lat =</span> <span class="op">~</span><span class="kw">mean</span>(lat))
    )
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>)
 
<span class="co"># shared properties of the two histograms</span>
hist_base &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(eqs, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">histnorm =</span> <span class="st">&quot;probability density&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>, <span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="dt">selected =</span> <span class="kw">attrs_selected</span>(<span class="dt">opacity =</span> <span class="fl">0.5</span>))
 
histograms &lt;-<span class="st"> </span><span class="kw">subplot</span>(
  <span class="kw">add_histogram</span>(hist_base, <span class="dt">x =</span> <span class="op">~</span>mag),
  <span class="kw">add_histogram</span>(hist_base, <span class="dt">x =</span> <span class="op">~</span>stations),
  <span class="dt">nrows =</span> <span class="dv">2</span>, <span class="dt">titleX =</span> <span class="ot">TRUE</span>
)
 
crosstalk<span class="op">::</span><span class="kw">bscols</span>(histograms, map)</code></pre>
<div class="figure"><span id="fig:mapbox-quakes"></span>
<img src="http://i.imgur.com/l61zu6R.gif" alt="Querying earthquakes by location and displaying their a histogram of their magnitude and number of stations." width="100%" />
<p class="caption">
Figure 5.21: Querying earthquakes by location and displaying their a histogram of their magnitude and number of stations.
</p>
</div>
<p>Every 2D mapping approach in <strong>plotly</strong> (e.g., <code>plot_mapbox()</code>, <code>plot_ly()</code>, <code>geom_sf()</code>) has a special understanding of the simple features data structure provided by the <strong>sf</strong> package. <span class="citation">Sievert (<a href="#ref-ggplotly-blog-post">2018</a><a href="#ref-ggplotly-blog-post">a</a>)</span> and <span class="citation">Sievert (<a href="#ref-sf-blog-post">2018</a><a href="#ref-sf-blog-post">b</a>)</span> goes more in depth about simple features support in <strong>plotly</strong> and provides more examples of graphical queries and animation with simple features, but Figure <a href="querying-examples.html#fig:mapbox-bars">5.22</a> demonstrates a clever ‘trick’ to get bi-directional brushing between polygon centroids and a histogram showing a numerical summary of the polygons. The main idea is to leverage the <code>st_centroid()</code> function from <strong>sf</strong> to get the polygons centroids, then link those points to the histogram via <code>highlight_key()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
nc &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">&quot;shape/nc.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;sf&quot;</span>), <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
nc_query &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(nc, <span class="dt">group =</span> <span class="st">&quot;sf-rocks&quot;</span>)
nc_centroid &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(<span class="kw">st_centroid</span>(nc), <span class="dt">group =</span> <span class="st">&quot;sf-rocks&quot;</span>)

map &lt;-<span class="st"> </span><span class="kw">plot_mapbox</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_sf</span>(<span class="dt">data =</span> nc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_sf</span>(<span class="dt">data =</span> nc_centroid) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>)

hist &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_histogram</span>(
    <span class="dt">data =</span> nc_query, <span class="dt">x =</span> <span class="op">~</span>AREA,
    <span class="dt">xbins =</span> <span class="kw">list</span>(<span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">end =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="fl">0.01</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">barmode =</span> <span class="st">&quot;overlay&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>)

crosstalk<span class="op">::</span><span class="kw">bscols</span>(<span class="dt">widths =</span> <span class="dv">12</span>, map, hist)</code></pre>
<div class="figure"><span id="fig:mapbox-bars"></span>
<img src="https://i.imgur.com/vfKJnSo.gif" alt="Graphically querying North Carolina by location and area" width="100%" />
<p class="caption">
Figure 5.22: Graphically querying North Carolina by location and area
</p>
</div>
</div>
<div id="linking-with-other-htmlwidgets" class="section level3">
<h3><span class="header-section-number">5.3.5</span> Linking with other htmlwidgets</h3>
<p>The <strong>plotly</strong> package is able to share graphical queries with a limited set of other R packages that build upon the <strong>htmlwidgets</strong> standard. At the moment, graphical queries work best with <strong>leaflet</strong> and <strong>DT</strong>. Figure <a href="querying-examples.html#fig:sf-dt">5.23</a> links <strong>plotly</strong> with <strong>DT</strong>, and since the data set linked bewteen the two is an <strong>sf</strong> data frame, each row of the table is linked to a polygon on the map through the row index of the same dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">demo</span>(<span class="st">&quot;sf-dt&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;plotly&quot;</span>)</code></pre>
<div class="figure"><span id="fig:sf-dt"></span>
<img src="https://i.imgur.com/SJhjCQR.gif" alt="Linking a `plot_ly()`-based map with a `datatable()` from the **DT** package." width="100%" />
<p class="caption">
Figure 5.23: Linking a <code>plot_ly()</code>-based map with a <code>datatable()</code> from the <strong>DT</strong> package.
</p>
</div>
<p>As already shown in section <a href="filter.html#filter">5.2</a>, <strong>plotly</strong> can share graphical queries with <strong>leaflet</strong>. Some of the more advanced features (e.g., persistent selection with dynamic color brush) are not yet officially supported, but you can still leverage these experimental features by installing the experimental versions of <strong>leaflet</strong> referenced in the code below. For example, in Figure <a href="querying-examples.html#fig:leaflet-persistent">5.24</a>, persistent selection with dynamic colors allows one to first highlight earthquakes with a magnitude of 5 or higher in red, then earthquakes with a magnitude of 4.5 or lower, and the corresponding earthquakes are highlighted in the leaflet map. This reveals an interesting relationship in magnitude and geographic location, and <strong>leaflet</strong> provides the ability to zoom and pan on the map to investigate regions that have a high density of quakes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># requires an experimental version of leaflet</span>
<span class="co"># devtools::install_github(&quot;rstudio/leaflet#346&quot;)</span>
<span class="kw">library</span>(leaflet)

qquery &lt;-<span class="st"> </span><span class="kw">highlight_key</span>(quakes)

p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(qquery, <span class="dt">x =</span> <span class="op">~</span>depth, <span class="dt">y =</span> <span class="op">~</span>mag) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>)

map &lt;-<span class="st"> </span><span class="kw">leaflet</span>(qquery) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addCircles</span>()

<span class="co"># persistent selection can be specified via options()</span>
withr<span class="op">::</span><span class="kw">with_options</span>(
  <span class="kw">list</span>(<span class="dt">persistent =</span> <span class="ot">TRUE</span>), 
  crosstalk<span class="op">::</span><span class="kw">bscols</span>(<span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">6</span>), p, map)
)</code></pre>
<div class="figure"><span id="fig:leaflet-persistent"></span>
<img src="images/plotlyLeaflet.gif" alt="Linking views between plotly and leaflet to explore the relation between magnitude and geographic location of earthquakes around Fiji. The video may be accessed [here](http://i.imgur.com/hd0tG0r.gif)" width="100%" />
<p class="caption">
Figure 5.24: Linking views between plotly and leaflet to explore the relation between magnitude and geographic location of earthquakes around Fiji. The video may be accessed <a href="http://i.imgur.com/hd0tG0r.gif">here</a>
</p>
</div>
<p>Figure <a href="querying-examples.html#fig:leaflet-polygons">5.25</a> uses another experimental feature of querying <strong>leaflet</strong> polygons in response to direct manipulation of a <strong>plotly</strong> graph.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># requires an experimental version of leaflet</span>
<span class="co"># devtools::install_github(&quot;rstudio/leaflet#391&quot;)</span>
<span class="kw">library</span>(leaflet)
<span class="kw">library</span>(sf)

nc &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shape/nc.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">st_read</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight_key</span>()

map &lt;-<span class="st"> </span><span class="kw">leaflet</span>(nc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(
    <span class="dt">opacity =</span> <span class="dv">1</span>,
    <span class="dt">color =</span> <span class="st">&#39;white&#39;</span>,
    <span class="dt">weight =</span> <span class="fl">.25</span>,
    <span class="dt">fillOpacity =</span> <span class="fl">.5</span>,
    <span class="dt">fillColor =</span> <span class="st">&#39;blue&#39;</span>,
    <span class="dt">smoothFactor =</span> <span class="dv">0</span>
  )

p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(nc) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">x =</span> <span class="op">~</span>BIR74, <span class="dt">y =</span> <span class="op">~</span>SID79) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">dragmode =</span> <span class="st">&quot;lasso&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>)

crosstalk<span class="op">::</span><span class="kw">bscols</span>(map, p)</code></pre>
<div class="figure"><span id="fig:leaflet-polygons"></span>
<img src="https://i.imgur.com/CIjLEnU.gif" alt="Querying polygons on a **leaflet** map in response to direct manipulation of a **plotly** graph." width="100%" />
<p class="caption">
Figure 5.25: Querying polygons on a <strong>leaflet</strong> map in response to direct manipulation of a <strong>plotly</strong> graph.
</p>
</div>
</div>
<div id="generalized-pairs-plots" class="section level3">
<h3><span class="header-section-number">5.3.6</span> Generalized pairs plots</h3>
<p>Section <a href="scatter-traces.html#scatterplot-matrices">2.1.1.2</a> introduced the generalized pairs plot made via <code>GGally::ggpairs()</code> which, like <code>ggplot()</code>, partially supports graphical queries. The brushing in Figure <a href="querying-examples.html#fig:linked-ggally">5.26</a> demonstrates how the scatterplots can respond to a graphical queries (allowing us to see how these relationships behave in specific subsections of the data space), but for the same reasons outlined in <a href="querying-examples.html#statistical-queries-ggplot">5.3.3</a>, the statistical summaries (e.g., the density plots and correlations) don’t respond to the graphical query.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">highlight_key</span>(iris) <span class="op">%&gt;%</span>
<span class="st">  </span>GGally<span class="op">::</span><span class="kw">ggpairs</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Species), <span class="dt">columns =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplotly</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>)</code></pre>
<div class="figure"><span id="fig:linked-ggally"></span>
<img src="images/plotlyGGally.gif" alt="Brushing a scatterplot matrix via the `ggpairs()` function in the **GGally** package. A video demonstrating the graphical queries can be viewed here" width="100%" />
<p class="caption">
Figure 5.26: Brushing a scatterplot matrix via the <code>ggpairs()</code> function in the <strong>GGally</strong> package. A video demonstrating the graphical queries can be viewed here
</p>
</div>
</div>
<div id="querying-diagnostic-plots" class="section level3">
<h3><span class="header-section-number">5.3.7</span> Querying diagnostic plots</h3>
<p>In addition to the <code>ggpairs()</code> function for generalized pairs plots, the <strong>GGally</strong> packages also has a <code>ggnostic()</code> function which generates a matrix of diagnostic plots from a model object using <strong>ggplot2</strong>. Each column of this matrix represents a different explanatory variable and each row represents a different diagnostic measure. Figure <a href="querying-examples.html#fig:ggnostic">5.27</a> shows the default display for a linear model, which includes residuals (resid), estimates of residual standard deviation when a particular observation is excluded (sigma), diagonals from the projection matrix (hat), and cooks distance (cooksd).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(GGally)

mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># for better tick labels</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">am =</span> <span class="kw">recode</span>(am, <span class="st">`</span><span class="dt">0</span><span class="st">`</span> =<span class="st"> &quot;automatic&quot;</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> &quot;manual&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt <span class="op">+</span><span class="st"> </span>qsec <span class="op">+</span><span class="st"> </span>am, <span class="dt">data =</span> .) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggnostic</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> am)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplotly</span>()</code></pre>
<div class="figure"><span id="fig:ggnostic"></span>
<img src="images/ggnostic.gif" alt="Graphical queries applied to multiple diagnostic plots of a linear model. The `ggplotly()` function has a special method for `ggnostic()` that adds graphical queries automatically with support for both individual observations (e.g. points) as well as meaningful groups (e.g., automatic vs manual)." width="100%" />
<p class="caption">
Figure 5.27: Graphical queries applied to multiple diagnostic plots of a linear model. The <code>ggplotly()</code> function has a special method for <code>ggnostic()</code> that adds graphical queries automatically with support for both individual observations (e.g. points) as well as meaningful groups (e.g., automatic vs manual).
</p>
</div>
<p>Injecting interactivity into <code>ggnostic()</code> via <code>ggplotly()</code> enhances the diagnostic plot in at least two ways. Coloring by a factor variable in the model allows us to highlight that region of the design matrix by selecting a relevant statistical summary, which can help avoid overplotting when dealing with numerous factor levels. For example, in Figure <a href="querying-examples.html#fig:ggnostic">5.27</a>, the user first highlights diagnostics for cars with manual transmission (in blue), then cars with automatic transmission (in red). Perhaps more widely useful is the ability to highlight individual observations since most of these diagnostics are designed to identify highly influential or unusual observations.</p>
<p>In Figure <a href="querying-examples.html#fig:ggnostic">5.27</a>, there is one observation with a noticeably high value of <code>cooksd</code>, which suggests the observation has a large influence on the fitted model. Clicking on that point highlights its corresponding diagnostic measures, plotted against each explanatory variable. Doing so makes it obvious that this observation is influential since it has a unusually high response/residual in a fairly sparse region of the design space (i.e., it has a pretty high value of <code>wt</code>) and removing it would significantly reduce the estimated standard deviation (<code>sigma</code>). By comparison, the other two observations with similar values of <code>wt</code> have a response value very close to the overall mean, so even though their value of <code>hat</code> is high, their value of <code>sigma</code> is low.</p>
<div id="subset-queries-via-list-columns" class="section level4">
<h4><span class="header-section-number">5.3.7.1</span> Subset queries via list-columns</h4>
<p>All the graphical querying examples thus far use <code>highlight_key()</code> to attach values from atomic vector of a data frame to graphical marker(s), but what non-atomic vectors (i.e., list-columns)? When it comes to <em>emitting</em> events, there is no real difference – <strong>plotly</strong> will “inform the world” of a set of selection values, which is the union of all data values in the graphical query. However, as Figure <a href="querying-examples.html#fig:list-column-simple">5.28</a> demonstrates, when <strong>plotly</strong> receives a list-column query, it will highlight graphical markers with data value(s) that are a subset of the selected values. For example, when the point [3, 3] is queried, <strong>plotly</strong> will highlight all markers that represent a subset of <code>{A, B, C}</code>, which is why both [1, 1] (representing the set <code>{A}</code>) and (2, 2) (representing the set <code>{A, B}</code>) are highlighted.</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, 
  <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,
  <span class="dt">key =</span> <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="cf">function</span>(x) LETTERS[<span class="kw">seq_len</span>(x)]),
  <span class="dt">txt =</span> <span class="kw">sapply</span>(key, <span class="cf">function</span>(x) <span class="kw">sprintf</span>(<span class="st">&quot;{%s}&quot;</span>, <span class="kw">paste</span>(x, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)))
)
<span class="kw">highlight_key</span>(d, <span class="op">~</span>key) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>x, <span class="dt">y =</span> <span class="op">~</span>y, <span class="dt">text =</span> <span class="op">~</span>txt, <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">dragmode =</span> <span class="st">&quot;lasso&quot;</span>)</code></pre>
<div class="figure"><span id="fig:list-column-simple"></span>
<img src="images/hierarchical.gif" alt="A simple example of subset queries via a list-column" width="100%" />
<p class="caption">
Figure 5.28: A simple example of subset queries via a list-column
</p>
</div>
<p>One compelling use case for subset queries is dendograms. In fact, <strong>plotly</strong> provides a <code>plot_dendro()</code> function for making dendrograms with support for subset queries. Figure <a href="querying-examples.html#fig:dendro">5.29</a> gives an example of brushing a branch of a dendrogram to query leafs that are similar in some sense. Any dendrogram object can be provided to <code>plot_dendro()</code>, but this particular example visualizes the similarity of US states in terms of their arrest statistics via a hierarchical clustering model on the <code>USArrests</code> dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r">hc &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(USArrests), <span class="st">&quot;ave&quot;</span>)
dend1 &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc)
<span class="kw">plot_dendro</span>(dend1, <span class="dt">height =</span> <span class="dv">600</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">hide_legend</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">highlight</span>(<span class="st">&quot;plotly_selected&quot;</span>, <span class="dt">persistent =</span> <span class="ot">TRUE</span>, <span class="dt">dynamic =</span> <span class="ot">TRUE</span>)</code></pre>
<div class="figure"><span id="fig:dendro"></span>
<img src="images/dendro.gif" alt="Leveraging hierarchical selection and persistent brushing to paint branches of a dendrogram." width="100%" />
<p class="caption">
Figure 5.29: Leveraging hierarchical selection and persistent brushing to paint branches of a dendrogram.
</p>
</div>
<p>Figure <a href="querying-examples.html#fig:tour-USArrests">5.30</a> links the dendrogram from Figure <a href="querying-examples.html#fig:dendro">5.29</a> to a map of the US and a grand tour of the arrest statistics to better understand and diagnose a hierarchical clustering methodology. By highlighting branches of the dendrogram, we can effectively choose a partitioning of the states into similar groups, and see how that model choice projects to the data space<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> through a grand tour. The grand tour is a special kind of animation that interpolates between random 2D projections of numeric data allowing the viewer to perceive the shape of a high-dimensional point cloud <span class="citation">(Asimov <a href="#ref-grand-tour">1985</a>)</span>. Note how the grouping portrayed in Figure <a href="querying-examples.html#fig:tour-USArrests">5.30</a> does a fairly good job of staying separated in the grand tour.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">demo</span>(<span class="st">&quot;animation-tour-USArrests&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;plotly&quot;</span>)</code></pre>
<div class="figure"><span id="fig:tour-USArrests"></span>
<img src="images/tour-USArrests.gif" alt="Linking a dendrogram to a grand tour and map of the `USArrests` data to visualize a classification in 5 dimensions." width="100%" />
<p class="caption">
Figure 5.30: Linking a dendrogram to a grand tour and map of the <code>USArrests</code> data to visualize a classification in 5 dimensions.
</p>
</div>
<!--
Figure \@ref(fig:tour-USArrests) makes use of [hierarchial selection](#hierarchial-selection) to select all the states (as well as all the child nodes) under a given node in both the dendrogram and the grand tour. This effectively provides a model selection tool in an unsupervised setting where one may choose a number of clusters by choosing relevant nodes in the dendrogram and viewing the model fit projected onto the data space. As shown in Figure \@ref(fig:tour-USArrests), after picking the 3 most obvious clusters, it looks as though a straight line could be drawn to completely separate the groups in the initial projection of the tour -- which suggests a split along this linear combination of these variables would provide a good classifier.^[In this situation, it may be desirable to retrieve the relevant linear combination after finding it. Since the slider displays the value of the current frame, one may go back to the data used to create the visualization, subset it to this value, and retrieve this linear combination.]

The code to generate Figure \@ref(fig:tour-USArrests), as well as a few other examples of the grand tour and linking brushing can be found in the package demos. To run the code for Figure \@ref(fig:tour-USArrests), run `demo("tour-USArrests", package = "plotly")`. To see a list of the other available demos, run `readLines(system.file("demo/00Index", package = "plotly"))`.
-->
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-trellis">
<p>Richard A. Becker, Ming-Jen Shyu, William S. Cleveland. 1996. “The Visual Design and Control of Trellis Display.” <em>Journal of Computational and Graphical Statistics</em> 5 (2): 123–55. <a href="http://www.jstor.org/stable/1390777">http://www.jstor.org/stable/1390777</a>.</p>
</div>
<div id="ref-tufte2001">
<p>Tufte, Edward. 2001. <em>The Visual Display of Quantitative Information</em>. Cheshire, Conn: Graphics Press.</p>
</div>
<div id="ref-engsoccerdata">
<p>Curley, James. 2016. <em>Engsoccerdata: English and European Soccer Results 1871-2016</em>. <a href="https://CRAN.R-project.org/package=engsoccerdata">https://CRAN.R-project.org/package=engsoccerdata</a>.</p>
</div>
<div id="ref-ggplotly-blog-post">
<p>Sievert, Carson. 2018a. “Learning from and Improving Upon Ggplotly Conversions.” Blog. <a href="https://blog.cpsievert.me/2018/01/30/learning-improving-ggplotly-geom-sf/">https://blog.cpsievert.me/2018/01/30/learning-improving-ggplotly-geom-sf/</a>.</p>
</div>
<div id="ref-sf-blog-post">
<p>Sievert, Carson. 2018b. “Visualizing Geo-Spatial Data with Sf and Plotly.” Blog. <a href="https://blog.cpsievert.me/2018/03/30/visualizing-geo-spatial-data-with-sf-and-plotly/">https://blog.cpsievert.me/2018/03/30/visualizing-geo-spatial-data-with-sf-and-plotly/</a>.</p>
</div>
<div id="ref-grand-tour">
<p>Asimov, Daniel. 1985. “The Grand Tour: A Tool for Viewing Multidimensional Data.” <em>SIAM J. Sci. Stat. Comput.</em> 6 (1): 128–43. <a href="https://doi.org/10.1137/0906011">https://doi.org/10.1137/0906011</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="17">
<li id="fn17"><p><span class="citation">Sievert (<a href="#ref-sf-blog-post">2018</a><a href="#ref-sf-blog-post">b</a>)</span> outlines the relative strengths and weaknesses of each approach.<a href="querying-examples.html#fnref17" class="footnote-back">↩</a></p></li>
<li id="fn18"><p>Typically statistical models are diagnosed by visualizing data in the model space rather than model(s) in the data space. As <span class="citation">Wickham, Cook, and Hofmann (<a href="#ref-model-vis-paper">2015</a>)</span> points, the latter approach can be a very effective way to better understand and diagnosis statistical models.<a href="querying-examples.html#fnref18" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="filter.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="limitations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/linked-views-examples.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-39373211-1', 'auto');ga('send', 'pageview');</script>
</body>

</html>
